<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>CMLIB: CMOracle.php Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.6.3 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
    </ul>
  </div>
<h1>CMOracle.php</h1><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 &lt;?php
<a name="l00002"></a>00002 
<a name="l00003"></a>00003 include_once(<span class="stringliteral">&quot;CMDatabaseProtocol.php&quot;</span>);
<a name="l00004"></a>00004 include_once(<span class="stringliteral">&quot;CMOracleQuery.php&quot;</span>);
<a name="l00005"></a>00005 include_once(<span class="stringliteral">&quot;CMConstant.php&quot;</span>);
<a name="l00006"></a>00006 include_once(<span class="stringliteral">&quot;CMError.php&quot;</span>);
<a name="l00007"></a>00007 
<a name="l00329"></a><a class="code" href="class_c_m_oracle.html">00329</a> <span class="keyword">class </span><a class="code" href="class_c_m_oracle.html" title="Oracle Database connectivity.">CMOracle</a> <span class="keyword">extends</span> <a class="code" href="class_c_m_error.html" title="Error handling as a stand-alone or for classes vis inheritance.">CMError</a> implements <a class="code" href="interface_c_m_database_protocol.html" title="All database connectivity classes implement this interface.">CMDatabaseProtocol</a> {
<a name="l00330"></a>00330  
<a name="l00336"></a><a class="code" href="class_c_m_oracle.html#a9e2d53558e7b299d52b25c13d310d7e0">00336</a>  <span class="keyword">public</span> <span class="keyword">static</span> function <a class="code" href="class_c_m_oracle.html#a9e2d53558e7b299d52b25c13d310d7e0" title="The version of this class.">Version</a>() {
<a name="l00337"></a>00337   <span class="keywordflow">return</span> <span class="stringliteral">&quot;1.0&quot;</span>;
<a name="l00338"></a>00338  }
<a name="l00339"></a>00339  
<a name="l00345"></a><a class="code" href="class_c_m_oracle.html#ab51e04ce58ff27601a503f46d611b7e6">00345</a>  <span class="keyword">public</span> <span class="keyword">static</span> function <a class="code" href="class_c_m_oracle.html#ab51e04ce58ff27601a503f46d611b7e6" title="The version this class was introduced to the library.">Since</a>() {
<a name="l00346"></a>00346   <span class="keywordflow">return</span> <span class="stringliteral">&quot;1.0&quot;</span>;
<a name="l00347"></a>00347  }
<a name="l00348"></a>00348  
<a name="l00356"></a><a class="code" href="class_c_m_oracle.html#a69423cb24968e09a427084bd5f1191d3">00356</a>  <span class="keyword">private</span> <a class="code" href="class_c_m_oracle.html#a69423cb24968e09a427084bd5f1191d3" title="Internal auto commit flag.">$autoCommit</a> = <span class="keyword">true</span>;
<a name="l00357"></a>00357  
<a name="l00361"></a><a class="code" href="class_c_m_oracle.html#acc1e62674bb7200ea73767c19dc1344d">00361</a>  <span class="keyword">private</span> <a class="code" href="class_c_m_oracle.html#acc1e62674bb7200ea73767c19dc1344d" title="Internal database handle.">$dbh</a> = <span class="keyword">false</span>;
<a name="l00362"></a>00362  
<a name="l00402"></a><a class="code" href="class_c_m_oracle.html#a722d99066fe9d4d3dee817816ca23cdf">00402</a>  <span class="keyword">public</span> function <a class="code" href="class_c_m_oracle.html#a722d99066fe9d4d3dee817816ca23cdf" title="Connect to a database.">CMOracle</a>($uri, $a = <span class="keyword">false</span>) {
<a name="l00403"></a>00403   <span class="comment">// dissect the URI</span>
<a name="l00404"></a>00404   $v = parse_url($uri);
<a name="l00405"></a>00405   $v[<span class="stringliteral">&#39;db&#39;</span>] = basename($v[<span class="stringliteral">&#39;path&#39;</span>]);
<a name="l00406"></a>00406   
<a name="l00407"></a>00407   <span class="comment">// make sure the scheme is valid</span>
<a name="l00408"></a>00408   <span class="keywordflow">if</span>($v[<span class="stringliteral">&#39;scheme&#39;</span>] != <span class="stringliteral">&#39;oracle&#39;</span>) {
<a name="l00409"></a>00409    $this-&gt;<a class="code" href="class_c_m_error.html#a94a6cd26c794c35133502471eca8469e" title="Throw a Error level message.">throwError</a>(<span class="stringliteral">&quot;Unsupported driver &#39;{$v[&#39;scheme&#39;]}&#39;&quot;</span>);
<a name="l00410"></a>00410    <span class="keywordflow">return</span> $this;
<a name="l00411"></a>00411   }
<a name="l00412"></a>00412   
<a name="l00413"></a>00413   <span class="comment">// server options</span>
<a name="l00414"></a>00414   <span class="keywordflow">if</span>(!isset($a[<span class="stringliteral">&#39;LD_LIBRARY_PATH&#39;</span>]))
<a name="l00415"></a>00415    $a[<span class="stringliteral">&#39;LD_LIBRARY_PATH&#39;</span>] = <span class="stringliteral">&quot;$a[ORACLE_HOME]/lib&quot;</span>;
<a name="l00416"></a>00416 
<a name="l00417"></a>00417   <span class="comment">// environment variables</span>
<a name="l00418"></a>00418   <span class="keywordflow">if</span>(isset($v[<span class="stringliteral">&#39;db&#39;</span>]))
<a name="l00419"></a>00419    PutEnv(<span class="stringliteral">&quot;ORACLE_SID=$v[db]&quot;</span>);
<a name="l00420"></a>00420   <span class="keywordflow">if</span>(isset($a[<span class="stringliteral">&#39;ORACLE_HOME&#39;</span>]))
<a name="l00421"></a>00421    PutEnv(<span class="stringliteral">&quot;ORACLE_HOME=$a[ORACLE_HOME]&quot;</span>);
<a name="l00422"></a>00422   <span class="keywordflow">if</span>(isset($a[<span class="stringliteral">&#39;LD_LIBRARY_PATH&#39;</span>]))
<a name="l00423"></a>00423    PutEnv(<span class="stringliteral">&quot;LD_LIBRARY_PATH=$a[LD_LIBRARY_PATH]&quot;</span>);
<a name="l00424"></a>00424   
<a name="l00425"></a>00425   <span class="comment">// attempt to connect</span>
<a name="l00426"></a>00426   $this-&gt;dbh = oci_connect($v[<span class="stringliteral">&#39;user&#39;</span>], $v[<span class="stringliteral">&#39;pass&#39;</span>], $v[<span class="stringliteral">&#39;host&#39;</span>] . <span class="charliteral">&#39;/&#39;</span> . $v[<span class="stringliteral">&#39;db&#39;</span>]);
<a name="l00427"></a>00427   <span class="keywordflow">if</span>(!$this-&gt;dbh) {
<a name="l00428"></a>00428    $this-&gt;<a class="code" href="class_c_m_error.html#a94a6cd26c794c35133502471eca8469e" title="Throw a Error level message.">throwError</a>(oci_error());
<a name="l00429"></a>00429    <span class="keywordflow">return</span> $this;
<a name="l00430"></a>00430   }
<a name="l00431"></a>00431  }
<a name="l00432"></a>00432  
<a name="l00446"></a><a class="code" href="class_c_m_oracle.html#a4ced4e9cc5497c475c2cd1a03318f45a">00446</a>  <span class="keyword">public</span> function <a class="code" href="class_c_m_oracle.html#a4ced4e9cc5497c475c2cd1a03318f45a" title="Perform a query on the database that returns a handle to iterate the results.">query</a>($sql, $values = <span class="keyword">false</span>, $a = <span class="keyword">false</span>) {
<a name="l00447"></a>00447   $sql = $this-&gt;<a class="code" href="class_c_m_oracle.html#a08895ad5ecec3e9850ebe052b020d928" title="Use internally by query() and insert() for substituting values.">bindValues</a>($sql, $values);
<a name="l00448"></a>00448   
<a name="l00449"></a>00449   <span class="keywordflow">if</span>($a !== <span class="keyword">false</span> &amp;&amp; in_array(<span class="stringliteral">&#39;print&#39;</span>, $a))
<a name="l00450"></a>00450    echo $sql;
<a name="l00451"></a>00451   
<a name="l00452"></a>00452   $stid = oci_parse($this-&gt;dbh, $sql);
<a name="l00453"></a>00453   $success = <span class="keyword">false</span>;
<a name="l00454"></a>00454   <span class="keywordflow">if</span>($this-&gt;autoCommit)
<a name="l00455"></a>00455    $success = oci_execute($stid);
<a name="l00456"></a>00456   <span class="keywordflow">else</span> $success = oci_execute($stid, OCI_NO_AUTO_COMMIT);
<a name="l00457"></a>00457   
<a name="l00458"></a>00458   <span class="keywordflow">if</span>(!$success)
<a name="l00459"></a>00459    $this-&gt;<a class="code" href="class_c_m_error.html#a6d110c63a1c5103df7979612ed5209d3" title="Throw a Warning level message.">throwWarning</a>(<span class="stringliteral">&quot;Query failed&quot;</span>, array(<span class="stringliteral">&#39;sql&#39;</span> =&gt; $sql));
<a name="l00460"></a>00460   
<a name="l00461"></a>00461   <span class="keywordflow">return</span> <span class="keyword">new</span> <a class="code" href="class_c_m_oracle_query.html" title="Oracle database query handler.">CMOracleQuery</a>($stid, $a);
<a name="l00462"></a>00462  }
<a name="l00463"></a>00463  
<a name="l00475"></a><a class="code" href="class_c_m_oracle.html#a13148537025768f2373012227785c540">00475</a>  <span class="keyword">public</span> function <a class="code" href="class_c_m_oracle.html#a13148537025768f2373012227785c540" title="Perform a query on the database that does not return a handle.">execute</a>($sql, $values = <span class="keyword">false</span>, $a = <span class="keyword">false</span>) {
<a name="l00476"></a>00476   $q = $this-&gt;<a class="code" href="class_c_m_oracle.html#a4ced4e9cc5497c475c2cd1a03318f45a" title="Perform a query on the database that returns a handle to iterate the results.">query</a>($sql, $values, $a);
<a name="l00477"></a>00477   <span class="keywordflow">return</span> $q-&gt;success();
<a name="l00478"></a>00478  }
<a name="l00479"></a>00479  
<a name="l00495"></a><a class="code" href="class_c_m_oracle.html#a08895ad5ecec3e9850ebe052b020d928">00495</a>  <span class="keyword">public</span> function <a class="code" href="class_c_m_oracle.html#a08895ad5ecec3e9850ebe052b020d928" title="Use internally by query() and insert() for substituting values.">bindValues</a>($sql, $values = <span class="keyword">false</span>) {
<a name="l00496"></a>00496   <span class="keywordflow">if</span>(is_array($values)) {
<a name="l00497"></a>00497    $parts = explode(<span class="charliteral">&#39;?&#39;</span>, $sql);
<a name="l00498"></a>00498    $new_sql = <span class="stringliteral">&quot;&quot;</span>;
<a name="l00499"></a>00499    <span class="keywordflow">for</span>($i = 0; $i &lt; count($parts) - 1; ++$i) {
<a name="l00500"></a>00500     <span class="comment">// if its a CMConstant we don&#39;t encapsulate it</span>
<a name="l00501"></a>00501     <span class="keywordflow">if</span>($values[$i] instanceof <a class="code" href="class_c_m_constant.html" title="A container for value that need not be modified or encapsulated.">CMConstant</a>)
<a name="l00502"></a>00502      $new_sql .= $parts[$i] . $values[$i];
<a name="l00503"></a>00503     <span class="keywordflow">else</span> $new_sql .= $parts[$i] . <span class="stringliteral">&quot;&#39;&quot;</span> . str_replace(<span class="stringliteral">&quot;&#39;&quot;</span>, <span class="stringliteral">&quot;&#39;&#39;&quot;</span>, $values[$i]) . <span class="stringliteral">&quot;&#39;&quot;</span>;
<a name="l00504"></a>00504    }
<a name="l00505"></a>00505    $sql = $new_sql . $parts[count($parts) - 1];
<a name="l00506"></a>00506   } elseif($values !== <span class="keyword">false</span>) {
<a name="l00507"></a>00507    <span class="comment">// if its a CMConstant we don&#39;t encapsulate it</span>
<a name="l00508"></a>00508    <span class="keywordflow">if</span>($values instanceof <a class="code" href="class_c_m_constant.html" title="A container for value that need not be modified or encapsulated.">CMConstant</a>)
<a name="l00509"></a>00509     $sql = str_replace(<span class="charliteral">&#39;?&#39;</span>, $values, $sql);
<a name="l00510"></a>00510    <span class="keywordflow">else</span> $sql = str_replace(<span class="charliteral">&#39;?&#39;</span>, <span class="stringliteral">&quot;&#39;&quot;</span> . str_replace(<span class="stringliteral">&quot;&#39;&quot;</span>, <span class="stringliteral">&quot;&#39;&#39;&quot;</span>, $values) . <span class="stringliteral">&quot;&#39;&quot;</span>, $sql);
<a name="l00511"></a>00511   }
<a name="l00512"></a>00512    
<a name="l00513"></a>00513   <span class="keywordflow">return</span> $sql;
<a name="l00514"></a>00514  }
<a name="l00515"></a>00515  
<a name="l00539"></a><a class="code" href="class_c_m_oracle.html#a0f4b4455d44a47a695e4c6cf96488242">00539</a>  <span class="keyword">public</span> function <a class="code" href="class_c_m_oracle.html#a0f4b4455d44a47a695e4c6cf96488242" title="INSERT statement">insert</a>($name, $kv = <span class="keyword">false</span>, $a = <span class="keyword">false</span>) {
<a name="l00540"></a>00540   $sql = <span class="stringliteral">&quot;insert into $name (&quot;</span> . implode(<span class="charliteral">&#39;,&#39;</span>, array_keys($kv)) . <span class="stringliteral">&quot;) values (&quot;</span>;
<a name="l00541"></a>00541   $first = <span class="keyword">true</span>;
<a name="l00542"></a>00542   <span class="keywordflow">foreach</span>($kv as $k =&gt; $v) {
<a name="l00543"></a>00543    <span class="keywordflow">if</span>(!$first) $sql .= <span class="stringliteral">&quot;,&quot;</span>;
<a name="l00544"></a>00544    
<a name="l00545"></a>00545    <span class="comment">// if its a CMConstant we don&#39;t encapsulate it</span>
<a name="l00546"></a>00546    <span class="keywordflow">if</span>($v instanceof <a class="code" href="class_c_m_constant.html" title="A container for value that need not be modified or encapsulated.">CMConstant</a>)
<a name="l00547"></a>00547     $sql .= <span class="stringliteral">&quot;&#39;&quot;</span> . str_replace(<span class="stringliteral">&quot;&#39;&quot;</span>, <span class="stringliteral">&quot;&#39;&#39;&quot;</span>, $v) . <span class="stringliteral">&quot;&#39;&quot;</span>;
<a name="l00548"></a>00548    <span class="keywordflow">else</span> $sql .= $v;
<a name="l00549"></a>00549     
<a name="l00550"></a>00550    $first = <span class="keyword">false</span>;
<a name="l00551"></a>00551   }
<a name="l00552"></a>00552   
<a name="l00553"></a>00553   $success = $this-&gt;<a class="code" href="class_c_m_oracle.html#a4ced4e9cc5497c475c2cd1a03318f45a" title="Perform a query on the database that returns a handle to iterate the results.">query</a>(<span class="stringliteral">&quot;$sql)&quot;</span>)-&gt;success();
<a name="l00554"></a>00554   <span class="keywordflow">if</span>(!$success)
<a name="l00555"></a>00555    $this-&gt;<a class="code" href="class_c_m_error.html#a6d110c63a1c5103df7979612ed5209d3" title="Throw a Warning level message.">throwWarning</a>(<span class="stringliteral">&quot;Query failed&quot;</span>, array(<span class="stringliteral">&#39;sql&#39;</span> =&gt; <span class="stringliteral">&quot;$sql)&quot;</span>));
<a name="l00556"></a>00556   
<a name="l00557"></a>00557   <span class="keywordflow">return</span> $success;
<a name="l00558"></a>00558  }
<a name="l00559"></a>00559  
<a name="l00568"></a><a class="code" href="class_c_m_oracle.html#a36b890fb5812fc1247b8afe7d56e72ea">00568</a>  <span class="keyword">public</span> function <a class="code" href="class_c_m_oracle.html#a36b890fb5812fc1247b8afe7d56e72ea" title="Fetch the list of tables in the active database.">getTableNames</a>($schema = <span class="keyword">false</span>) {
<a name="l00569"></a>00569   <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00570"></a>00570  }
<a name="l00571"></a>00571  
<a name="l00580"></a><a class="code" href="class_c_m_oracle.html#ae7cdaa744d52a1eb0103e377023ca528">00580</a>  <span class="keyword">public</span> function <a class="code" href="class_c_m_oracle.html#ae7cdaa744d52a1eb0103e377023ca528" title="Returns true or false for the selected database.">tableExists</a>($table) {
<a name="l00581"></a>00581   <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00582"></a>00582  }
<a name="l00583"></a>00583  
<a name="l00591"></a><a class="code" href="class_c_m_oracle.html#aea9c1153e0e0fc135f8d513263bf9201">00591</a>  <span class="keyword">public</span> function <a class="code" href="class_c_m_oracle.html#aea9c1153e0e0fc135f8d513263bf9201" title="Not supported.">getDatabaseNames</a>() {
<a name="l00592"></a>00592   <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00593"></a>00593  }
<a name="l00594"></a>00594 
<a name="l00602"></a><a class="code" href="class_c_m_oracle.html#a7cf4f2839a152f2c11f5893c640c19dd">00602</a>  <span class="keyword">public</span> function <a class="code" href="class_c_m_oracle.html#a7cf4f2839a152f2c11f5893c640c19dd" title="Not supported.">getSchemaNames</a>() {
<a name="l00603"></a>00603   <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00604"></a>00604  }
<a name="l00605"></a>00605  
<a name="l00618"></a><a class="code" href="class_c_m_oracle.html#aa45cf2b82a91150a11cd11fa0bf2847c">00618</a>  <span class="keyword">public</span> function <a class="code" href="class_c_m_oracle.html#aa45cf2b82a91150a11cd11fa0bf2847c" title="Class methods available to this query handle.">availableMethods</a>() {
<a name="l00619"></a>00619   <span class="keywordflow">return</span> array(<span class="stringliteral">&#39;commit&#39;</span>, <span class="stringliteral">&#39;delete&#39;</span>, <span class="stringliteral">&#39;disconnect&#39;</span>, <span class="stringliteral">&#39;engine&#39;</span>, <span class="stringliteral">&#39;eraseTable&#39;</span>, <span class="stringliteral">&#39;escapeString&#39;</span>,
<a name="l00620"></a>00620       <span class="stringliteral">&#39;execute&#39;</span>, <span class="stringliteral">&#39;getDatabaseNames&#39;</span>, <span class="stringliteral">&#39;getSchemaNames&#39;</span>, <span class="stringliteral">&#39;getTableNames&#39;</span>, <span class="stringliteral">&#39;insert&#39;</span>,
<a name="l00621"></a>00621       <span class="stringliteral">&#39;isConnected&#39;</span>, <span class="stringliteral">&#39;query&#39;</span>, <span class="stringliteral">&#39;rollback&#39;</span>, <span class="stringliteral">&#39;setAutoCommit&#39;</span>, <span class="stringliteral">&#39;tableExists&#39;</span>,
<a name="l00622"></a>00622       <span class="stringliteral">&#39;truncateTable&#39;</span>, <span class="stringliteral">&#39;update&#39;</span>, <span class="stringliteral">&#39;getAutoCommit&#39;</span>);
<a name="l00623"></a>00623  }
<a name="l00624"></a>00624  
<a name="l00630"></a><a class="code" href="class_c_m_oracle.html#af160f7fbbf281d018ae3162521b8267d">00630</a>  <span class="keyword">public</span> function <a class="code" href="class_c_m_oracle.html#af160f7fbbf281d018ae3162521b8267d" title="Check if the database connection is still active.">isConnected</a>() {
<a name="l00631"></a>00631   <span class="keywordflow">return</span> $this-&gt;dbh !== <span class="keyword">false</span>;
<a name="l00632"></a>00632  }
<a name="l00633"></a>00633  
<a name="l00639"></a><a class="code" href="class_c_m_oracle.html#abe175fcf658475bc56e9d6fa02bc88ec">00639</a>  <span class="keyword">public</span> function <a class="code" href="class_c_m_oracle.html#abe175fcf658475bc56e9d6fa02bc88ec" title="Disconnect database handle.">disconnect</a>() {
<a name="l00640"></a>00640   <span class="keywordflow">if</span>($this-&gt;dbh !== <span class="keyword">false</span>)
<a name="l00641"></a>00641    oci_close($this-&gt;dbh);
<a name="l00642"></a>00642   <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00643"></a>00643  }
<a name="l00644"></a>00644  
<a name="l00650"></a><a class="code" href="class_c_m_oracle.html#a8147e0a0a8e607106004e2571195e01c">00650</a>  <span class="keyword">public</span> function <a class="code" href="class_c_m_oracle.html#a8147e0a0a8e607106004e2571195e01c" title="The name of the database product.">engine</a>() {
<a name="l00651"></a>00651   <span class="keywordflow">return</span> <span class="stringliteral">&quot;Oracle&quot;</span>;
<a name="l00652"></a>00652  }
<a name="l00653"></a>00653  
<a name="l00663"></a><a class="code" href="class_c_m_oracle.html#af5674c27d4a92f6228565010eacbb9cb">00663</a>  <span class="keyword">public</span> function <a class="code" href="class_c_m_oracle.html#af5674c27d4a92f6228565010eacbb9cb" title="COMMIT transaction.">commit</a>() {
<a name="l00664"></a>00664   <span class="keywordflow">if</span>($this-&gt;dbh === <span class="keyword">false</span>)
<a name="l00665"></a>00665    <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00666"></a>00666   <span class="keywordflow">return</span> oci_commit($this-&gt;dbh);
<a name="l00667"></a>00667  }
<a name="l00668"></a>00668 
<a name="l00678"></a><a class="code" href="class_c_m_oracle.html#afa549adf79e3f8c09fe8f903dd5fbfa7">00678</a>  <span class="keyword">public</span> function <a class="code" href="class_c_m_oracle.html#afa549adf79e3f8c09fe8f903dd5fbfa7" title="ROLLBACK transaction.">rollback</a>() {
<a name="l00679"></a>00679   <span class="keywordflow">if</span>($this-&gt;dbh === <span class="keyword">false</span>)
<a name="l00680"></a>00680    <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00681"></a>00681   <span class="keywordflow">return</span> oci_rollback($this-&gt;dbh);
<a name="l00682"></a>00682  }
<a name="l00683"></a>00683 
<a name="l00695"></a><a class="code" href="class_c_m_oracle.html#af569120fcd4d04f33780d9c10daf144c">00695</a>  <span class="keyword">public</span> function <a class="code" href="class_c_m_oracle.html#af569120fcd4d04f33780d9c10daf144c" title="Turn autocommit on/off.">setAutoCommit</a>($mode = <span class="keyword">false</span>) {
<a name="l00696"></a>00696   $this-&gt;autoCommit = $mode;
<a name="l00697"></a>00697   <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00698"></a>00698  }
<a name="l00699"></a>00699  
<a name="l00703"></a><a class="code" href="class_c_m_oracle.html#a7516ca30af0db3cdbf9a7739b48ce91d">00703</a>  <span class="keyword">public</span> function <a class="code" href="class_c_m_oracle.html#a7516ca30af0db3cdbf9a7739b48ce91d" title="Return the string value of this object.">__toString</a>() {
<a name="l00704"></a>00704   <span class="keywordflow">return</span> <span class="stringliteral">&quot;&lt;&quot;</span> . get_class($this) . <span class="stringliteral">&quot;&gt;&quot;</span>;
<a name="l00705"></a>00705  }
<a name="l00706"></a>00706  
<a name="l00723"></a><a class="code" href="class_c_m_oracle.html#a7e4edd82127e0c6a2f42158fdbb258d3">00723</a>  <span class="keyword">public</span> function <a class="code" href="class_c_m_oracle.html#a7e4edd82127e0c6a2f42158fdbb258d3" title="Erase (not truncate) a table.">eraseTable</a>($tableName) {
<a name="l00724"></a>00724   <span class="comment">// need a valid database handle</span>
<a name="l00725"></a>00725   <span class="keywordflow">if</span>($this-&gt;dbh === <span class="keyword">false</span>)
<a name="l00726"></a>00726    <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00727"></a>00727   
<a name="l00728"></a>00728   $q = $this-&gt;<a class="code" href="class_c_m_oracle.html#a4ced4e9cc5497c475c2cd1a03318f45a" title="Perform a query on the database that returns a handle to iterate the results.">query</a>(<span class="stringliteral">&quot;DELETE FROM $tableName WHERE 1&quot;</span>);
<a name="l00729"></a>00729   <span class="keywordflow">return</span> $q-&gt;success();
<a name="l00730"></a>00730  }
<a name="l00731"></a>00731  
<a name="l00744"></a><a class="code" href="class_c_m_oracle.html#aff013143f73f33653e2f60fecbde00cb">00744</a>  <span class="keyword">public</span> function <a class="code" href="class_c_m_oracle.html#aff013143f73f33653e2f60fecbde00cb" title="TRUNCATE table.">truncateTable</a>($tableName) {
<a name="l00745"></a>00745   <span class="comment">// need a valid database handle</span>
<a name="l00746"></a>00746   <span class="keywordflow">if</span>($this-&gt;dbh === <span class="keyword">false</span>)
<a name="l00747"></a>00747    <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00748"></a>00748   
<a name="l00749"></a>00749   $q = $this-&gt;<a class="code" href="class_c_m_oracle.html#a4ced4e9cc5497c475c2cd1a03318f45a" title="Perform a query on the database that returns a handle to iterate the results.">query</a>(<span class="stringliteral">&quot;TRUNCATE TABLE $tableName&quot;</span>);
<a name="l00750"></a>00750   <span class="keywordflow">return</span> $q-&gt;success();
<a name="l00751"></a>00751  }
<a name="l00752"></a>00752  
<a name="l00763"></a><a class="code" href="class_c_m_oracle.html#ac32a7f2a2c349c061f600bc0ac2fec86">00763</a>  <span class="keyword">public</span> function <a class="code" href="class_c_m_oracle.html#ac32a7f2a2c349c061f600bc0ac2fec86" title="UPDATE statement.">update</a>($tableName, $newvalues, $criteria = <span class="keyword">false</span>, $a = <span class="keyword">false</span>) {
<a name="l00764"></a>00764   <span class="comment">// $a must be an array</span>
<a name="l00765"></a>00765   <span class="keywordflow">if</span>(!is_array($a))
<a name="l00766"></a>00766    $a = array();
<a name="l00767"></a>00767   
<a name="l00768"></a>00768   $sql = <span class="stringliteral">&quot;UPDATE `$tableName` SET &quot;</span>;
<a name="l00769"></a>00769   $first = <span class="keyword">true</span>;
<a name="l00770"></a>00770   <span class="keywordflow">foreach</span>($newvalues as $k =&gt; $v) {
<a name="l00771"></a>00771    <span class="keywordflow">if</span>(!$first) $sql .= <span class="stringliteral">&quot;,&quot;</span>;
<a name="l00772"></a>00772    
<a name="l00773"></a>00773    <span class="comment">// if its a CMConstant we don&#39;t encapsulate it</span>
<a name="l00774"></a>00774    <span class="keywordflow">if</span>($v instanceof <a class="code" href="class_c_m_constant.html" title="A container for value that need not be modified or encapsulated.">CMConstant</a>)
<a name="l00775"></a>00775     $sql .= <span class="stringliteral">&quot;$k=$v&quot;</span>;
<a name="l00776"></a>00776    <span class="keywordflow">else</span> $sql .= <span class="stringliteral">&quot;$k=&#39;&quot;</span> . str_replace(<span class="stringliteral">&quot;&#39;&quot;</span>, <span class="stringliteral">&quot;&#39;&#39;&quot;</span>, $v) . <span class="stringliteral">&quot;&#39;&quot;</span>;
<a name="l00777"></a>00777    
<a name="l00778"></a>00778    $first = <span class="keyword">false</span>;
<a name="l00779"></a>00779   }
<a name="l00780"></a>00780   
<a name="l00781"></a>00781   <span class="comment">// add WHERE clause</span>
<a name="l00782"></a>00782   <span class="keywordflow">if</span>($criteria !== <span class="keyword">false</span>) {
<a name="l00783"></a>00783    $sql .= <span class="stringliteral">&quot; WHERE &quot;</span>;
<a name="l00784"></a>00784    $first = <span class="keyword">true</span>;
<a name="l00785"></a>00785    <span class="keywordflow">foreach</span>($criteria as $k =&gt; $v) {
<a name="l00786"></a>00786     <span class="keywordflow">if</span>(!$first) $sql .= <span class="stringliteral">&quot; AND &quot;</span>;
<a name="l00787"></a>00787     
<a name="l00788"></a>00788     <span class="comment">// if its a CMConstant we don&#39;t encapsulate it</span>
<a name="l00789"></a>00789     <span class="keywordflow">if</span>($v instanceof <a class="code" href="class_c_m_constant.html" title="A container for value that need not be modified or encapsulated.">CMConstant</a>)
<a name="l00790"></a>00790      $sql .= <span class="stringliteral">&quot;$k=$v&quot;</span>;
<a name="l00791"></a>00791     <span class="keywordflow">else</span> $sql .= <span class="stringliteral">&quot;$k=&#39;&quot;</span> . str_replace(<span class="stringliteral">&quot;&#39;&quot;</span>, <span class="stringliteral">&quot;&#39;&#39;&quot;</span>, $v) . <span class="stringliteral">&quot;&#39;&quot;</span>;
<a name="l00792"></a>00792     
<a name="l00793"></a>00793     $first = <span class="keyword">false</span>;
<a name="l00794"></a>00794    }
<a name="l00795"></a>00795   }
<a name="l00796"></a>00796   
<a name="l00797"></a>00797   <span class="keywordflow">if</span>(isset($a[<span class="stringliteral">&#39;print&#39;</span>]))
<a name="l00798"></a>00798    echo $sql;
<a name="l00799"></a>00799   
<a name="l00800"></a>00800   $q = $this-&gt;<a class="code" href="class_c_m_oracle.html#a4ced4e9cc5497c475c2cd1a03318f45a" title="Perform a query on the database that returns a handle to iterate the results.">query</a>($sql, <span class="keyword">false</span>, $a);
<a name="l00801"></a>00801   <span class="keywordflow">if</span>($q-&gt;success())
<a name="l00802"></a>00802    <span class="keywordflow">return</span> $q-&gt;affectedRows();
<a name="l00803"></a>00803   <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00804"></a>00804  }
<a name="l00805"></a>00805  
<a name="l00815"></a><a class="code" href="class_c_m_oracle.html#a2415ba06f043f104ed33b9571f200fc8">00815</a>  <span class="keyword">public</span> function <span class="keyword">delete</span>($tableName, $criteria = <span class="keyword">false</span>, $a = <span class="keyword">false</span>) {
<a name="l00816"></a>00816   <span class="comment">// $a must be an array</span>
<a name="l00817"></a>00817   <span class="keywordflow">if</span>(!is_array($a))
<a name="l00818"></a>00818    $a = array();
<a name="l00819"></a>00819   
<a name="l00820"></a>00820   $sql = <span class="stringliteral">&quot;DELETE FROM `$tableName`&quot;</span>;
<a name="l00821"></a>00821   
<a name="l00822"></a>00822   <span class="comment">// add WHERE clause</span>
<a name="l00823"></a>00823   <span class="keywordflow">if</span>($criteria !== <span class="keyword">false</span>) {
<a name="l00824"></a>00824    $sql .= <span class="stringliteral">&quot; WHERE &quot;</span>;
<a name="l00825"></a>00825    $first = <span class="keyword">true</span>;
<a name="l00826"></a>00826    <span class="keywordflow">foreach</span>($criteria as $k =&gt; $v) {
<a name="l00827"></a>00827     <span class="keywordflow">if</span>(!$first) $sql .= <span class="stringliteral">&quot; AND &quot;</span>;
<a name="l00828"></a>00828     
<a name="l00829"></a>00829     <span class="comment">// if its a CMConstant we don&#39;t encapsulate it</span>
<a name="l00830"></a>00830     <span class="keywordflow">if</span>($v instanceof <a class="code" href="class_c_m_constant.html" title="A container for value that need not be modified or encapsulated.">CMConstant</a>)
<a name="l00831"></a>00831      $sql .= <span class="stringliteral">&quot;$k=$v&quot;</span>;
<a name="l00832"></a>00832     <span class="keywordflow">else</span> $sql .= <span class="stringliteral">&quot;$k=&#39;&quot;</span> . str_replace(<span class="stringliteral">&quot;&#39;&quot;</span>, <span class="stringliteral">&quot;&#39;&#39;&quot;</span>, $v) . <span class="stringliteral">&quot;&#39;&quot;</span>;
<a name="l00833"></a>00833     
<a name="l00834"></a>00834     $first = <span class="keyword">false</span>;
<a name="l00835"></a>00835    }
<a name="l00836"></a>00836   }
<a name="l00837"></a>00837   
<a name="l00838"></a>00838   <span class="keywordflow">if</span>(isset($a[<span class="stringliteral">&#39;print&#39;</span>]))
<a name="l00839"></a>00839    echo $sql;
<a name="l00840"></a>00840   
<a name="l00841"></a>00841   $q = $this-&gt;<a class="code" href="class_c_m_oracle.html#a4ced4e9cc5497c475c2cd1a03318f45a" title="Perform a query on the database that returns a handle to iterate the results.">query</a>($sql, <span class="keyword">false</span>, $a);
<a name="l00842"></a>00842   <span class="keywordflow">if</span>($q-&gt;success())
<a name="l00843"></a>00843    <span class="keywordflow">return</span> $q-&gt;affectedRows();
<a name="l00844"></a>00844   <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00845"></a>00845  }
<a name="l00846"></a>00846  
<a name="l00853"></a><a class="code" href="class_c_m_oracle.html#a2d931763c47d46ab7c26ba4e69d969d7">00853</a>  <span class="keyword">public</span> function <a class="code" href="class_c_m_oracle.html#a2d931763c47d46ab7c26ba4e69d969d7" title="Escape a string based on the correct rules of the database engine.">escapeString</a>($str) {
<a name="l00854"></a>00854   <span class="keywordflow">return</span> str_replace(<span class="stringliteral">&quot;&#39;&quot;</span>, <span class="stringliteral">&quot;&#39;&#39;&quot;</span>, $str); 
<a name="l00855"></a>00855  }
<a name="l00856"></a>00856  
<a name="l00863"></a><a class="code" href="class_c_m_oracle.html#a7327ec53765f61a4a9d715133d2ea2db">00863</a>  <span class="keyword">public</span> function <a class="code" href="class_c_m_oracle.html#a7327ec53765f61a4a9d715133d2ea2db" title="Return the auto commit status.">getAutoCommit</a>() {
<a name="l00864"></a>00864   <span class="keywordflow">return</span> $this-&gt;autoCommit;
<a name="l00865"></a>00865  }
<a name="l00866"></a>00866 
<a name="l00867"></a>00867 }
<a name="l00868"></a>00868 
<a name="l00869"></a>00869 ?&gt;
</pre></div></div>
<hr class="footer"/><address style="text-align: right;"><small>Generated by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.3 </small></address>
</body>
</html>
