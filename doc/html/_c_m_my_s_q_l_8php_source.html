<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>CMLIB: CMMySQL.php Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.6.3 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
    </ul>
  </div>
<h1>CMMySQL.php</h1><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 &lt;?php
<a name="l00002"></a>00002 
<a name="l00003"></a>00003 include_once(<span class="stringliteral">&quot;CMDatabaseProtocol.php&quot;</span>);
<a name="l00004"></a>00004 include_once(<span class="stringliteral">&quot;CMMySQLQuery.php&quot;</span>);
<a name="l00005"></a>00005 include_once(<span class="stringliteral">&quot;CMConstant.php&quot;</span>);
<a name="l00006"></a>00006 include_once(<span class="stringliteral">&quot;CMError.php&quot;</span>);
<a name="l00007"></a>00007 include_once(<span class="stringliteral">&quot;CMDecimal.php&quot;</span>);
<a name="l00008"></a>00008 
<a name="l00490"></a><a class="code" href="class_c_m_my_s_q_l.html">00490</a> <span class="keyword">class </span><a class="code" href="class_c_m_my_s_q_l.html" title="MySQL connectivity class.">CMMySQL</a> <span class="keyword">extends</span> <a class="code" href="class_c_m_error.html" title="Error handling as a stand-alone or for classes vis inheritance.">CMError</a> implements <a class="code" href="interface_c_m_database_protocol.html" title="All database connectivity classes implement this interface.">CMDatabaseProtocol</a> {
<a name="l00491"></a>00491  
<a name="l00497"></a><a class="code" href="class_c_m_my_s_q_l.html#a9e2d53558e7b299d52b25c13d310d7e0">00497</a>  <span class="keyword">public</span> <span class="keyword">static</span> function <a class="code" href="class_c_m_my_s_q_l.html#a9e2d53558e7b299d52b25c13d310d7e0" title="The version of this class.">Version</a>() {
<a name="l00498"></a>00498   <span class="keywordflow">return</span> <span class="stringliteral">&quot;1.0&quot;</span>;
<a name="l00499"></a>00499  }
<a name="l00500"></a>00500  
<a name="l00506"></a><a class="code" href="class_c_m_my_s_q_l.html#ab51e04ce58ff27601a503f46d611b7e6">00506</a>  <span class="keyword">public</span> <span class="keyword">static</span> function <a class="code" href="class_c_m_my_s_q_l.html#ab51e04ce58ff27601a503f46d611b7e6" title="The version this class was introduced to the library.">Since</a>() {
<a name="l00507"></a>00507   <span class="keywordflow">return</span> <span class="stringliteral">&quot;1.0&quot;</span>;
<a name="l00508"></a>00508  }
<a name="l00509"></a>00509  
<a name="l00513"></a><a class="code" href="class_c_m_my_s_q_l.html#acc1e62674bb7200ea73767c19dc1344d">00513</a>  <span class="keyword">private</span> <a class="code" href="class_c_m_my_s_q_l.html#acc1e62674bb7200ea73767c19dc1344d" title="Internal database handle.">$dbh</a> = <span class="keyword">false</span>;
<a name="l00514"></a>00514  
<a name="l00520"></a><a class="code" href="class_c_m_my_s_q_l.html#a142c9a24d4f80b32faeb93ca6e77f5e3">00520</a>  <span class="keyword">private</span> <a class="code" href="class_c_m_my_s_q_l.html#a142c9a24d4f80b32faeb93ca6e77f5e3" title="The driver determines the PHP functions to call.">$driver</a> = <span class="stringliteral">&#39;mysqli&#39;</span>;
<a name="l00521"></a>00521  
<a name="l00528"></a><a class="code" href="class_c_m_my_s_q_l.html#a69423cb24968e09a427084bd5f1191d3">00528</a>  <span class="keyword">private</span> <a class="code" href="class_c_m_my_s_q_l.html#a69423cb24968e09a427084bd5f1191d3" title="Internal use.">$autoCommit</a> = <span class="keyword">true</span>;
<a name="l00529"></a>00529  
<a name="l00580"></a><a class="code" href="class_c_m_my_s_q_l.html#aea88b9053bc4fbad1bee6e82e3c6198e">00580</a>  <span class="keyword">public</span> function <a class="code" href="class_c_m_my_s_q_l.html#aea88b9053bc4fbad1bee6e82e3c6198e" title="Connect to a MySQL database.">CMMySQL</a>($uri, $a = <span class="keyword">false</span>) {
<a name="l00581"></a>00581   <span class="comment">// $a must be an array</span>
<a name="l00582"></a>00582   <span class="keywordflow">if</span>(!is_array($a))
<a name="l00583"></a>00583    $a = array($a =&gt; <span class="keyword">true</span>);
<a name="l00584"></a>00584    
<a name="l00585"></a>00585   <span class="comment">// set error stack</span>
<a name="l00586"></a>00586   <span class="keywordflow">if</span>(isset($a[<span class="stringliteral">&#39;error&#39;</span>]))
<a name="l00587"></a>00587    $this-&gt;<a class="code" href="class_c_m_error.html#a2c7cba178b8b7c609e99d9b308ead7f6" title="Redirect the errors to a different stack.">useErrorStack</a>($a[<span class="stringliteral">&#39;error&#39;</span>]);
<a name="l00588"></a>00588   
<a name="l00589"></a>00589   <span class="comment">// dissect the URI</span>
<a name="l00590"></a>00590   $v = parse_url($uri);
<a name="l00591"></a>00591   $v[<span class="stringliteral">&#39;db&#39;</span>] = basename($v[<span class="stringliteral">&#39;path&#39;</span>]);
<a name="l00592"></a>00592   <span class="keywordflow">if</span>(!isset($v[<span class="stringliteral">&#39;port&#39;</span>]))
<a name="l00593"></a>00593    $v[<span class="stringliteral">&#39;port&#39;</span>] = 3306;
<a name="l00594"></a>00594   
<a name="l00595"></a>00595   <span class="comment">// make sure the scheme is valid</span>
<a name="l00596"></a>00596   <span class="keywordflow">if</span>($v[<span class="stringliteral">&#39;scheme&#39;</span>] != <span class="stringliteral">&#39;mysql&#39;</span>) {
<a name="l00597"></a>00597    $this-&gt;<a class="code" href="class_c_m_error.html#a94a6cd26c794c35133502471eca8469e" title="Throw a Error level message.">throwError</a>(<span class="stringliteral">&quot;Unsupported driver &#39;{$v[&#39;scheme&#39;]}&#39;&quot;</span>);
<a name="l00598"></a>00598    <span class="keywordflow">return</span> $this;
<a name="l00599"></a>00599   }
<a name="l00600"></a>00600   
<a name="l00601"></a>00601   <span class="comment">// attempt to connect</span>
<a name="l00602"></a>00602   <span class="keywordflow">if</span>(class_exists(<span class="stringliteral">&#39;mysqli&#39;</span>)) {
<a name="l00603"></a>00603    $this-&gt;driver = <span class="stringliteral">&#39;mysqli&#39;</span>;
<a name="l00604"></a>00604    
<a name="l00605"></a>00605    $this-&gt;dbh = @<span class="keyword">new</span> mysqli($v[<span class="stringliteral">&#39;host&#39;</span>], $v[<span class="stringliteral">&#39;user&#39;</span>], $v[<span class="stringliteral">&#39;pass&#39;</span>], $v[<span class="stringliteral">&#39;db&#39;</span>], $v[<span class="stringliteral">&#39;port&#39;</span>]);
<a name="l00606"></a>00606    <span class="keywordflow">if</span>($this-&gt;dbh-&gt;connect_error) {
<a name="l00607"></a>00607     $this-&gt;dbh = <span class="keyword">false</span>;
<a name="l00608"></a>00608     $this-&gt;<a class="code" href="class_c_m_error.html#a94a6cd26c794c35133502471eca8469e" title="Throw a Error level message.">throwError</a>(<span class="stringliteral">&quot;Unable to connect via MySQLi&quot;</span>,
<a name="l00609"></a>00609       array(<span class="stringliteral">&#39;number&#39;</span> =&gt; $this-&gt;dbh-&gt;connect_errno, <span class="stringliteral">&#39;message&#39;</span> =&gt; $this-&gt;dbh-&gt;connect_error));
<a name="l00610"></a>00610     <span class="keywordflow">return</span> $this;
<a name="l00611"></a>00611    }
<a name="l00612"></a>00612   } <span class="keywordflow">else</span> {
<a name="l00613"></a>00613    <span class="comment">// we have to use the old mysql driver</span>
<a name="l00614"></a>00614    $this-&gt;driver = <span class="stringliteral">&#39;mysql&#39;</span>;
<a name="l00615"></a>00615    
<a name="l00616"></a>00616    $this-&gt;dbh = @mysql_connect($v[<span class="stringliteral">&#39;host&#39;</span>] . <span class="charliteral">&#39;:&#39;</span> . $v[<span class="stringliteral">&#39;port&#39;</span>], $v[<span class="stringliteral">&#39;user&#39;</span>], $v[<span class="stringliteral">&#39;pass&#39;</span>]);
<a name="l00617"></a>00617    <span class="keywordflow">if</span>(!$this-&gt;dbh) {
<a name="l00618"></a>00618     $this-&gt;dbh = <span class="keyword">false</span>;
<a name="l00619"></a>00619     $this-&gt;<a class="code" href="class_c_m_error.html#a94a6cd26c794c35133502471eca8469e" title="Throw a Error level message.">throwError</a>($this-&gt;dbh-&gt;connect_error,
<a name="l00620"></a>00620       array(<span class="stringliteral">&#39;number&#39;</span> =&gt; $this-&gt;dbh-&gt;connect_errno, <span class="stringliteral">&#39;message&#39;</span> =&gt; $this-&gt;dbh-&gt;connect_error));
<a name="l00621"></a>00621     <span class="keywordflow">return</span> $this;
<a name="l00622"></a>00622    }
<a name="l00623"></a>00623    
<a name="l00624"></a>00624    <span class="keywordflow">if</span>(!@mysql_select_db($v[<span class="stringliteral">&#39;db&#39;</span>])) {
<a name="l00625"></a>00625     $this-&gt;<a class="code" href="class_c_m_error.html#a94a6cd26c794c35133502471eca8469e" title="Throw a Error level message.">throwError</a>($this-&gt;dbh-&gt;connect_error,
<a name="l00626"></a>00626       array(<span class="stringliteral">&#39;number&#39;</span> =&gt; $this-&gt;dbh-&gt;connect_errno, <span class="stringliteral">&#39;message&#39;</span> =&gt; $this-&gt;dbh-&gt;connect_error));
<a name="l00627"></a>00627     <span class="keywordflow">return</span> $this;
<a name="l00628"></a>00628    }
<a name="l00629"></a>00629   }
<a name="l00630"></a>00630  }
<a name="l00631"></a>00631  
<a name="l00658"></a><a class="code" href="class_c_m_my_s_q_l.html#a4ced4e9cc5497c475c2cd1a03318f45a">00658</a>  <span class="keyword">public</span> function <a class="code" href="class_c_m_my_s_q_l.html#a4ced4e9cc5497c475c2cd1a03318f45a" title="Perform a query on the database that returns a handle to iterate the results.">query</a>($sql, $values = <span class="keyword">false</span>, $a = <span class="keyword">false</span>) {
<a name="l00659"></a>00659   <span class="comment">// $a must be an array</span>
<a name="l00660"></a>00660   <span class="keywordflow">if</span>(!is_array($a))
<a name="l00661"></a>00661    $a = array();
<a name="l00662"></a>00662   <span class="keywordflow">if</span>(!isset($a[<span class="stringliteral">&#39;execute&#39;</span>]))
<a name="l00663"></a>00663    $a[<span class="stringliteral">&#39;execute&#39;</span>] = <span class="keyword">true</span>;
<a name="l00664"></a>00664   
<a name="l00665"></a>00665   <span class="comment">// bind values</span>
<a name="l00666"></a>00666   $sql = $this-&gt;<a class="code" href="class_c_m_my_s_q_l.html#a08895ad5ecec3e9850ebe052b020d928" title="Internal use for binding value in SQL statements.">bindValues</a>($sql, $values);
<a name="l00667"></a>00667   
<a name="l00668"></a>00668   <span class="keywordflow">if</span>(isset($a[<span class="stringliteral">&#39;print&#39;</span>]))
<a name="l00669"></a>00669    echo $sql;
<a name="l00670"></a>00670   
<a name="l00671"></a>00671   <span class="keywordflow">if</span>($a[<span class="stringliteral">&#39;execute&#39;</span>]) {
<a name="l00672"></a>00672    <span class="keywordflow">if</span>($this-&gt;driver == <span class="stringliteral">&#39;mysqli&#39;</span>)
<a name="l00673"></a>00673     $r = @$this-&gt;dbh-&gt;query($sql);
<a name="l00674"></a>00674    <span class="keywordflow">else</span> $r = mysql_query($sql, $this-&gt;dbh);
<a name="l00675"></a>00675   }
<a name="l00676"></a>00676    
<a name="l00677"></a>00677   <span class="keywordflow">if</span>(!$r) {
<a name="l00678"></a>00678    $this-&gt;<a class="code" href="class_c_m_error.html#a6d110c63a1c5103df7979612ed5209d3" title="Throw a Warning level message.">throwWarning</a>(<span class="stringliteral">&quot;Query failed&quot;</span>, array(<span class="stringliteral">&#39;sql&#39;</span> =&gt; $sql));
<a name="l00679"></a>00679    <span class="keywordflow">return</span> <span class="keyword">new</span> <a class="code" href="class_c_m_my_s_q_l_query.html" title="MySQL query handle.">CMMySQLQuery</a>($r, 0, $this-&gt;driver, $a);
<a name="l00680"></a>00680   }
<a name="l00681"></a>00681   
<a name="l00682"></a>00682   <span class="keywordflow">if</span>(isset($a[<span class="stringliteral">&#39;return&#39;</span>]))
<a name="l00683"></a>00683    <span class="keywordflow">return</span> $sql;
<a name="l00684"></a>00684   <span class="keywordflow">return</span> <span class="keyword">new</span> <a class="code" href="class_c_m_my_s_q_l_query.html" title="MySQL query handle.">CMMySQLQuery</a>($r, $this-&gt;dbh-&gt;affected_rows, $this-&gt;driver, $a);
<a name="l00685"></a>00685  }
<a name="l00686"></a>00686  
<a name="l00697"></a><a class="code" href="class_c_m_my_s_q_l.html#a13148537025768f2373012227785c540">00697</a>  <span class="keyword">public</span> function <a class="code" href="class_c_m_my_s_q_l.html#a13148537025768f2373012227785c540" title="Perform a query on the database that does not return a handle.">execute</a>($sql, $values = <span class="keyword">false</span>, $a = <span class="keyword">false</span>) {
<a name="l00698"></a>00698   $q = $this-&gt;<a class="code" href="class_c_m_my_s_q_l.html#a4ced4e9cc5497c475c2cd1a03318f45a" title="Perform a query on the database that returns a handle to iterate the results.">query</a>($sql, $values, $a);
<a name="l00699"></a>00699   <span class="keywordflow">return</span> $q-&gt;success();
<a name="l00700"></a>00700  }
<a name="l00701"></a>00701  
<a name="l00723"></a><a class="code" href="class_c_m_my_s_q_l.html#a6502927265740994ba9898d919f17cdd">00723</a>  <span class="keyword">public</span> function <a class="code" href="class_c_m_my_s_q_l.html#a6502927265740994ba9898d919f17cdd" title="MySQL INSERT.">insert</a>($tableName, $kv = <span class="keyword">false</span>, $a = <span class="keyword">false</span>) {
<a name="l00724"></a>00724   <span class="comment">// $a must be an array</span>
<a name="l00725"></a>00725   <span class="keywordflow">if</span>(!is_array($a))
<a name="l00726"></a>00726    $a = array();
<a name="l00727"></a>00727   
<a name="l00728"></a>00728   $sql = <span class="stringliteral">&quot;insert into `$tableName` (&quot;</span> . implode(<span class="charliteral">&#39;,&#39;</span>, array_keys($kv)) . <span class="stringliteral">&quot;) values (&quot;</span>;
<a name="l00729"></a>00729   $first = <span class="keyword">true</span>;
<a name="l00730"></a>00730   <span class="keywordflow">foreach</span>($kv as $k =&gt; $v) {
<a name="l00731"></a>00731    <span class="keywordflow">if</span>(!$first) $sql .= <span class="stringliteral">&quot;,&quot;</span>;
<a name="l00732"></a>00732    
<a name="l00733"></a>00733    <span class="comment">// if its a CMConstant we don&#39;t encapsulate it</span>
<a name="l00734"></a>00734    <span class="keywordflow">if</span>($v instanceof <a class="code" href="class_c_m_constant.html" title="A container for value that need not be modified or encapsulated.">CMConstant</a> || $v instanceof <a class="code" href="class_c_m_decimal.html" title="Handling exact values.">CMDecimal</a>)
<a name="l00735"></a>00735     $sql .= $v;
<a name="l00736"></a>00736    <span class="keywordflow">else</span>
<a name="l00737"></a>00737     $sql .= <span class="stringliteral">&quot;&#39;&quot;</span> . mysql_real_escape_string($v) . <span class="stringliteral">&quot;&#39;&quot;</span>;
<a name="l00738"></a>00738    
<a name="l00739"></a>00739    $first = <span class="keyword">false</span>;
<a name="l00740"></a>00740   }
<a name="l00741"></a>00741   
<a name="l00742"></a>00742   <span class="keywordflow">if</span>(isset($a[<span class="stringliteral">&#39;print&#39;</span>]))
<a name="l00743"></a>00743    echo <span class="stringliteral">&quot;$sql)&quot;</span>;
<a name="l00744"></a>00744   
<a name="l00745"></a>00745   <span class="keywordflow">if</span>($this-&gt;driver == <span class="stringliteral">&#39;mysqli&#39;</span>) {
<a name="l00746"></a>00746    <span class="keywordflow">if</span>(!$this-&gt;dbh) {
<a name="l00747"></a>00747     $this-&gt;<a class="code" href="class_c_m_error.html#a6d110c63a1c5103df7979612ed5209d3" title="Throw a Warning level message.">throwWarning</a>(<span class="stringliteral">&quot;No valid database handle&quot;</span>);
<a name="l00748"></a>00748     <span class="keywordflow">return</span> 0;
<a name="l00749"></a>00749    }
<a name="l00750"></a>00750    
<a name="l00751"></a>00751    $q = $this-&gt;dbh-&gt;prepare(<span class="stringliteral">&quot;$sql)&quot;</span>);
<a name="l00752"></a>00752    <span class="keywordflow">if</span>($q) {
<a name="l00753"></a>00753     $q-&gt;execute();
<a name="l00754"></a>00754     <span class="keywordflow">return</span> $this-&gt;<a class="code" href="class_c_m_my_s_q_l.html#a4ced4e9cc5497c475c2cd1a03318f45a" title="Perform a query on the database that returns a handle to iterate the results.">query</a>(<span class="stringliteral">&quot;select last_insert_id()&quot;</span>, <span class="keyword">false</span>, $a)-&gt;fetch(<span class="stringliteral">&#39;cell&#39;</span>);
<a name="l00755"></a>00755    }
<a name="l00756"></a>00756    $this-&gt;<a class="code" href="class_c_m_error.html#a6d110c63a1c5103df7979612ed5209d3" title="Throw a Warning level message.">throwWarning</a>(<span class="stringliteral">&quot;INSERT failed&quot;</span>, array(<span class="stringliteral">&#39;sql&#39;</span> =&gt; <span class="stringliteral">&quot;$sql)&quot;</span>));
<a name="l00757"></a>00757    <span class="keywordflow">return</span> 0;
<a name="l00758"></a>00758   }
<a name="l00759"></a>00759   
<a name="l00760"></a>00760   $q = mysql_query(<span class="stringliteral">&quot;$sql)&quot;</span>, $this-&gt;dbh);
<a name="l00761"></a>00761   <span class="keywordflow">if</span>($q)
<a name="l00762"></a>00762    <span class="keywordflow">return</span> $this-&gt;<a class="code" href="class_c_m_my_s_q_l.html#a4ced4e9cc5497c475c2cd1a03318f45a" title="Perform a query on the database that returns a handle to iterate the results.">query</a>(<span class="stringliteral">&quot;select last_insert_id()&quot;</span>, <span class="keyword">false</span>, $a)-&gt;fetch(<span class="stringliteral">&#39;cell&#39;</span>);
<a name="l00763"></a>00763   
<a name="l00764"></a>00764   $this-&gt;<a class="code" href="class_c_m_error.html#a6d110c63a1c5103df7979612ed5209d3" title="Throw a Warning level message.">throwWarning</a>(<span class="stringliteral">&quot;INSERT failed&quot;</span>, array(<span class="stringliteral">&#39;sql&#39;</span> =&gt; <span class="stringliteral">&quot;$sql)&quot;</span>));
<a name="l00765"></a>00765   <span class="keywordflow">return</span> 0;
<a name="l00766"></a>00766  }
<a name="l00767"></a>00767  
<a name="l00781"></a><a class="code" href="class_c_m_my_s_q_l.html#a954293cf1be476b5009caa10ac71dfb2">00781</a>  <span class="keyword">public</span> function <a class="code" href="class_c_m_my_s_q_l.html#a954293cf1be476b5009caa10ac71dfb2" title="Change the active database.">selectDatabase</a>($dbname, $a = <span class="keyword">false</span>) {
<a name="l00782"></a>00782   <span class="keywordflow">if</span>($this-&gt;driver == <span class="stringliteral">&#39;mysqli&#39;</span>)
<a name="l00783"></a>00783    <span class="keywordflow">return</span> $this-&gt;dbh-&gt;select_db($dbname);
<a name="l00784"></a>00784   <span class="keywordflow">return</span> mysql_select_db($dbname, $this-&gt;dbh);
<a name="l00785"></a>00785  }
<a name="l00786"></a>00786  
<a name="l00806"></a><a class="code" href="class_c_m_my_s_q_l.html#a08895ad5ecec3e9850ebe052b020d928">00806</a>  <span class="keyword">public</span> function <a class="code" href="class_c_m_my_s_q_l.html#a08895ad5ecec3e9850ebe052b020d928" title="Internal use for binding value in SQL statements.">bindValues</a>($sql, $values = <span class="keyword">false</span>) {
<a name="l00807"></a>00807   <span class="keywordflow">if</span>(is_array($values)) {
<a name="l00808"></a>00808    $parts = explode(<span class="charliteral">&#39;?&#39;</span>, $sql);
<a name="l00809"></a>00809    $new_sql = <span class="stringliteral">&quot;&quot;</span>;
<a name="l00810"></a>00810    <span class="keywordflow">for</span>($i = 0; $i &lt; count($parts) - 1; ++$i) {
<a name="l00811"></a>00811     <span class="comment">// if its a CMConstant we don&#39;t encapsulate it</span>
<a name="l00812"></a>00812     <span class="keywordflow">if</span>($values[$i] instanceof <a class="code" href="class_c_m_constant.html" title="A container for value that need not be modified or encapsulated.">CMConstant</a> || $values[$i] instanceof <a class="code" href="class_c_m_decimal.html" title="Handling exact values.">CMDecimal</a>)
<a name="l00813"></a>00813      $new_sql .= $parts[$i] . $values[$i];
<a name="l00814"></a>00814     <span class="keywordflow">else</span> {
<a name="l00815"></a>00815      <span class="keywordflow">if</span>($this-&gt;driver == <span class="stringliteral">&#39;mysqli&#39;</span>)
<a name="l00816"></a>00816       $new_sql .= $parts[$i] . <span class="stringliteral">&quot;&#39;&quot;</span> . $this-&gt;dbh-&gt;real_escape_string($values[$i]) . <span class="stringliteral">&quot;&#39;&quot;</span>;
<a name="l00817"></a>00817      <span class="keywordflow">else</span>
<a name="l00818"></a>00818       $new_sql .= $parts[$i] . <span class="stringliteral">&quot;&#39;&quot;</span> . mysql_real_escape_string($values[$i]) . <span class="stringliteral">&quot;&#39;&quot;</span>;
<a name="l00819"></a>00819     }
<a name="l00820"></a>00820    }
<a name="l00821"></a>00821    $sql = $new_sql . $parts[count($parts) - 1];
<a name="l00822"></a>00822   } elseif($values !== <span class="keyword">false</span>) {
<a name="l00823"></a>00823    <span class="comment">// if its a CMConstant we don&#39;t encapsulate it</span>
<a name="l00824"></a>00824    <span class="keywordflow">if</span>($values[$i] instanceof <a class="code" href="class_c_m_constant.html" title="A container for value that need not be modified or encapsulated.">CMConstant</a> || $values[$i] instanceof <a class="code" href="class_c_m_decimal.html" title="Handling exact values.">CMDecimal</a>)
<a name="l00825"></a>00825     $sql = str_replace(<span class="charliteral">&#39;?&#39;</span>, $values, $sql);
<a name="l00826"></a>00826    <span class="keywordflow">else</span> {
<a name="l00827"></a>00827     <span class="keywordflow">if</span>($this-&gt;driver == <span class="stringliteral">&#39;mysqli&#39;</span>)
<a name="l00828"></a>00828      $sql = str_replace(<span class="charliteral">&#39;?&#39;</span>, <span class="stringliteral">&quot;&#39;&quot;</span> . $this-&gt;dbh-&gt;real_escape_string($values) . <span class="stringliteral">&quot;&#39;&quot;</span>, $sql);
<a name="l00829"></a>00829     <span class="keywordflow">else</span>
<a name="l00830"></a>00830      $sql = str_replace(<span class="charliteral">&#39;?&#39;</span>, <span class="stringliteral">&quot;&#39;&quot;</span> . mysql_real_escape_string($values) . <span class="stringliteral">&quot;&#39;&quot;</span>, $sql);
<a name="l00831"></a>00831    }
<a name="l00832"></a>00832   }
<a name="l00833"></a>00833    
<a name="l00834"></a>00834   <span class="keywordflow">return</span> $sql;
<a name="l00835"></a>00835  }
<a name="l00836"></a>00836  
<a name="l00842"></a><a class="code" href="class_c_m_my_s_q_l.html#a36b890fb5812fc1247b8afe7d56e72ea">00842</a>  <span class="keyword">public</span> function <a class="code" href="class_c_m_my_s_q_l.html#a36b890fb5812fc1247b8afe7d56e72ea" title="Fetch the list of tables in the active database.">getTableNames</a>($schema = <span class="keyword">false</span>) {
<a name="l00843"></a>00843   <span class="keywordflow">return</span> $this-&gt;<a class="code" href="class_c_m_my_s_q_l.html#a4ced4e9cc5497c475c2cd1a03318f45a" title="Perform a query on the database that returns a handle to iterate the results.">query</a>(<span class="stringliteral">&quot;show tables&quot;</span>)-&gt;fetchAll(<span class="stringliteral">&#39;cell&#39;</span>, <span class="stringliteral">&#39;vertical&#39;</span>);
<a name="l00844"></a>00844  }
<a name="l00845"></a>00845  
<a name="l00851"></a><a class="code" href="class_c_m_my_s_q_l.html#ae7cdaa744d52a1eb0103e377023ca528">00851</a>  <span class="keyword">public</span> function <a class="code" href="class_c_m_my_s_q_l.html#ae7cdaa744d52a1eb0103e377023ca528" title="Returns true or false for the selected database.">tableExists</a>($table) {
<a name="l00852"></a>00852   $q = $this-&gt;<a class="code" href="class_c_m_my_s_q_l.html#a4ced4e9cc5497c475c2cd1a03318f45a" title="Perform a query on the database that returns a handle to iterate the results.">query</a>(<span class="stringliteral">&quot;show tables&quot;</span>);
<a name="l00853"></a>00853   <span class="keywordflow">while</span>($r = $q-&gt;fetch(<span class="stringliteral">&#39;line&#39;</span>)) {
<a name="l00854"></a>00854    <span class="keywordflow">if</span>($r[0] == $table)
<a name="l00855"></a>00855     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00856"></a>00856   }
<a name="l00857"></a>00857   <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00858"></a>00858  }
<a name="l00859"></a>00859  
<a name="l00865"></a><a class="code" href="class_c_m_my_s_q_l.html#aea9c1153e0e0fc135f8d513263bf9201">00865</a>  <span class="keyword">public</span> function <a class="code" href="class_c_m_my_s_q_l.html#aea9c1153e0e0fc135f8d513263bf9201" title="Get database names.">getDatabaseNames</a>() {
<a name="l00866"></a>00866   <span class="keywordflow">return</span> $this-&gt;<a class="code" href="class_c_m_my_s_q_l.html#a4ced4e9cc5497c475c2cd1a03318f45a" title="Perform a query on the database that returns a handle to iterate the results.">query</a>(<span class="stringliteral">&quot;show databases&quot;</span>)-&gt;fetchAll(<span class="stringliteral">&#39;line&#39;</span>, <span class="stringliteral">&#39;vertical&#39;</span>);
<a name="l00867"></a>00867  }
<a name="l00868"></a>00868 
<a name="l00877"></a><a class="code" href="class_c_m_my_s_q_l.html#a7cf4f2839a152f2c11f5893c640c19dd">00877</a>  <span class="keyword">public</span> function <a class="code" href="class_c_m_my_s_q_l.html#a7cf4f2839a152f2c11f5893c640c19dd" title="Get database names.">getSchemaNames</a>() {
<a name="l00878"></a>00878   <span class="keywordflow">return</span> $this-&gt;<a class="code" href="class_c_m_my_s_q_l.html#aea9c1153e0e0fc135f8d513263bf9201" title="Get database names.">getDatabaseNames</a>();
<a name="l00879"></a>00879  }
<a name="l00880"></a>00880  
<a name="l00891"></a><a class="code" href="class_c_m_my_s_q_l.html#aa45cf2b82a91150a11cd11fa0bf2847c">00891</a>  <span class="keyword">public</span> function <a class="code" href="class_c_m_my_s_q_l.html#aa45cf2b82a91150a11cd11fa0bf2847c" title="Get available protocol methods.">availableMethods</a>() {
<a name="l00892"></a>00892   <span class="keywordflow">if</span>($this-&gt;driver == <span class="stringliteral">&#39;mysqli&#39;</span>)
<a name="l00893"></a>00893    <span class="keywordflow">return</span> array(<span class="stringliteral">&#39;query&#39;</span>, <span class="stringliteral">&#39;execute&#39;</span>, <span class="stringliteral">&#39;insert&#39;</span>, <span class="stringliteral">&#39;selectDatabase&#39;</span>,
<a name="l00894"></a>00894                 <span class="stringliteral">&#39;getTableNames&#39;</span>, <span class="stringliteral">&#39;tableExists&#39;</span>, <span class="stringliteral">&#39;getDatabaseNames&#39;</span>,
<a name="l00895"></a>00895                 <span class="stringliteral">&#39;getSchemaNames&#39;</span>, <span class="stringliteral">&#39;isConnected&#39;</span>, <span class="stringliteral">&#39;disconnect&#39;</span>,
<a name="l00896"></a>00896                 <span class="stringliteral">&#39;getClientVersion&#39;</span>, <span class="stringliteral">&#39;getServerVersion&#39;</span>, <span class="stringliteral">&#39;getClientInfo&#39;</span>,
<a name="l00897"></a>00897                 <span class="stringliteral">&#39;getHostInfo&#39;</span>, <span class="stringliteral">&#39;getServerInfo&#39;</span>, <span class="stringliteral">&#39;getProtocolVersion&#39;</span>,
<a name="l00898"></a>00898                 <span class="stringliteral">&#39;getLastInsertID&#39;</span>, <span class="stringliteral">&#39;setAutoCommit&#39;</span>, <span class="stringliteral">&#39;changeUser&#39;</span>,
<a name="l00899"></a>00899                 <span class="stringliteral">&#39;getCharacterSetName&#39;</span>, <span class="stringliteral">&#39;getCharacterSet&#39;</span>, <span class="stringliteral">&#39;commit&#39;</span>,
<a name="l00900"></a>00900                 <span class="stringliteral">&#39;getConnectionStatistics&#39;</span>, <span class="stringliteral">&#39;getWarnings&#39;</span>, <span class="stringliteral">&#39;killThread&#39;</span>,
<a name="l00901"></a>00901                 <span class="stringliteral">&#39;setOption&#39;</span>, <span class="stringliteral">&#39;ping&#39;</span>, <span class="stringliteral">&#39;escapeString&#39;</span>, <span class="stringliteral">&#39;rollback&#39;</span>,
<a name="l00902"></a>00902                 <span class="stringliteral">&#39;setCharacterSet&#39;</span>, <span class="stringliteral">&#39;setLocalInfileDefault&#39;</span>,
<a name="l00903"></a>00903                 <span class="stringliteral">&#39;setLocalInfileHandler&#39;</span>, <span class="stringliteral">&#39;SQLState&#39;</span>, <span class="stringliteral">&#39;getStatus&#39;</span>,
<a name="l00904"></a>00904                 <span class="stringliteral">&#39;getThreadID&#39;</span>, <span class="stringliteral">&#39;isThreadSafe&#39;</span>, <span class="stringliteral">&#39;getWarningCount&#39;</span>,
<a name="l00905"></a>00905                 <span class="stringliteral">&#39;engine&#39;</span>, <span class="stringliteral">&#39;eraseTable&#39;</span>, <span class="stringliteral">&#39;truncateTable&#39;</span>, <span class="stringliteral">&#39;update&#39;</span>,
<a name="l00906"></a>00906                 <span class="stringliteral">&#39;delete&#39;</span>, <span class="stringliteral">&#39;getAutoCommit&#39;</span>);
<a name="l00907"></a>00907    
<a name="l00908"></a>00908   <span class="keywordflow">return</span> array(<span class="stringliteral">&#39;query&#39;</span>, <span class="stringliteral">&#39;execute&#39;</span>, <span class="stringliteral">&#39;insert&#39;</span>, <span class="stringliteral">&#39;selectDatabase&#39;</span>,
<a name="l00909"></a>00909                <span class="stringliteral">&#39;getTableNames&#39;</span>, <span class="stringliteral">&#39;tableExists&#39;</span>, <span class="stringliteral">&#39;getDatabaseNames&#39;</span>,
<a name="l00910"></a>00910                <span class="stringliteral">&#39;getSchemaNames&#39;</span>, <span class="stringliteral">&#39;isConnected&#39;</span>, <span class="stringliteral">&#39;disconnect&#39;</span>,
<a name="l00911"></a>00911                <span class="stringliteral">&#39;getLastInsertID&#39;</span>, <span class="stringliteral">&#39;ping&#39;</span>, <span class="stringliteral">&#39;escapeString&#39;</span>, <span class="stringliteral">&#39;engine&#39;</span>,
<a name="l00912"></a>00912                <span class="stringliteral">&#39;eraseTable&#39;</span>, <span class="stringliteral">&#39;truncateTable&#39;</span>, <span class="stringliteral">&#39;update&#39;</span>, <span class="stringliteral">&#39;delete&#39;</span>,
<a name="l00913"></a>00913                <span class="stringliteral">&#39;getAutoCommit&#39;</span>);
<a name="l00914"></a>00914  }
<a name="l00915"></a>00915  
<a name="l00921"></a><a class="code" href="class_c_m_my_s_q_l.html#af160f7fbbf281d018ae3162521b8267d">00921</a>  <span class="keyword">public</span> function <a class="code" href="class_c_m_my_s_q_l.html#af160f7fbbf281d018ae3162521b8267d" title="Check if the database handle is valid.">isConnected</a>() {
<a name="l00922"></a>00922   <span class="keywordflow">return</span> $this-&gt;dbh !== <span class="keyword">false</span>;
<a name="l00923"></a>00923  }
<a name="l00924"></a>00924  
<a name="l00928"></a><a class="code" href="class_c_m_my_s_q_l.html#abe175fcf658475bc56e9d6fa02bc88ec">00928</a>  <span class="keyword">public</span> function <a class="code" href="class_c_m_my_s_q_l.html#abe175fcf658475bc56e9d6fa02bc88ec" title="Disconnect database handle.">disconnect</a>() {
<a name="l00929"></a>00929   <span class="keywordflow">if</span>($this-&gt;driver == <span class="stringliteral">&#39;mysqli&#39;</span>)
<a name="l00930"></a>00930    <span class="keywordflow">return</span> $this-&gt;dbh-&gt;close();
<a name="l00931"></a>00931   <span class="keywordflow">return</span> mysql_close($this-&gt;dbh);
<a name="l00932"></a>00932  }
<a name="l00933"></a>00933  
<a name="l00946"></a><a class="code" href="class_c_m_my_s_q_l.html#acc8b801086cef69cbf92b77ee7434be0">00946</a>  <span class="keyword">public</span> function <a class="code" href="class_c_m_my_s_q_l.html#acc8b801086cef69cbf92b77ee7434be0" title="Get MySQL client info.">getClientVersion</a>() {
<a name="l00947"></a>00947   <span class="keywordflow">if</span>($this-&gt;driver == <span class="stringliteral">&#39;mysqli&#39;</span>)
<a name="l00948"></a>00948    <span class="keywordflow">return</span> $this-&gt;dbh-&gt;client_version;
<a name="l00949"></a>00949   <span class="keywordflow">return</span> $this-&gt;<a class="code" href="class_c_m_error.html#a23e9a4ce8ebfa6819c03be92539a0fd6" title="Throw an Unavailable level message.">throwUnavailable</a>(<span class="stringliteral">&quot;Only available with MySQLi&quot;</span>);
<a name="l00950"></a>00950  }
<a name="l00951"></a>00951  
<a name="l00964"></a><a class="code" href="class_c_m_my_s_q_l.html#a2d047b148eb053baba2150cc7d5d9545">00964</a>  <span class="keyword">public</span> function <a class="code" href="class_c_m_my_s_q_l.html#a2d047b148eb053baba2150cc7d5d9545" title="Returns the version of the MySQL server as an integer.">getServerVersion</a>() {
<a name="l00965"></a>00965   <span class="keywordflow">if</span>($this-&gt;driver == <span class="stringliteral">&#39;mysqli&#39;</span>)
<a name="l00966"></a>00966    <span class="keywordflow">return</span> $this-&gt;dbh-&gt;server_version;
<a name="l00967"></a>00967   <span class="keywordflow">return</span> $this-&gt;<a class="code" href="class_c_m_error.html#a23e9a4ce8ebfa6819c03be92539a0fd6" title="Throw an Unavailable level message.">throwUnavailable</a>(<span class="stringliteral">&quot;Only available with MySQLi&quot;</span>);
<a name="l00968"></a>00968  }
<a name="l00969"></a>00969  
<a name="l00979"></a><a class="code" href="class_c_m_my_s_q_l.html#a20bb97bc69cce20f8ef039edb8e15c7b">00979</a>  <span class="keyword">public</span> function <a class="code" href="class_c_m_my_s_q_l.html#a20bb97bc69cce20f8ef039edb8e15c7b" title="Returns the MySQL client version as a string.">getClientInfo</a>() {
<a name="l00980"></a>00980   <span class="keywordflow">if</span>($this-&gt;driver == <span class="stringliteral">&#39;mysqli&#39;</span>)
<a name="l00981"></a>00981    <span class="keywordflow">return</span> $this-&gt;dbh-&gt;client_info;
<a name="l00982"></a>00982   <span class="keywordflow">return</span> $this-&gt;<a class="code" href="class_c_m_error.html#a23e9a4ce8ebfa6819c03be92539a0fd6" title="Throw an Unavailable level message.">throwUnavailable</a>(<span class="stringliteral">&quot;Only available with MySQLi&quot;</span>);
<a name="l00983"></a>00983  }
<a name="l00984"></a>00984  
<a name="l00990"></a><a class="code" href="class_c_m_my_s_q_l.html#a822a163c8cecbe8f415a8c0f2857ce39">00990</a>  <span class="keyword">public</span> function <a class="code" href="class_c_m_my_s_q_l.html#a822a163c8cecbe8f415a8c0f2857ce39" title="Host information.">getHostInfo</a>() {
<a name="l00991"></a>00991   <span class="keywordflow">if</span>($this-&gt;driver == <span class="stringliteral">&#39;mysqli&#39;</span>)
<a name="l00992"></a>00992    <span class="keywordflow">return</span> $this-&gt;dbh-&gt;host_info;
<a name="l00993"></a>00993   <span class="keywordflow">return</span> $this-&gt;<a class="code" href="class_c_m_error.html#a23e9a4ce8ebfa6819c03be92539a0fd6" title="Throw an Unavailable level message.">throwUnavailable</a>(<span class="stringliteral">&quot;Only available with MySQLi&quot;</span>);
<a name="l00994"></a>00994  }
<a name="l00995"></a>00995  
<a name="l01001"></a><a class="code" href="class_c_m_my_s_q_l.html#a9ea08ad9cca0630988d6c62d3f0ff672">01001</a>  <span class="keyword">public</span> function <a class="code" href="class_c_m_my_s_q_l.html#a9ea08ad9cca0630988d6c62d3f0ff672" title="Client information.">getServerInfo</a>() {
<a name="l01002"></a>01002   <span class="keywordflow">if</span>($this-&gt;driver == <span class="stringliteral">&#39;mysqli&#39;</span>)
<a name="l01003"></a>01003    <span class="keywordflow">return</span> $this-&gt;dbh-&gt;server_info;
<a name="l01004"></a>01004   <span class="keywordflow">return</span> $this-&gt;<a class="code" href="class_c_m_error.html#a23e9a4ce8ebfa6819c03be92539a0fd6" title="Throw an Unavailable level message.">throwUnavailable</a>(<span class="stringliteral">&quot;Only available with MySQLi&quot;</span>);
<a name="l01005"></a>01005  }
<a name="l01006"></a>01006  
<a name="l01012"></a><a class="code" href="class_c_m_my_s_q_l.html#a915c3328b367338a7c0eddb1e3294e9a">01012</a>  <span class="keyword">public</span> function <a class="code" href="class_c_m_my_s_q_l.html#a915c3328b367338a7c0eddb1e3294e9a" title="Protocol version.">getProtocolVersion</a>() {
<a name="l01013"></a>01013   <span class="keywordflow">if</span>($this-&gt;driver == <span class="stringliteral">&#39;mysqli&#39;</span>)
<a name="l01014"></a>01014    <span class="keywordflow">return</span> $this-&gt;dbh-&gt;protocol_version;
<a name="l01015"></a>01015   <span class="keywordflow">return</span> $this-&gt;<a class="code" href="class_c_m_error.html#a23e9a4ce8ebfa6819c03be92539a0fd6" title="Throw an Unavailable level message.">throwUnavailable</a>(<span class="stringliteral">&quot;Only available with MySQLi&quot;</span>);
<a name="l01016"></a>01016  }
<a name="l01017"></a>01017  
<a name="l01025"></a><a class="code" href="class_c_m_my_s_q_l.html#afd1c56cdadff97f9d86095f745e95658">01025</a>  <span class="keyword">public</span> function <a class="code" href="class_c_m_my_s_q_l.html#afd1c56cdadff97f9d86095f745e95658" title="Last insert ID.">getLastInsertID</a>() {
<a name="l01026"></a>01026   <span class="keywordflow">if</span>($this-&gt;driver == <span class="stringliteral">&#39;mysqli&#39;</span>)
<a name="l01027"></a>01027    <span class="keywordflow">return</span> $this-&gt;dbh-&gt;insert_id;
<a name="l01028"></a>01028   <span class="keywordflow">return</span> mysql_insert_id($this-&gt;dbh);
<a name="l01029"></a>01029  }
<a name="l01030"></a>01030  
<a name="l01044"></a><a class="code" href="class_c_m_my_s_q_l.html#af569120fcd4d04f33780d9c10daf144c">01044</a>  <span class="keyword">public</span> function <a class="code" href="class_c_m_my_s_q_l.html#af569120fcd4d04f33780d9c10daf144c" title="Turn on/off auto commit.">setAutoCommit</a>($mode = <span class="keyword">false</span>) {
<a name="l01045"></a>01045   $this-&gt;autoCommit = $mode;
<a name="l01046"></a>01046   <span class="keywordflow">if</span>($this-&gt;driver == <span class="stringliteral">&#39;mysqli&#39;</span>)
<a name="l01047"></a>01047    <span class="keywordflow">return</span> $this-&gt;dbh-&gt;autocommit($mode);
<a name="l01048"></a>01048   <span class="keywordflow">return</span> $this-&gt;<a class="code" href="class_c_m_error.html#a23e9a4ce8ebfa6819c03be92539a0fd6" title="Throw an Unavailable level message.">throwUnavailable</a>(<span class="stringliteral">&quot;Only available with MySQLi&quot;</span>);
<a name="l01049"></a>01049  }
<a name="l01050"></a>01050  
<a name="l01060"></a><a class="code" href="class_c_m_my_s_q_l.html#ad4d20a51971e7855e1242afdbf58c6c6">01060</a>  <span class="keyword">public</span> function <a class="code" href="class_c_m_my_s_q_l.html#ad4d20a51971e7855e1242afdbf58c6c6" title="Change user.">changeUser</a>($user, $password, $database) {
<a name="l01061"></a>01061   <span class="keywordflow">if</span>($this-&gt;driver == <span class="stringliteral">&#39;mysqli&#39;</span>)
<a name="l01062"></a>01062    <span class="keywordflow">return</span> $this-&gt;dbh-&gt;change_user($user, $password, $database);
<a name="l01063"></a>01063   <span class="keywordflow">return</span> $this-&gt;<a class="code" href="class_c_m_error.html#a23e9a4ce8ebfa6819c03be92539a0fd6" title="Throw an Unavailable level message.">throwUnavailable</a>(<span class="stringliteral">&quot;Only available with MySQLi&quot;</span>);
<a name="l01064"></a>01064  }
<a name="l01065"></a>01065  
<a name="l01071"></a><a class="code" href="class_c_m_my_s_q_l.html#a8e29393b9d21b47d9d8b931138001d3b">01071</a>  <span class="keyword">public</span> function <a class="code" href="class_c_m_my_s_q_l.html#a8e29393b9d21b47d9d8b931138001d3b" title="Get the current character set.">getCharacterSetName</a>() {
<a name="l01072"></a>01072   <span class="keywordflow">if</span>($this-&gt;driver == <span class="stringliteral">&#39;mysqli&#39;</span>)
<a name="l01073"></a>01073    <span class="keywordflow">return</span> $this-&gt;dbh-&gt;character_set_name();
<a name="l01074"></a>01074   <span class="keywordflow">return</span> $this-&gt;<a class="code" href="class_c_m_error.html#a23e9a4ce8ebfa6819c03be92539a0fd6" title="Throw an Unavailable level message.">throwUnavailable</a>(<span class="stringliteral">&quot;Only available with MySQLi&quot;</span>);
<a name="l01075"></a>01075  }
<a name="l01076"></a>01076  
<a name="l01082"></a><a class="code" href="class_c_m_my_s_q_l.html#adebb0782f7fc4b2b7feb34284e2f1d6f">01082</a>  <span class="keyword">public</span> function <a class="code" href="class_c_m_my_s_q_l.html#adebb0782f7fc4b2b7feb34284e2f1d6f" title="Returns a character set object.">getCharacterSet</a>() {
<a name="l01083"></a>01083   <span class="keywordflow">if</span>($this-&gt;driver == <span class="stringliteral">&#39;mysqli&#39;</span>)
<a name="l01084"></a>01084    <span class="keywordflow">return</span> $this-&gt;dbh-&gt;get_charset();
<a name="l01085"></a>01085   <span class="keywordflow">return</span> $this-&gt;<a class="code" href="class_c_m_error.html#a23e9a4ce8ebfa6819c03be92539a0fd6" title="Throw an Unavailable level message.">throwUnavailable</a>(<span class="stringliteral">&quot;Only available with MySQLi&quot;</span>);
<a name="l01086"></a>01086  }
<a name="l01087"></a>01087  
<a name="l01103"></a><a class="code" href="class_c_m_my_s_q_l.html#af5674c27d4a92f6228565010eacbb9cb">01103</a>  <span class="keyword">public</span> function <a class="code" href="class_c_m_my_s_q_l.html#af5674c27d4a92f6228565010eacbb9cb" title="Commit transaction.">commit</a>() {
<a name="l01104"></a>01104   <span class="keywordflow">if</span>($this-&gt;driver == <span class="stringliteral">&#39;mysqli&#39;</span>)
<a name="l01105"></a>01105    <span class="keywordflow">return</span> $this-&gt;dbh-&gt;commit();
<a name="l01106"></a>01106   <span class="keywordflow">return</span> $this-&gt;<a class="code" href="class_c_m_error.html#a23e9a4ce8ebfa6819c03be92539a0fd6" title="Throw an Unavailable level message.">throwUnavailable</a>(<span class="stringliteral">&quot;Only available with MySQLi&quot;</span>);
<a name="l01107"></a>01107  }
<a name="l01108"></a>01108  
<a name="l01239"></a><a class="code" href="class_c_m_my_s_q_l.html#af0b6151982de937b1321294efcc313d8">01239</a>  <span class="keyword">public</span> function <a class="code" href="class_c_m_my_s_q_l.html#af0b6151982de937b1321294efcc313d8" title="Get connection statistics.">getConnectionStatistics</a>() {
<a name="l01240"></a>01240   <span class="keywordflow">if</span>($this-&gt;driver == <span class="stringliteral">&#39;mysqli&#39;</span>)
<a name="l01241"></a>01241    <span class="keywordflow">return</span> $this-&gt;dbh-&gt;get_connection_stats();
<a name="l01242"></a>01242   <span class="keywordflow">return</span> $this-&gt;<a class="code" href="class_c_m_error.html#a23e9a4ce8ebfa6819c03be92539a0fd6" title="Throw an Unavailable level message.">throwUnavailable</a>(<span class="stringliteral">&quot;Only available with MySQLi&quot;</span>);
<a name="l01243"></a>01243  }
<a name="l01244"></a>01244  
<a name="l01250"></a><a class="code" href="class_c_m_my_s_q_l.html#adc3b82cf30d1a6f68351b9bbcc88602e">01250</a>  <span class="keyword">public</span> function <a class="code" href="class_c_m_my_s_q_l.html#adc3b82cf30d1a6f68351b9bbcc88602e" title="Get result of SHOW WARNINGS.">getWarnings</a>() {
<a name="l01251"></a>01251   <span class="keywordflow">if</span>($this-&gt;driver == <span class="stringliteral">&#39;mysqli&#39;</span>)
<a name="l01252"></a>01252    <span class="keywordflow">return</span> $this-&gt;dbh-&gt;get_warnings();
<a name="l01253"></a>01253   <span class="keywordflow">return</span> $this-&gt;<a class="code" href="class_c_m_error.html#a23e9a4ce8ebfa6819c03be92539a0fd6" title="Throw an Unavailable level message.">throwUnavailable</a>(<span class="stringliteral">&quot;Only available with MySQLi&quot;</span>);
<a name="l01254"></a>01254  }
<a name="l01255"></a>01255  
<a name="l01265"></a><a class="code" href="class_c_m_my_s_q_l.html#a101c0bf103093bc82ef1fa4b15d307e6">01265</a>  <span class="keyword">public</span> function <a class="code" href="class_c_m_my_s_q_l.html#a101c0bf103093bc82ef1fa4b15d307e6" title="Kill a MySQL thread.">killThread</a>($threadID) {
<a name="l01266"></a>01266   <span class="keywordflow">if</span>($this-&gt;driver == <span class="stringliteral">&#39;mysqli&#39;</span>)
<a name="l01267"></a>01267    <span class="keywordflow">return</span> $this-&gt;dbh-&gt;kill($threadID);
<a name="l01268"></a>01268   <span class="keywordflow">return</span> $this-&gt;<a class="code" href="class_c_m_error.html#a23e9a4ce8ebfa6819c03be92539a0fd6" title="Throw an Unavailable level message.">throwUnavailable</a>(<span class="stringliteral">&quot;Only available with MySQLi&quot;</span>);
<a name="l01269"></a>01269  }
<a name="l01270"></a>01270  
<a name="l01304"></a><a class="code" href="class_c_m_my_s_q_l.html#a1eb6a860a7e2236618f8d800b9fad69d">01304</a>  <span class="keyword">public</span> function <a class="code" href="class_c_m_my_s_q_l.html#a1eb6a860a7e2236618f8d800b9fad69d" title="Set option.">setOption</a>($option, $value) {
<a name="l01305"></a>01305   <span class="keywordflow">if</span>($this-&gt;driver == <span class="stringliteral">&#39;mysqli&#39;</span>)
<a name="l01306"></a>01306    <span class="keywordflow">return</span> $this-&gt;dbh-&gt;options($option, $value);
<a name="l01307"></a>01307   <span class="keywordflow">return</span> $this-&gt;<a class="code" href="class_c_m_error.html#a23e9a4ce8ebfa6819c03be92539a0fd6" title="Throw an Unavailable level message.">throwUnavailable</a>(<span class="stringliteral">&quot;Only available with MySQLi&quot;</span>);
<a name="l01308"></a>01308  }
<a name="l01309"></a>01309  
<a name="l01315"></a><a class="code" href="class_c_m_my_s_q_l.html#a6dad377f74b0ce6f21b485ba11052746">01315</a>  <span class="keyword">public</span> function <a class="code" href="class_c_m_my_s_q_l.html#a6dad377f74b0ce6f21b485ba11052746" title="Ping this server connection.">ping</a>() {
<a name="l01316"></a>01316   <span class="keywordflow">if</span>($this-&gt;driver == <span class="stringliteral">&#39;mysqli&#39;</span>)
<a name="l01317"></a>01317    <span class="keywordflow">return</span> $this-&gt;dbh-&gt;ping();
<a name="l01318"></a>01318   <span class="keywordflow">return</span> mysql_ping($this-&gt;dbh);
<a name="l01319"></a>01319  }
<a name="l01320"></a>01320  
<a name="l01331"></a><a class="code" href="class_c_m_my_s_q_l.html#a2d931763c47d46ab7c26ba4e69d969d7">01331</a>  <span class="keyword">public</span> function <a class="code" href="class_c_m_my_s_q_l.html#a2d931763c47d46ab7c26ba4e69d969d7" title="Escapes special characters in a string for use in a SQL statement.">escapeString</a>($str) {
<a name="l01332"></a>01332   <span class="keywordflow">if</span>($this-&gt;driver == <span class="stringliteral">&#39;mysqli&#39;</span>)
<a name="l01333"></a>01333    <span class="keywordflow">return</span> $this-&gt;dbh-&gt;real_escape_string($str);
<a name="l01334"></a>01334   <span class="keywordflow">return</span> mysql_real_escape_string($str);
<a name="l01335"></a>01335  }
<a name="l01336"></a>01336  
<a name="l01354"></a><a class="code" href="class_c_m_my_s_q_l.html#afa549adf79e3f8c09fe8f903dd5fbfa7">01354</a>  <span class="keyword">public</span> function <a class="code" href="class_c_m_my_s_q_l.html#afa549adf79e3f8c09fe8f903dd5fbfa7" title="Rolls back current transaction.">rollback</a>() {
<a name="l01355"></a>01355   <span class="keywordflow">if</span>($this-&gt;driver == <span class="stringliteral">&#39;mysqli&#39;</span>)
<a name="l01356"></a>01356    <span class="keywordflow">return</span> $this-&gt;dbh-&gt;rollback();
<a name="l01357"></a>01357   <span class="keywordflow">return</span> $this-&gt;<a class="code" href="class_c_m_error.html#a23e9a4ce8ebfa6819c03be92539a0fd6" title="Throw an Unavailable level message.">throwUnavailable</a>(<span class="stringliteral">&quot;Only available with MySQLi&quot;</span>);
<a name="l01358"></a>01358  }
<a name="l01359"></a>01359  
<a name="l01376"></a><a class="code" href="class_c_m_my_s_q_l.html#ac2f8e8bdf8eda2090abeccdbd91320cd">01376</a>  <span class="keyword">public</span> function <a class="code" href="class_c_m_my_s_q_l.html#ac2f8e8bdf8eda2090abeccdbd91320cd" title="Sets the default client character set.">setCharacterSet</a>($charset) {
<a name="l01377"></a>01377   <span class="keywordflow">if</span>($this-&gt;driver == <span class="stringliteral">&#39;mysqli&#39;</span>)
<a name="l01378"></a>01378    <span class="keywordflow">return</span> $this-&gt;dbh-&gt;set_charset($charset);
<a name="l01379"></a>01379   <span class="keywordflow">return</span> $this-&gt;<a class="code" href="class_c_m_error.html#a23e9a4ce8ebfa6819c03be92539a0fd6" title="Throw an Unavailable level message.">throwUnavailable</a>(<span class="stringliteral">&quot;Only available with MySQLi&quot;</span>);
<a name="l01380"></a>01380  }
<a name="l01381"></a>01381  
<a name="l01392"></a><a class="code" href="class_c_m_my_s_q_l.html#a55d9098fe5b6b646c9f05c5fbb6b758b">01392</a>  <span class="keyword">public</span> function <a class="code" href="class_c_m_my_s_q_l.html#a55d9098fe5b6b646c9f05c5fbb6b758b" title="Unsets user defined handler for load local infile command.">setLocalInfileDefault</a>() {
<a name="l01393"></a>01393   <span class="keywordflow">if</span>($this-&gt;driver == <span class="stringliteral">&#39;mysqli&#39;</span>)
<a name="l01394"></a>01394    <span class="keywordflow">return</span> $this-&gt;dbh-&gt;set_local_infile_default();
<a name="l01395"></a>01395   <span class="keywordflow">return</span> $this-&gt;<a class="code" href="class_c_m_error.html#a23e9a4ce8ebfa6819c03be92539a0fd6" title="Throw an Unavailable level message.">throwUnavailable</a>(<span class="stringliteral">&quot;Only available with MySQLi&quot;</span>);
<a name="l01396"></a>01396  }
<a name="l01397"></a>01397  
<a name="l01414"></a><a class="code" href="class_c_m_my_s_q_l.html#a6b86a59c6db416b221d1681a43af2b5f">01414</a>  <span class="keyword">public</span> function <a class="code" href="class_c_m_my_s_q_l.html#a6b86a59c6db416b221d1681a43af2b5f" title="Set callback function for LOAD DATA LOCAL INFILE command.">setLocalInfileHandler</a>($readFunction) {
<a name="l01415"></a>01415   <span class="keywordflow">if</span>($this-&gt;driver == <span class="stringliteral">&#39;mysqli&#39;</span>)
<a name="l01416"></a>01416    <span class="keywordflow">return</span> $this-&gt;dbh-&gt;set_local_infile_handler($readFunction);
<a name="l01417"></a>01417   <span class="keywordflow">return</span> $this-&gt;<a class="code" href="class_c_m_error.html#a23e9a4ce8ebfa6819c03be92539a0fd6" title="Throw an Unavailable level message.">throwUnavailable</a>(<span class="stringliteral">&quot;Only available with MySQLi&quot;</span>);
<a name="l01418"></a>01418  }
<a name="l01419"></a>01419  
<a name="l01436"></a><a class="code" href="class_c_m_my_s_q_l.html#af0b28816a2a9a4103bc791bed14ee1e0">01436</a>  <span class="keyword">public</span> function <a class="code" href="class_c_m_my_s_q_l.html#af0b28816a2a9a4103bc791bed14ee1e0" title="Returns the SQLSTATE error from previous MySQL operation.">SQLState</a>() {
<a name="l01437"></a>01437   <span class="keywordflow">if</span>($this-&gt;driver == <span class="stringliteral">&#39;mysqli&#39;</span>)
<a name="l01438"></a>01438    <span class="keywordflow">return</span> $this-&gt;dbh-&gt;sqlstate;
<a name="l01439"></a>01439   <span class="keywordflow">return</span> $this-&gt;<a class="code" href="class_c_m_error.html#a23e9a4ce8ebfa6819c03be92539a0fd6" title="Throw an Unavailable level message.">throwUnavailable</a>(<span class="stringliteral">&quot;Only available with MySQLi&quot;</span>);
<a name="l01440"></a>01440  }
<a name="l01441"></a>01441  
<a name="l01453"></a><a class="code" href="class_c_m_my_s_q_l.html#a9d21636071f529e2154051d3ea6e5921">01453</a>  <span class="keyword">public</span> function <a class="code" href="class_c_m_my_s_q_l.html#a9d21636071f529e2154051d3ea6e5921" title="Gets the current system status.">getStatus</a>() {
<a name="l01454"></a>01454   <span class="keywordflow">if</span>($this-&gt;driver == <span class="stringliteral">&#39;mysqli&#39;</span>)
<a name="l01455"></a>01455    <span class="keywordflow">return</span> $this-&gt;dbh-&gt;stat();
<a name="l01456"></a>01456   <span class="keywordflow">return</span> $this-&gt;<a class="code" href="class_c_m_error.html#a23e9a4ce8ebfa6819c03be92539a0fd6" title="Throw an Unavailable level message.">throwUnavailable</a>(<span class="stringliteral">&quot;Only available with MySQLi&quot;</span>);
<a name="l01457"></a>01457  }
<a name="l01458"></a>01458  
<a name="l01475"></a><a class="code" href="class_c_m_my_s_q_l.html#a199f26152d3798a7539590aff3512d10">01475</a>  <span class="keyword">public</span> function <a class="code" href="class_c_m_my_s_q_l.html#a199f26152d3798a7539590aff3512d10" title="Returns the thread ID for the current connection.">getThreadID</a>() {
<a name="l01476"></a>01476   <span class="keywordflow">if</span>($this-&gt;driver == <span class="stringliteral">&#39;mysqli&#39;</span>)
<a name="l01477"></a>01477    <span class="keywordflow">return</span> $this-&gt;dbh-&gt;thread_id();
<a name="l01478"></a>01478   <span class="keywordflow">return</span> $this-&gt;<a class="code" href="class_c_m_error.html#a23e9a4ce8ebfa6819c03be92539a0fd6" title="Throw an Unavailable level message.">throwUnavailable</a>(<span class="stringliteral">&quot;Only available with MySQLi&quot;</span>);
<a name="l01479"></a>01479  }
<a name="l01480"></a>01480  
<a name="l01490"></a><a class="code" href="class_c_m_my_s_q_l.html#a25bbb4ed5bc8daac7fffedf74d9a3bde">01490</a>  <span class="keyword">public</span> function <a class="code" href="class_c_m_my_s_q_l.html#a25bbb4ed5bc8daac7fffedf74d9a3bde" title="Returns whether thread safety is given or not.">isThreadSafe</a>() {
<a name="l01491"></a>01491   <span class="keywordflow">if</span>($this-&gt;driver == <span class="stringliteral">&#39;mysqli&#39;</span>)
<a name="l01492"></a>01492    <span class="keywordflow">return</span> $this-&gt;dbh-&gt;thread_safe();
<a name="l01493"></a>01493   <span class="keywordflow">return</span> $this-&gt;<a class="code" href="class_c_m_error.html#a23e9a4ce8ebfa6819c03be92539a0fd6" title="Throw an Unavailable level message.">throwUnavailable</a>(<span class="stringliteral">&quot;Only available with MySQLi&quot;</span>);
<a name="l01494"></a>01494  }
<a name="l01495"></a>01495  
<a name="l01506"></a><a class="code" href="class_c_m_my_s_q_l.html#a955be18f8348a3e4f4802768bc5f5ed8">01506</a>  <span class="keyword">public</span> function <a class="code" href="class_c_m_my_s_q_l.html#a955be18f8348a3e4f4802768bc5f5ed8" title="Returns the number of warnings from the last query for the given link.">getWarningCount</a>() {
<a name="l01507"></a>01507   <span class="keywordflow">if</span>($this-&gt;driver == <span class="stringliteral">&#39;mysqli&#39;</span>)
<a name="l01508"></a>01508    <span class="keywordflow">return</span> $this-&gt;dbh-&gt;warning_count;
<a name="l01509"></a>01509   <span class="keywordflow">return</span> $this-&gt;<a class="code" href="class_c_m_error.html#a23e9a4ce8ebfa6819c03be92539a0fd6" title="Throw an Unavailable level message.">throwUnavailable</a>(<span class="stringliteral">&quot;Only available with MySQLi&quot;</span>);
<a name="l01510"></a>01510  }
<a name="l01511"></a>01511  
<a name="l01517"></a><a class="code" href="class_c_m_my_s_q_l.html#a8147e0a0a8e607106004e2571195e01c">01517</a>  <span class="keyword">public</span> function <a class="code" href="class_c_m_my_s_q_l.html#a8147e0a0a8e607106004e2571195e01c" title="Get the database product name.">engine</a>() {
<a name="l01518"></a>01518   <span class="keywordflow">return</span> <span class="stringliteral">&quot;MySQL&quot;</span>;
<a name="l01519"></a>01519  }
<a name="l01520"></a>01520  
<a name="l01524"></a><a class="code" href="class_c_m_my_s_q_l.html#a7516ca30af0db3cdbf9a7739b48ce91d">01524</a>  <span class="keyword">public</span> function <a class="code" href="class_c_m_my_s_q_l.html#a7516ca30af0db3cdbf9a7739b48ce91d" title="Return the string value of this object.">__toString</a>() {
<a name="l01525"></a>01525   <span class="keywordflow">return</span> <span class="stringliteral">&quot;&lt;&quot;</span> . get_class($this) . <span class="stringliteral">&quot;&gt;&quot;</span>;
<a name="l01526"></a>01526  }
<a name="l01527"></a>01527  
<a name="l01542"></a><a class="code" href="class_c_m_my_s_q_l.html#a7e4edd82127e0c6a2f42158fdbb258d3">01542</a>  <span class="keyword">public</span> function <a class="code" href="class_c_m_my_s_q_l.html#a7e4edd82127e0c6a2f42158fdbb258d3" title="Erase (not truncate) a table.">eraseTable</a>($tableName) {
<a name="l01543"></a>01543   <span class="comment">// need a valid database handle</span>
<a name="l01544"></a>01544   <span class="keywordflow">if</span>($this-&gt;dbh === <span class="keyword">false</span>)
<a name="l01545"></a>01545    <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01546"></a>01546   
<a name="l01547"></a>01547   $q = $this-&gt;<a class="code" href="class_c_m_my_s_q_l.html#a4ced4e9cc5497c475c2cd1a03318f45a" title="Perform a query on the database that returns a handle to iterate the results.">query</a>(<span class="stringliteral">&quot;DELETE FROM `$tableName` WHERE 1&quot;</span>);
<a name="l01548"></a>01548   <span class="keywordflow">return</span> $q-&gt;success();
<a name="l01549"></a>01549  }
<a name="l01550"></a>01550  
<a name="l01565"></a><a class="code" href="class_c_m_my_s_q_l.html#aff013143f73f33653e2f60fecbde00cb">01565</a>  <span class="keyword">public</span> function <a class="code" href="class_c_m_my_s_q_l.html#aff013143f73f33653e2f60fecbde00cb" title="Truncate (not erase) a table.">truncateTable</a>($tableName) {
<a name="l01566"></a>01566   <span class="comment">// need a valid database handle</span>
<a name="l01567"></a>01567   <span class="keywordflow">if</span>($this-&gt;dbh === <span class="keyword">false</span>)
<a name="l01568"></a>01568    <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01569"></a>01569   
<a name="l01570"></a>01570   $q = $this-&gt;<a class="code" href="class_c_m_my_s_q_l.html#a4ced4e9cc5497c475c2cd1a03318f45a" title="Perform a query on the database that returns a handle to iterate the results.">query</a>(<span class="stringliteral">&quot;TRUNCATE `$tableName`&quot;</span>);
<a name="l01571"></a>01571   <span class="keywordflow">return</span> $q-&gt;success();
<a name="l01572"></a>01572  }
<a name="l01573"></a>01573  
<a name="l01608"></a><a class="code" href="class_c_m_my_s_q_l.html#ac32a7f2a2c349c061f600bc0ac2fec86">01608</a>  <span class="keyword">public</span> function <a class="code" href="class_c_m_my_s_q_l.html#ac32a7f2a2c349c061f600bc0ac2fec86" title="MySQL UPDATE.">update</a>($tableName, $newvalues, $criteria = <span class="keyword">false</span>, $a = <span class="keyword">false</span>) {
<a name="l01609"></a>01609   <span class="comment">// $a must be an array</span>
<a name="l01610"></a>01610   <span class="keywordflow">if</span>(!is_array($a))
<a name="l01611"></a>01611    $a = array();
<a name="l01612"></a>01612   
<a name="l01613"></a>01613   $sql = <span class="stringliteral">&quot;UPDATE `$tableName` SET &quot;</span>;
<a name="l01614"></a>01614   $first = <span class="keyword">true</span>;
<a name="l01615"></a>01615   <span class="keywordflow">foreach</span>($newvalues as $k =&gt; $v) {
<a name="l01616"></a>01616    <span class="keywordflow">if</span>(!$first) $sql .= <span class="stringliteral">&quot;,&quot;</span>;
<a name="l01617"></a>01617    
<a name="l01618"></a>01618    <span class="comment">// if its a CMConstant we don&#39;t encapsulate it</span>
<a name="l01619"></a>01619    <span class="keywordflow">if</span>($v instanceof <a class="code" href="class_c_m_constant.html" title="A container for value that need not be modified or encapsulated.">CMConstant</a> || $v instanceof <a class="code" href="class_c_m_decimal.html" title="Handling exact values.">CMDecimal</a>)
<a name="l01620"></a>01620     $sql .= <span class="stringliteral">&quot;$k=$v&quot;</span>;
<a name="l01621"></a>01621    <span class="keywordflow">else</span>
<a name="l01622"></a>01622     $sql .= <span class="stringliteral">&quot;$k=&#39;&quot;</span> . mysql_real_escape_string($v) . <span class="stringliteral">&quot;&#39;&quot;</span>;
<a name="l01623"></a>01623    
<a name="l01624"></a>01624    $first = <span class="keyword">false</span>;
<a name="l01625"></a>01625   }
<a name="l01626"></a>01626   
<a name="l01627"></a>01627   <span class="comment">// add WHERE clause</span>
<a name="l01628"></a>01628   <span class="keywordflow">if</span>($criteria !== <span class="keyword">false</span>) {
<a name="l01629"></a>01629    $sql .= <span class="stringliteral">&quot; WHERE &quot;</span>;
<a name="l01630"></a>01630    $first = <span class="keyword">true</span>;
<a name="l01631"></a>01631    <span class="keywordflow">foreach</span>($criteria as $k =&gt; $v) {
<a name="l01632"></a>01632     <span class="keywordflow">if</span>(!$first) $sql .= <span class="stringliteral">&quot; AND &quot;</span>;
<a name="l01633"></a>01633     
<a name="l01634"></a>01634     <span class="comment">// if its a CMConstant we don&#39;t encapsulate it</span>
<a name="l01635"></a>01635     <span class="keywordflow">if</span>($v instanceof <a class="code" href="class_c_m_constant.html" title="A container for value that need not be modified or encapsulated.">CMConstant</a> || $v instanceof <a class="code" href="class_c_m_decimal.html" title="Handling exact values.">CMDecimal</a>)
<a name="l01636"></a>01636      $sql .= <span class="stringliteral">&quot;$k=$v&quot;</span>;
<a name="l01637"></a>01637     <span class="keywordflow">else</span>
<a name="l01638"></a>01638      $sql .= <span class="stringliteral">&quot;$k=&#39;&quot;</span> . mysql_real_escape_string($v) . <span class="stringliteral">&quot;&#39;&quot;</span>;
<a name="l01639"></a>01639     
<a name="l01640"></a>01640     $first = <span class="keyword">false</span>;
<a name="l01641"></a>01641    }
<a name="l01642"></a>01642   }
<a name="l01643"></a>01643   
<a name="l01644"></a>01644   <span class="keywordflow">if</span>(isset($a[<span class="stringliteral">&#39;print&#39;</span>]))
<a name="l01645"></a>01645    echo $sql;
<a name="l01646"></a>01646   
<a name="l01647"></a>01647   $q = $this-&gt;<a class="code" href="class_c_m_my_s_q_l.html#a4ced4e9cc5497c475c2cd1a03318f45a" title="Perform a query on the database that returns a handle to iterate the results.">query</a>($sql, <span class="keyword">false</span>, $a);
<a name="l01648"></a>01648   <span class="keywordflow">if</span>($q-&gt;success())
<a name="l01649"></a>01649    <span class="keywordflow">return</span> $q-&gt;affectedRows();
<a name="l01650"></a>01650   <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01651"></a>01651  }
<a name="l01652"></a>01652  
<a name="l01686"></a><a class="code" href="class_c_m_my_s_q_l.html#a2415ba06f043f104ed33b9571f200fc8">01686</a>  <span class="keyword">public</span> function <span class="keyword">delete</span>($tableName, $criteria = <span class="keyword">false</span>, $a = <span class="keyword">false</span>) {
<a name="l01687"></a>01687   <span class="comment">// $a must be an array</span>
<a name="l01688"></a>01688   <span class="keywordflow">if</span>(!is_array($a))
<a name="l01689"></a>01689    $a = array();
<a name="l01690"></a>01690   
<a name="l01691"></a>01691   $sql = <span class="stringliteral">&quot;DELETE FROM `$tableName`&quot;</span>;
<a name="l01692"></a>01692   
<a name="l01693"></a>01693   <span class="comment">// add WHERE clause</span>
<a name="l01694"></a>01694   <span class="keywordflow">if</span>($criteria !== <span class="keyword">false</span>) {
<a name="l01695"></a>01695    $sql .= <span class="stringliteral">&quot; WHERE &quot;</span>;
<a name="l01696"></a>01696    $first = <span class="keyword">true</span>;
<a name="l01697"></a>01697    <span class="keywordflow">foreach</span>($criteria as $k =&gt; $v) {
<a name="l01698"></a>01698     <span class="keywordflow">if</span>(!$first) $sql .= <span class="stringliteral">&quot; AND &quot;</span>;
<a name="l01699"></a>01699     
<a name="l01700"></a>01700     <span class="comment">// if its a CMConstant we don&#39;t encapsulate it</span>
<a name="l01701"></a>01701     <span class="keywordflow">if</span>($v instanceof <a class="code" href="class_c_m_constant.html" title="A container for value that need not be modified or encapsulated.">CMConstant</a> || $v instanceof <a class="code" href="class_c_m_decimal.html" title="Handling exact values.">CMDecimal</a>)
<a name="l01702"></a>01702      $sql .= <span class="stringliteral">&quot;$k=$v&quot;</span>;
<a name="l01703"></a>01703     <span class="keywordflow">else</span>
<a name="l01704"></a>01704      $sql .= <span class="stringliteral">&quot;$k=&#39;&quot;</span> . mysql_real_escape_string($v) . <span class="stringliteral">&quot;&#39;&quot;</span>;
<a name="l01705"></a>01705     
<a name="l01706"></a>01706     $first = <span class="keyword">false</span>;
<a name="l01707"></a>01707    }
<a name="l01708"></a>01708   }
<a name="l01709"></a>01709   
<a name="l01710"></a>01710   <span class="keywordflow">if</span>(isset($a[<span class="stringliteral">&#39;print&#39;</span>]))
<a name="l01711"></a>01711    echo $sql;
<a name="l01712"></a>01712   
<a name="l01713"></a>01713   $q = $this-&gt;<a class="code" href="class_c_m_my_s_q_l.html#a4ced4e9cc5497c475c2cd1a03318f45a" title="Perform a query on the database that returns a handle to iterate the results.">query</a>($sql, <span class="keyword">false</span>, $a);
<a name="l01714"></a>01714   <span class="keywordflow">if</span>($q-&gt;success())
<a name="l01715"></a>01715    <span class="keywordflow">return</span> $q-&gt;affectedRows();
<a name="l01716"></a>01716   <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01717"></a>01717  }
<a name="l01718"></a>01718  
<a name="l01725"></a><a class="code" href="class_c_m_my_s_q_l.html#a7327ec53765f61a4a9d715133d2ea2db">01725</a>  <span class="keyword">public</span> function <a class="code" href="class_c_m_my_s_q_l.html#a7327ec53765f61a4a9d715133d2ea2db" title="Return the auto commit status.">getAutoCommit</a>() {
<a name="l01726"></a>01726   <span class="keywordflow">return</span> $this-&gt;autoCommit;
<a name="l01727"></a>01727  }
<a name="l01728"></a>01728  
<a name="l01738"></a><a class="code" href="class_c_m_my_s_q_l.html#a2c521548fb2e9d535673e11208bd5f6c">01738</a>  <span class="keyword">public</span> function <a class="code" href="class_c_m_my_s_q_l.html#a2c521548fb2e9d535673e11208bd5f6c" title="Escape an entity based on the correct rules of the database engine.">escapeEntity</a>($str) {
<a name="l01739"></a>01739   <span class="keywordflow">return</span> <span class="stringliteral">&quot;`$str`&quot;</span>;
<a name="l01740"></a>01740  }
<a name="l01741"></a>01741  
<a name="l01748"></a><a class="code" href="class_c_m_my_s_q_l.html#a18a087f04157464ca9e96af805da4e8c">01748</a>  <span class="keyword">public</span> function <a class="code" href="class_c_m_my_s_q_l.html#a18a087f04157464ca9e96af805da4e8c" title="Describe a table.">describeTable</a>($tableName, $a = array()) {
<a name="l01749"></a>01749   <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01750"></a>01750  }
<a name="l01751"></a>01751  
<a name="l01767"></a><a class="code" href="class_c_m_my_s_q_l.html#ad3c2efe6828834aadd7cbe990e502645">01767</a>  <span class="keyword">public</span> function <a class="code" href="class_c_m_my_s_q_l.html#ad3c2efe6828834aadd7cbe990e502645" title="Load a SQL file into the current connection.">loadSQLFile</a>($path, $a = array()) {
<a name="l01768"></a>01768   <span class="comment">// prepare</span>
<a name="l01769"></a>01769   $f = fopen($path, <span class="stringliteral">&quot;r&quot;</span>);
<a name="l01770"></a>01770   <span class="keywordflow">if</span>(!$f)
<a name="l01771"></a>01771    <span class="keywordflow">return</span> $this-&gt;<a class="code" href="class_c_m_error.html#a94a6cd26c794c35133502471eca8469e" title="Throw a Error level message.">throwError</a>(<span class="stringliteral">&quot;Could not open input file $path&quot;</span>);
<a name="l01772"></a>01772   
<a name="l01773"></a>01773   <span class="comment">// read each SQL command</span>
<a name="l01774"></a>01774   $success = <span class="keyword">true</span>;
<a name="l01775"></a>01775   $sql = <span class="stringliteral">&quot;&quot;</span>;
<a name="l01776"></a>01776   <span class="keywordflow">while</span>(<span class="keyword">true</span>) {
<a name="l01777"></a>01777    $c = fgetc($f);
<a name="l01778"></a>01778    
<a name="l01779"></a>01779    <span class="comment">// skip whitespace</span>
<a name="l01780"></a>01780    <span class="keywordflow">while</span>(<span class="keyword">true</span>) {
<a name="l01781"></a>01781     $c = fgetc($f);
<a name="l01782"></a>01782     <span class="keywordflow">if</span>(!ctype_space($c)) {
<a name="l01783"></a>01783      fseek($f, -1, SEEK_CUR);
<a name="l01784"></a>01784      <span class="keywordflow">break</span>;
<a name="l01785"></a>01785     }
<a name="l01786"></a>01786    }
<a name="l01787"></a>01787    
<a name="l01788"></a>01788    <span class="comment">// comment</span>
<a name="l01789"></a>01789    <span class="keywordflow">if</span>($c == <span class="charliteral">&#39;-&#39;</span>) {
<a name="l01790"></a>01790     <span class="keywordflow">if</span>(fgetc($f) == <span class="charliteral">&#39;-&#39;</span>) {
<a name="l01791"></a>01791      <span class="comment">// keep reading until the comment ends</span>
<a name="l01792"></a>01792      <span class="keywordflow">while</span>(<span class="keyword">true</span>) {
<a name="l01793"></a>01793       $c = fgetc($f);
<a name="l01794"></a>01794       <span class="keywordflow">if</span>($c == <span class="stringliteral">&quot;\n&quot;</span> || $c == <span class="stringliteral">&quot;\r&quot;</span> || feof($f))
<a name="l01795"></a>01795        <span class="keywordflow">break</span>;
<a name="l01796"></a>01796      }
<a name="l01797"></a>01797      <span class="keywordflow">continue</span>;
<a name="l01798"></a>01798     }
<a name="l01799"></a>01799     <span class="keywordflow">else</span>
<a name="l01800"></a>01800      fseek($f, -1, SEEK_CUR);
<a name="l01801"></a>01801    }
<a name="l01802"></a>01802    
<a name="l01803"></a>01803    <span class="comment">// reading SQL</span>
<a name="l01804"></a>01804    <span class="keywordflow">while</span>(<span class="keyword">true</span>) {
<a name="l01805"></a>01805     $c = fgetc($f);
<a name="l01806"></a>01806     <span class="keywordflow">if</span>($c == <span class="stringliteral">&quot;;&quot;</span> || feof($f)) {
<a name="l01807"></a>01807      $sql = trim($sql);
<a name="l01808"></a>01808      <span class="keywordflow">if</span>($sql != <span class="stringliteral">&quot;&quot;</span>)
<a name="l01809"></a>01809       $this-&gt;<a class="code" href="class_c_m_my_s_q_l.html#a4ced4e9cc5497c475c2cd1a03318f45a" title="Perform a query on the database that returns a handle to iterate the results.">query</a>($sql);
<a name="l01810"></a>01810       
<a name="l01811"></a>01811      <span class="comment">// reset</span>
<a name="l01812"></a>01812      $sql = <span class="stringliteral">&quot;&quot;</span>;
<a name="l01813"></a>01813      <span class="keywordflow">break</span>;
<a name="l01814"></a>01814     }
<a name="l01815"></a>01815     $sql .= $c;
<a name="l01816"></a>01816    }
<a name="l01817"></a>01817    
<a name="l01818"></a>01818    <span class="keywordflow">if</span>(feof($f))
<a name="l01819"></a>01819     <span class="keywordflow">break</span>;
<a name="l01820"></a>01820   }
<a name="l01821"></a>01821   
<a name="l01822"></a>01822   <span class="keywordflow">return</span> $success;
<a name="l01823"></a>01823  }
<a name="l01824"></a>01824  
<a name="l01825"></a>01825 }
<a name="l01826"></a>01826 
<a name="l01827"></a>01827 ?&gt;
</pre></div></div>
<hr class="footer"/><address style="text-align: right;"><small>Generated by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.3 </small></address>
</body>
</html>
