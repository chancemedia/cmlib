<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>CMLIB: CMFileCSV.php Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.6.2 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
    </ul>
  </div>
<h1>CMFileCSV.php</h1><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 &lt;?php
<a name="l00002"></a>00002 
<a name="l00003"></a>00003 include_once(<span class="stringliteral">&#39;CMFileParser.php&#39;</span>);
<a name="l00004"></a>00004 
<a name="l00005"></a>00005 <span class="comment">// bla bla</span>
<a name="l00006"></a>00006 
<a name="l00019"></a><a class="code" href="class_c_m_file_c_s_v.html">00019</a> <span class="keyword">class </span><a class="code" href="class_c_m_file_c_s_v.html" title="Class for handling CSV (comma-separated values) files.">CMFileCSV</a> <span class="keyword">implements</span> <a class="code" href="interface_c_m_file_parser.html" title="File parser interface.">CMFileParser</a> {
<a name="l00020"></a>00020  
<a name="l00026"></a><a class="code" href="class_c_m_file_c_s_v.html#a9e2d53558e7b299d52b25c13d310d7e0">00026</a>  <span class="keyword">public</span> <span class="keyword">static</span> function <a class="code" href="class_c_m_file_c_s_v.html#a9e2d53558e7b299d52b25c13d310d7e0" title="The version of this class.">Version</a>() {
<a name="l00027"></a>00027   <span class="keywordflow">return</span> <span class="stringliteral">&quot;1.0&quot;</span>;
<a name="l00028"></a>00028  }
<a name="l00029"></a>00029  
<a name="l00035"></a><a class="code" href="class_c_m_file_c_s_v.html#ab51e04ce58ff27601a503f46d611b7e6">00035</a>  <span class="keyword">public</span> <span class="keyword">static</span> function <a class="code" href="class_c_m_file_c_s_v.html#ab51e04ce58ff27601a503f46d611b7e6" title="The version this class was introduced to the library.">Since</a>() {
<a name="l00036"></a>00036   <span class="keywordflow">return</span> <span class="stringliteral">&quot;1.0&quot;</span>;
<a name="l00037"></a>00037  }
<a name="l00038"></a>00038  
<a name="l00044"></a><a class="code" href="class_c_m_file_c_s_v.html#a40acc7b8c08cfbb456cd9444cb0e8f61">00044</a>  <span class="keyword">public</span> <a class="code" href="class_c_m_file_c_s_v.html#a40acc7b8c08cfbb456cd9444cb0e8f61" title="Delimiter.">$delimiter</a> = <span class="charliteral">&#39;,&#39;</span>;
<a name="l00045"></a>00045  
<a name="l00051"></a><a class="code" href="class_c_m_file_c_s_v.html#a207ba7fe12aff1e8948477350b4cc43f">00051</a>  <span class="keyword">public</span> <a class="code" href="class_c_m_file_c_s_v.html#a207ba7fe12aff1e8948477350b4cc43f" title="Enclosure.">$enclosure</a> = <span class="charliteral">&#39;&quot;&#39;</span>;
<a name="l00052"></a>00052  
<a name="l00056"></a><a class="code" href="class_c_m_file_c_s_v.html#a23c42e7d231a63025b55e4eb7e3d4c99">00056</a>  <span class="keyword">private</span> <a class="code" href="class_c_m_file_c_s_v.html#a23c42e7d231a63025b55e4eb7e3d4c99" title="Internal file handle.">$f</a> = <span class="keyword">false</span>;
<a name="l00057"></a>00057  
<a name="l00061"></a><a class="code" href="class_c_m_file_c_s_v.html#ab2303c817e3b402b77b7f99627b9c319">00061</a>  <span class="keyword">private</span> <a class="code" href="class_c_m_file_c_s_v.html#ab2303c817e3b402b77b7f99627b9c319" title="Mapped field names.">$fields</a> = <span class="keyword">false</span>;
<a name="l00062"></a>00062  
<a name="l00071"></a><a class="code" href="class_c_m_file_c_s_v.html#a299569d6969a4792f854738be1e89120">00071</a>  <span class="keyword">public</span> function <a class="code" href="class_c_m_file_c_s_v.html#a299569d6969a4792f854738be1e89120" title="Create a new CMFileCSV with optional field names.">CMFileCSV</a>(<a class="code" href="class_c_m_file_c_s_v.html#ab2303c817e3b402b77b7f99627b9c319" title="Mapped field names.">$fields</a> = <span class="keyword">false</span>) {
<a name="l00072"></a>00072   $this-&gt;fields = <a class="code" href="class_c_m_file_c_s_v.html#ab2303c817e3b402b77b7f99627b9c319" title="Mapped field names.">$fields</a>;
<a name="l00073"></a>00073  }
<a name="l00074"></a>00074  
<a name="l00092"></a><a class="code" href="class_c_m_file_c_s_v.html#aac2d51edbe345fb73e63bafd7d505213">00092</a>  <span class="keyword">public</span> function <a class="code" href="class_c_m_file_c_s_v.html#aac2d51edbe345fb73e63bafd7d505213" title="Input a file in peices.">iterateFile</a>($uri, $a = <span class="keyword">false</span>) {
<a name="l00093"></a>00093   <span class="comment">// all we have to do with this function is setup the input file handle</span>
<a name="l00094"></a>00094   $this-&gt;f = fopen($uri, <span class="stringliteral">&quot;r&quot;</span>);
<a name="l00095"></a>00095   <span class="keywordflow">if</span>(!$this-&gt;f)
<a name="l00096"></a>00096    <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00097"></a>00097    
<a name="l00098"></a>00098   <span class="comment">// $a must be an array</span>
<a name="l00099"></a>00099   <span class="keywordflow">if</span>(!is_array($a))
<a name="l00100"></a>00100    $a = array($a =&gt; <span class="keyword">true</span>);
<a name="l00101"></a>00101   
<a name="l00102"></a>00102   <span class="comment">// skip lines</span>
<a name="l00103"></a>00103   <span class="keywordflow">if</span>(isset($a[<span class="stringliteral">&#39;skip&#39;</span>])) {
<a name="l00104"></a>00104    <span class="keywordflow">for</span>($i = 0; $i &lt; $a[<span class="stringliteral">&#39;skip&#39;</span>]; ++$i)
<a name="l00105"></a>00105     $this-&gt;<a class="code" href="class_c_m_file_c_s_v.html#a19c703ce1e7d565fae99689f33383e1e" title="Interate to the next line or object.">next</a>();
<a name="l00106"></a>00106   } 
<a name="l00107"></a>00107   
<a name="l00108"></a>00108   <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00109"></a>00109  }
<a name="l00110"></a>00110  
<a name="l00124"></a><a class="code" href="class_c_m_file_c_s_v.html#affa1184c8126ba8154b574077d9db3ec">00124</a>  <span class="keyword">public</span> function <a class="code" href="class_c_m_file_c_s_v.html#affa1184c8126ba8154b574077d9db3ec" title="Input a string in peices.">iterateString</a>($str, $a = <span class="keyword">false</span>) {
<a name="l00125"></a>00125   <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00126"></a>00126  }
<a name="l00127"></a>00127  
<a name="l00137"></a><a class="code" href="class_c_m_file_c_s_v.html#a64355ed82ca7305a5601ecadcc1b6f4d">00137</a>  <span class="keyword">public</span> function <a class="code" href="class_c_m_file_c_s_v.html#a64355ed82ca7305a5601ecadcc1b6f4d" title="Read a CSV file.">readFile</a>($url, $a = <span class="keyword">false</span>) {
<a name="l00138"></a>00138   <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00139"></a>00139  }
<a name="l00140"></a>00140  
<a name="l00150"></a><a class="code" href="class_c_m_file_c_s_v.html#ab0ac2d7b3f8d52e2dda81db115a96ac4">00150</a>  <span class="keyword">public</span> function <a class="code" href="class_c_m_file_c_s_v.html#ab0ac2d7b3f8d52e2dda81db115a96ac4" title="Not available.">writeFile</a>($uri, $a = <span class="keyword">false</span>) {
<a name="l00151"></a>00151   <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00152"></a>00152  }
<a name="l00153"></a>00153  
<a name="l00163"></a><a class="code" href="class_c_m_file_c_s_v.html#abd982e59b25e4cbee10131891116e29e">00163</a>  <span class="keyword">public</span> function <a class="code" href="class_c_m_file_c_s_v.html#abd982e59b25e4cbee10131891116e29e" title="Parse one ore more CSV lines.">readString</a>($str, $a = <span class="keyword">false</span>) {
<a name="l00164"></a>00164   <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00165"></a>00165  }
<a name="l00166"></a>00166  
<a name="l00175"></a><a class="code" href="class_c_m_file_c_s_v.html#a993b95c56b50a5e314e292d79fc068c5">00175</a>  <span class="keyword">public</span> function <a class="code" href="class_c_m_file_c_s_v.html#a993b95c56b50a5e314e292d79fc068c5" title="Not available.">writeString</a>($a = <span class="keyword">false</span>) {
<a name="l00176"></a>00176   <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00177"></a>00177  }
<a name="l00178"></a>00178  
<a name="l00186"></a><a class="code" href="class_c_m_file_c_s_v.html#a2afd230e2b31e9ab339dd9879f17bd7d">00186</a>  <span class="keyword">public</span> function <a class="code" href="class_c_m_file_c_s_v.html#a2afd230e2b31e9ab339dd9879f17bd7d" title="The standard file extensions for this file parser.">getStandardExtensions</a>() {
<a name="l00187"></a>00187   <span class="keywordflow">return</span> array(<span class="stringliteral">&#39;.csv&#39;</span>, <span class="stringliteral">&#39;.txt&#39;</span>);
<a name="l00188"></a>00188  }
<a name="l00189"></a>00189  
<a name="l00217"></a><a class="code" href="class_c_m_file_c_s_v.html#ab119de9fb3a6520c093501aa941ebdeb">00217</a>  <span class="keyword">public</span> function <a class="code" href="class_c_m_file_c_s_v.html#ab119de9fb3a6520c093501aa941ebdeb" title="Get internet media type (originally MIME type.).">getInternetMediaTypes</a>() {
<a name="l00218"></a>00218   <span class="keywordflow">return</span> array(<span class="stringliteral">&#39;text/csv&#39;</span>, <span class="stringliteral">&#39;text/comma-separated-values&#39;</span>);
<a name="l00219"></a>00219  }
<a name="l00220"></a>00220  
<a name="l00237"></a><a class="code" href="class_c_m_file_c_s_v.html#a19c703ce1e7d565fae99689f33383e1e">00237</a>  <span class="keyword">public</span> function <a class="code" href="class_c_m_file_c_s_v.html#a19c703ce1e7d565fae99689f33383e1e" title="Interate to the next line or object.">next</a>($options = <span class="keyword">false</span>) {
<a name="l00238"></a>00238   <span class="comment">// iterateFile</span>
<a name="l00239"></a>00239   <span class="keywordflow">if</span>(get_resource_type($this-&gt;f) == <span class="stringliteral">&#39;stream&#39;</span> || get_resource_type($this-&gt;f) == <span class="stringliteral">&#39;file&#39;</span>) {
<a name="l00240"></a>00240    <span class="comment">// make sure the file handle is open and still got data left</span>
<a name="l00241"></a>00241    <span class="keywordflow">if</span>($this-&gt;f === <span class="keyword">false</span> || feof($this-&gt;f))
<a name="l00242"></a>00242     <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00243"></a>00243     
<a name="l00244"></a>00244    <span class="comment">// get and split the data</span>
<a name="l00245"></a>00245    $r = fgetcsv($this-&gt;f, 4096, $this-&gt;delimiter, $this-&gt;enclosure);
<a name="l00246"></a>00246   } <span class="keywordflow">else</span> {
<a name="l00247"></a>00247    <span class="comment">// get and split the data</span>
<a name="l00248"></a>00248    $r = <span class="stringliteral">&quot;&quot;</span>;
<a name="l00249"></a>00249    <span class="comment">//$r = str_getcsv($this-&gt;f, 4096, $this-&gt;delimiter, $this-&gt;enclosure);</span>
<a name="l00250"></a>00250   }
<a name="l00251"></a>00251    
<a name="l00252"></a>00252   <span class="comment">// map the field names</span>
<a name="l00253"></a>00253   <span class="keywordflow">if</span>($this-&gt;fields !== <span class="keyword">false</span>) {
<a name="l00254"></a>00254    $newr = array();
<a name="l00255"></a>00255    <span class="keywordflow">for</span>($i = 0; $i &lt; count($r); ++$i)
<a name="l00256"></a>00256     $newr[$this-&gt;fields[$i]] = $r[$i];
<a name="l00257"></a>00257    $r = $newr;
<a name="l00258"></a>00258   }
<a name="l00259"></a>00259   
<a name="l00260"></a>00260   <span class="comment">// trim off the new line if needed</span>
<a name="l00261"></a>00261   $temp = $r[count($r) - 1];
<a name="l00262"></a>00262   <span class="keywordflow">if</span>(substr($temp, strlen($temp) - 1, 1) == <span class="stringliteral">&quot;\n&quot;</span>)
<a name="l00263"></a>00263    $r[count($r) - 1] = substr($temp, 0, strlen($temp) - 1);
<a name="l00264"></a>00264   
<a name="l00265"></a>00265   <span class="keywordflow">return</span> $r;
<a name="l00266"></a>00266  }
<a name="l00267"></a>00267  
<a name="l00275"></a><a class="code" href="class_c_m_file_c_s_v.html#a3d23f68f155fbcaaadaaa90665b3800d">00275</a>  <span class="keyword">public</span> function <a class="code" href="class_c_m_file_c_s_v.html#a3d23f68f155fbcaaadaaa90665b3800d" title="File is binary?">isBinary</a>() {
<a name="l00276"></a>00276   <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00277"></a>00277  }
<a name="l00278"></a>00278  
<a name="l00283"></a><a class="code" href="class_c_m_file_c_s_v.html#a7516ca30af0db3cdbf9a7739b48ce91d">00283</a>  <span class="keyword">public</span> function <a class="code" href="class_c_m_file_c_s_v.html#a7516ca30af0db3cdbf9a7739b48ce91d" title="Return the string value of this object.">__toString</a>() {
<a name="l00284"></a>00284   <span class="keywordflow">return</span> <span class="stringliteral">&quot;&lt;&quot;</span> . get_class($this) . <span class="stringliteral">&quot;&gt;&quot;</span>;
<a name="l00285"></a>00285  }
<a name="l00286"></a>00286  
<a name="l00306"></a><a class="code" href="class_c_m_file_c_s_v.html#a84682117d78dcfc279db48d8aa3afa37">00306</a>  <span class="keyword">public</span> function <a class="code" href="class_c_m_file_c_s_v.html#a84682117d78dcfc279db48d8aa3afa37" title="Prepare a CSV file for writing.">prepareWriteFile</a>($uri, $a = <span class="keyword">false</span>) {
<a name="l00307"></a>00307   <span class="comment">// $a must be an array</span>
<a name="l00308"></a>00308   <span class="keywordflow">if</span>(!is_array($a))
<a name="l00309"></a>00309    $a = array($a =&gt; <span class="keyword">true</span>);
<a name="l00310"></a>00310   
<a name="l00311"></a>00311   <span class="comment">// this method only has to open the writing file handle</span>
<a name="l00312"></a>00312   <span class="keywordflow">if</span>(isset($a[<span class="stringliteral">&#39;append&#39;</span>]))
<a name="l00313"></a>00313    $this-&gt;f = fopen($uri, <span class="stringliteral">&quot;a+&quot;</span>);
<a name="l00314"></a>00314   <span class="keywordflow">else</span> $this-&gt;f = fopen($uri, <span class="stringliteral">&quot;w&quot;</span>);
<a name="l00315"></a>00315   
<a name="l00316"></a>00316   <span class="keywordflow">return</span> $this-&gt;f !== <span class="keyword">false</span>;
<a name="l00317"></a>00317  }
<a name="l00318"></a>00318  
<a name="l00327"></a><a class="code" href="class_c_m_file_c_s_v.html#aee954a9976108ebcec479fa4a4983de7">00327</a>  <span class="keyword">public</span> function <a class="code" href="class_c_m_file_c_s_v.html#aee954a9976108ebcec479fa4a4983de7" title="Check if this class instance is in caching mode.">isCaching</a>() {
<a name="l00328"></a>00328   <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00329"></a>00329  }
<a name="l00330"></a>00330  
<a name="l00340"></a><a class="code" href="class_c_m_file_c_s_v.html#aa96227453b5fe69a6749fdb95f32cc89">00340</a>  <span class="keyword">public</span> function <a class="code" href="class_c_m_file_c_s_v.html#aa96227453b5fe69a6749fdb95f32cc89" title="Enable/disable caching for this instance.">setCache</a>($mode = <span class="keyword">true</span>) {
<a name="l00341"></a>00341   <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00342"></a>00342  }
<a name="l00343"></a>00343  
<a name="l00355"></a><a class="code" href="class_c_m_file_c_s_v.html#ad2bae0efe64fd67aafc2baad67dbf120">00355</a>  <span class="keyword">public</span> function <a class="code" href="class_c_m_file_c_s_v.html#ad2bae0efe64fd67aafc2baad67dbf120" title="Immediatly write a line to the output CSV file.">add</a>($item = <span class="keyword">false</span>) {
<a name="l00356"></a>00356   <span class="comment">// we need an open file handle</span>
<a name="l00357"></a>00357   <span class="keywordflow">if</span>($this-&gt;f === <span class="keyword">false</span>)
<a name="l00358"></a>00358    <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00359"></a>00359    
<a name="l00360"></a>00360   <span class="comment">// item must be an array or we fail</span>
<a name="l00361"></a>00361   <span class="keywordflow">if</span>(!is_array($item))
<a name="l00362"></a>00362    <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00363"></a>00363    
<a name="l00364"></a>00364   <span class="keywordflow">return</span> fputcsv($this-&gt;f, $item, $this-&gt;delimiter, $this-&gt;enclosure);
<a name="l00365"></a>00365  }
<a name="l00366"></a>00366  
<a name="l00377"></a><a class="code" href="class_c_m_file_c_s_v.html#ad51812b2aa2b726688c27570a13d3937">00377</a>  <span class="keyword">public</span> function <a class="code" href="class_c_m_file_c_s_v.html#ad51812b2aa2b726688c27570a13d3937" title="Close and flush the writing file handle.">finishWriteFile</a>() {
<a name="l00378"></a>00378   <span class="keywordflow">if</span>($this-&gt;f !== <span class="keyword">false</span>)
<a name="l00379"></a>00379    fclose($this-&gt;f);
<a name="l00380"></a>00380   <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00381"></a>00381  }
<a name="l00382"></a>00382  
<a name="l00383"></a>00383 }
<a name="l00384"></a>00384 
<a name="l00385"></a>00385 ?&gt;
</pre></div></div>
<hr size="1"/><address style="text-align: right;"><small>Generated by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.2 </small></address>
</body>
</html>
