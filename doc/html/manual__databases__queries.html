<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>CMLIB: 5.3. Queries</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.6.2 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="navpath"><a class="el" href="manual.html">Manual</a>&nbsp;&raquo;&nbsp;<a class="el" href="manual__databases.html">5. Databases</a>
  </div>
</div>
<div class="contents">
<h2><a class="anchor" id="manual_databases_queries_contents">
Contents</a></h2>
<ol type="1">
<li><a class="el" href="manual__databases__queries.html#manual_databases_queries_query">Using query() vs execute()</a></li>
<li><a class="el" href="manual__databases__queries.html#manual_databases_queries_binding">Binding and Constants</a></li>
<li><a class="el" href="manual__databases__queries.html#manual_databases_queries_options">Query Options</a></li>
</ol>
<h2><a class="anchor" id="manual_databases_queries_query">
Using query() vs execute()</a></h2>
<p>These two method perform the same way with the only difference being that query() returns a new <a class="el" href="interface_c_m_query_protocol.html" title="Database query interface.">CMQueryProtocol</a> object regardless of the success of the query (so never compare a query() result with <span style="color: MediumBlue"><code>false</code></span>.) Whereas execute() simply executes the SQL and returns a boolean value of its success.</p>
<h2><a class="anchor" id="manual_databases_queries_binding">
Binding and Constants</a></h2>
<p>Binding allows values to be safely substituted into SQL statements based on the quotation rules of the database engine you are using. The bound value are passed as the second parameter to the query() or execute() methods.</p>
<p>A simple example: </p>
<div class="fragment"><pre class="fragment"> $dbh = <span class="keyword">new</span> <a class="code" href="class_c_m_my_s_q_l.html" title="MySQL connectivity class.">CMMySQL</a>(<span class="stringliteral">&quot;mysql://root:abc123/test&quot;</span>);
 $q = $dbh-&gt;query(<span class="stringliteral">&quot;select * from mytable where name=? and age&gt;?&quot;</span>, array(<span class="stringliteral">&#39;Bob&#39;</span>, 18));
 <span class="comment">// SQL executed: select * from mytable where name=&#39;Bob&#39; and age&gt;&#39;18&#39;</span>
</pre></div><dl class="note"><dt><b>Note:</b></dt><dd>The bound values must be a non-associative array so the order of the bound values fall into their correct place.</dd></dl>
<p>The bound values are not required to be an array, if a single value is passed it will be applied to all bindings: </p>
<div class="fragment"><pre class="fragment"> $dbh = <span class="keyword">new</span> <a class="code" href="class_c_m_my_s_q_l.html" title="MySQL connectivity class.">CMMySQL</a>(<span class="stringliteral">&quot;mysql://root:abc123/test&quot;</span>);
 $q = $dbh-&gt;query(<span class="stringliteral">&quot;select * from person where firstname=? or lastname=?&quot;</span>, <span class="stringliteral">&#39;Bob&#39;</span>);
 <span class="comment">// SQL executed: select * from person where firstname=&#39;Bob&#39; or lastname=&#39;Bob&#39;</span>
</pre></div><p>Using <span style="color: MediumBlue"><code>false</code></span> for the bound values will not bind any values regardless of if the string contains the <code>?</code> character. This is the default.</p>
<p>You can only bind values and not SQL context statements. So the following will not work: </p>
<div class="fragment"><pre class="fragment"> $dbh = <span class="keyword">new</span> <a class="code" href="class_c_m_my_s_q_l.html" title="MySQL connectivity class.">CMMySQL</a>(<span class="stringliteral">&quot;mysql://root:abc123/test&quot;</span>);
 $q = $dbh-&gt;query(<span class="stringliteral">&quot;select * from ? where 1&quot;</span>, <span class="stringliteral">&#39;mytable&#39;</span>);
 <span class="comment">// SQL executed: select * from &#39;mytable&#39; where 1</span>
 <span class="comment">// SQL standard requires entity names to be encapsulated in double-quotes.</span>
</pre></div><p>Sometimes you need a bound value to be substituted without escaping it, for example when using expressions. This is possible by using <a class="el" href="class_c_m_constant.html" title="A container for value that need not be modified or encapsulated.">CMConstant</a>: </p>
<div class="fragment"><pre class="fragment"> $dbh = <span class="keyword">new</span> <a class="code" href="class_c_m_my_s_q_l.html" title="MySQL connectivity class.">CMMySQL</a>(<span class="stringliteral">&quot;mysql://root:abc123/test&quot;</span>);
 $q = $dbh-&gt;query(<span class="stringliteral">&quot;update person set updated=? where id=?&quot;</span>,
                    array(<span class="keyword">new</span> <a class="code" href="class_c_m_constant.html" title="A container for value that need not be modified or encapsulated.">CMConstant</a>(<span class="stringliteral">&quot;now()&quot;</span>), 5));
 <span class="comment">// SQL executed: update person set updated=now() where id=&#39;5&#39;</span>
</pre></div><h2><a class="anchor" id="manual_databases_queries_options">
Query Options</a></h2>
<p>Some methods including query(), execute() and insert() allow extra options through the <code>$a</code> argument. These options are passed as an array with the following values, in the order they they are executed: </p>
<table class="doxtable">
<tr>
<th>Key </th><th>Value </th><th>Description </th><th>Example  </th></tr>
<tr>
<td><code>print</code>  </td><td><em>Ignored</em> </td><td>Print the generated SQL before executing </td><td><div class="fragment"><pre class="fragment">     $dbh-&gt;query(<span class="stringliteral">&quot;select * from people where firstname=? and age&gt;?&quot;</span>,
                 array(<span class="stringliteral">&#39;Bob&#39;</span>, 18),
                 array(<span class="stringliteral">&#39;print&#39;</span>));
</pre></div>   </td></tr>
<tr>
<td><code>execute</code>  </td><td>Boolean value </td><td>The SQL is executed based on the boolean value. </td><td><div class="fragment"><pre class="fragment">     $dbh-&gt;query(<span class="stringliteral">&quot;select * from people where firstname=? and age&gt;?&quot;</span>,
                 array(<span class="stringliteral">&#39;Bob&#39;</span>, 18),
                 array(<span class="stringliteral">&#39;execute&#39;</span> =&gt; <span class="keyword">true</span>));
</pre></div>   </td></tr>
<tr>
<td><code>die</code>  </td><td><em>Ignored</em> </td><td>If the query fails, die with the error message </td><td><div class="fragment"><pre class="fragment">     $dbh-&gt;query(<span class="stringliteral">&quot;select * from thisTableDoesntExist&quot;</span>, <span class="keyword">false</span>, array(<span class="stringliteral">&#39;die&#39;</span>));
</pre></div>   </td></tr>
<tr>
<td><code>return</code>  </td><td><em>Ignored</em> </td><td>Return the generated SQL instead of the query handle or the result. </td><td><div class="fragment"><pre class="fragment">     $sql = $dbh-&gt;query(<span class="stringliteral">&quot;select * from people where firstname=? and age&gt;?&quot;</span>,
                        array(<span class="stringliteral">&#39;Bob&#39;</span>, 18),
                        array(<span class="stringliteral">&#39;return&#39;</span>, <span class="stringliteral">&#39;execute&#39;</span> =&gt; <span class="keyword">false</span>));
</pre></div>   </td></tr>
</table>
</div>
<hr size="1"/><address style="text-align: right;"><small>Generated on Thu Apr 1 15:32:23 2010 for CMLIB by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.2 </small></address>
</body>
</html>
