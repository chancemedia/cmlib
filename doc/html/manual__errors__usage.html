<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>CMLIB: 2.1. Usage</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.6.3 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="navpath"><a class="el" href="manual.html">Manual</a>&nbsp;&raquo;&nbsp;<a class="el" href="manual__errors.html">2. Error Handling</a>
  </div>
</div>
<div class="contents">


<h1><a class="anchor" id="manual_errors_usage">2.1. Usage </a></h1><h2><a class="anchor" id="manual_errors_usage_contents">
Contents</a></h2>
<ol type="1">
<li><a class="el" href="manual__errors__usage.html#manual_errors_usage_create">Creating an Independant Error Stack</a></li>
<li><a class="el" href="manual__errors__usage.html#manual_errors_usage_deal">Dealing With Errors on a Stack</a></li>
<li><a class="el" href="manual__errors__usage.html#manual_errors_usage_silent">Silent Errors</a></li>
<li><a class="el" href="manual__errors__usage.html#manual_errors_usage_redirect">Redirecting/Pooling Errors From Multiple Objects</a></li>
<li><a class="el" href="manual__errors__usage.html#manual_errors_usage_exit">Changing the Exit Level</a></li>
</ol>
<h2><a class="anchor" id="manual_errors_usage_create">
Creating an Independant Error Stack</a></h2>
<div class="fragment"><pre class="fragment"> include_once(<span class="stringliteral">&quot;CMError.php&quot;</span>);
 
 <span class="comment">// create a new error stack</span>
 $e = <span class="keyword">new</span> <a class="code" href="class_c_m_error.html" title="Error handling as a stand-alone or for classes vis inheritance.">CMError</a>();
 $e-&gt;setVerboseLevel(<a class="code" href="class_c_m_error_type.html#a64b3247b1adf1a38b6f5f41d3d612a61" title="Fatal.">CMErrorType::Fatal</a>); <span class="comment">// only print the error if fatal</span>
 
 <span class="comment">// a function that simply divides 2 numbers safely</span>
 function divide($a, $b) {
   global $e;
   <span class="keywordflow">if</span>($b == 0) {
     $e-&gt;throwError(<span class="stringliteral">&quot;Cannot divide by zero!&quot;</span>);
     <span class="keywordflow">return</span> 0;
   }
   <span class="keywordflow">return</span> $a / $b;
 }
 
 <span class="comment">// now do some work</span>
 echo divide(15, 3), <span class="stringliteral">&quot;\n&quot;</span>;
 echo divide(7, 0), <span class="stringliteral">&quot;\n&quot;</span>;
 echo divide(3, 0), <span class="stringliteral">&quot;\n&quot;</span>;
 echo divide(10, 2), <span class="stringliteral">&quot;\n&quot;</span>;
 
 <span class="comment">// lets see if anything we wrong</span>
 <span class="keywordflow">if</span>($e-&gt;isErrors()) {
   echo <span class="stringliteral">&quot;There were &quot;</span>, $e-&gt;countErrors(), <span class="stringliteral">&quot; errors:\n&quot;</span>;
   <span class="keywordflow">foreach</span>($e-&gt;errors() as $error)
    <a class="code" href="class_c_m_error.html#a63c1e0a7d7c85f2d9c5c8f1455aec0b1" title="Print an error.">CMError::PrintError</a>($error);
 }
</pre></div><h2><a class="anchor" id="manual_errors_usage_deal">
Dealing With Errors on a Stack</a></h2>
<p>To clear a stack of all its errors you can invoke <code>dealtWithAll()</code> like: </p>
<div class="fragment"><pre class="fragment"> $e = <span class="keyword">new</span> <a class="code" href="class_c_m_error.html" title="Error handling as a stand-alone or for classes vis inheritance.">CMError</a>();
 <span class="comment">// ... do some stuff to put errors on the stack</span>
 $e-&gt;dealtWithAll();
 <span class="comment">// continue the script with $e being empty.</span>
</pre></div><h2><a class="anchor" id="manual_errors_usage_silent">
Silent Errors</a></h2>
<p>In the example above we see: </p>
<div class="fragment"><pre class="fragment"> $e-&gt;setVerboseLevel(<a class="code" href="class_c_m_error_type.html#a64b3247b1adf1a38b6f5f41d3d612a61" title="Fatal.">CMErrorType::Fatal</a>);
</pre></div><p> This tells the error stack to be quiet when a error of any kind is thrown. By default this is set to <code><a class="el" href="class_c_m_error_type.html#a73def04a20ec616b843fae91c6ec5888" title="Warning.">CMErrorType::Warning</a></code>, so anything above or equal to the seriousness of a Warning will be immediatly printed to the page.</p>
<h2><a class="anchor" id="manual_errors_usage_redirect">
Redirecting/Pooling Errors From Multiple Objects</a></h2>
<p>Sometimes you may want to redirect all the errors from some or all objects into a central stack. There is a few ways this can be done based on what you require.</p>
<p>The first way is to tell each object (that has an error stack) to send its errors somewhere else. The second way is when you tell PHP "every single object (past and future) direct all your error
 messages to this instance."</p>
<p>Lets have a look at the first way of redirecting messages: </p>
<div class="fragment"><pre class="fragment"> <span class="comment">// create 2 error stacks</span>
 $e1 = <span class="keyword">new</span> <a class="code" href="class_c_m_error.html" title="Error handling as a stand-alone or for classes vis inheritance.">CMError</a>();
 $e2 = <span class="keyword">new</span> <a class="code" href="class_c_m_error.html" title="Error handling as a stand-alone or for classes vis inheritance.">CMError</a>();
 
 <span class="comment">// tell $e1 to direct all its error messages to $e2</span>
 $e1-&gt;useErrorStack($e2);
 
 <span class="comment">// throw an error message to each</span>
 $e1-&gt;throwError(<span class="stringliteral">&quot;First error&quot;</span>);
 $e2-&gt;throwError(<span class="stringliteral">&quot;Second error&quot;</span>);
 
 <span class="comment">// be careful here: this will look like 4 errors because both errors have been sent to $e2</span>
 <span class="comment">// aswell as $e1 pointing to $e2, so $e1 will actually return $e2&#39;s errors.</span>
 
 <span class="comment">// lets see if anything we wrong</span>
 <span class="keywordflow">if</span>($e2-&gt;isErrors()) {
   echo <span class="stringliteral">&quot;There were &quot;</span>, $e2-&gt;countErrors(), <span class="stringliteral">&quot; errors:\n&quot;</span>;
   <span class="keywordflow">foreach</span>($e2-&gt;errors() as $error)
    <a class="code" href="class_c_m_error.html#a63c1e0a7d7c85f2d9c5c8f1455aec0b1" title="Print an error.">CMError::PrintError</a>($error);
 }
</pre></div><p>There is no limit to how many objects can pass their error messages to a central error stack. It is also possible for messages for messages to be redirected through multiple objects, so be careful your error messages don't get caught in an infinite cycle.</p>
<p>The same code above can be applied to objects that inherit a stack, a good example of this is a database connection. It might be easier to pool all of your database connections into a single error stack: </p>
<div class="fragment"><pre class="fragment"> <span class="comment">// create our database aggregate error stack</span>
 $dbErrors = <span class="keyword">new</span> <a class="code" href="class_c_m_error.html" title="Error handling as a stand-alone or for classes vis inheritance.">CMError</a>();
 
 <span class="comment">// create 2 database connections</span>
 $db1 = <span class="keyword">new</span> MySQL(...);
 $db2 = <span class="keyword">new</span> Oracle(...);
 
 <span class="comment">// tell the database connections to use $dbErrors instead of there own error stacks</span>
 $db1-&gt;useErrorStack($dbErrors);
 $db2-&gt;useErrorStack($dbErrors);
 
 <span class="comment">// ... do some stuff ...</span>
 
 <span class="comment">// lets see if anything we wrong</span>
 <span class="keywordflow">if</span>($e2-&gt;isErrors()) {
   echo <span class="stringliteral">&quot;There were &quot;</span>, $e2-&gt;countErrors(), <span class="stringliteral">&quot; errors:\n&quot;</span>;
   <span class="keywordflow">foreach</span>($e2-&gt;errors() as $error)
    <a class="code" href="class_c_m_error.html#a63c1e0a7d7c85f2d9c5c8f1455aec0b1" title="Print an error.">CMError::PrintError</a>($error);
 }
</pre></div><p>The second way is to automatically redirect all objects and objects that inherit an error stack to use the global stack: </p>
<div class="fragment"><pre class="fragment"> <span class="comment">// create a stack and define it as the stack for ALL objects created after or before this point</span>
 $allErrors = <span class="keyword">new</span> <a class="code" href="class_c_m_error.html" title="Error handling as a stand-alone or for classes vis inheritance.">CMError</a>();
 <a class="code" href="class_c_m_error.html#abc56839e2f51b5475ace61975a0be7c8" title="Set the global stack.">CMError::SetGlobalStack</a>($allErrors);
 
 <span class="comment">// create two new stacks, which will automatially have their stack changed to $allErrors</span>
 $e1 = <span class="keyword">new</span> <a class="code" href="class_c_m_error.html" title="Error handling as a stand-alone or for classes vis inheritance.">CMError</a>();
 $e2 = <span class="keyword">new</span> <a class="code" href="class_c_m_error.html" title="Error handling as a stand-alone or for classes vis inheritance.">CMError</a>();
 
 <span class="comment">// throw an error message to each</span>
 $e1-&gt;throwError(<span class="stringliteral">&quot;First error&quot;</span>);
 $e2-&gt;throwError(<span class="stringliteral">&quot;Second error&quot;</span>);
 
 <span class="comment">// now lets check out global stack</span>
 <span class="keywordflow">if</span>($allErrors-&gt;isErrors()) {
   echo <span class="stringliteral">&quot;There were &quot;</span>, $allErrors-&gt;countErrors(), <span class="stringliteral">&quot; errors:\n&quot;</span>;
   <span class="keywordflow">foreach</span>($allErrors-&gt;errors() as $error)
    <a class="code" href="class_c_m_error.html#a63c1e0a7d7c85f2d9c5c8f1455aec0b1" title="Print an error.">CMError::PrintError</a>($error);
 }
</pre></div><h2><a class="anchor" id="manual_errors_usage_exit">
Changing the Exit Level</a></h2>
<p>In most cases you only want your script to exit when something unrecoverable or very illegal has happened. But you can turn up the strictness level so that scipt will force exit at a level below Fatal.</p>
<p>For example, imagine you have a script that opens a database connection, read the daily <code>expense</code> table and reports the total for the day. If you are unable to make a connection with the database theres no need to proceed, or manually add in error checking. The problem should be reported and the script exited: </p>
<div class="fragment"><pre class="fragment"> <span class="comment">// as this is a simple script, we can just use a global error stack</span>
 $allErrors = <span class="keyword">new</span> <a class="code" href="class_c_m_error.html" title="Error handling as a stand-alone or for classes vis inheritance.">CMError</a>();
 <a class="code" href="class_c_m_error.html#abc56839e2f51b5475ace61975a0be7c8" title="Set the global stack.">CMError::SetGlobalStack</a>($allErrors);
 
 <span class="comment">// lets be strict and attempt to open the database</span>
 $allErrors-&gt;setExitLevel(<a class="code" href="class_c_m_error_type.html#a73def04a20ec616b843fae91c6ec5888" title="Warning.">CMErrorType::Warning</a>);
 $dbh = <span class="keyword">new</span> <a class="code" href="class_c_m_my_s_q_l.html" title="MySQL connectivity class.">CMMySQL</a>(...);
 
 <span class="comment">// If the connection was unsuccessful it would of thrown a Warning that was redirected to the</span>
 <span class="comment">// global error stack and because we&#39;ve told it to exit on Warnings or higher the script will</span>
 <span class="comment">// exit.</span>
 <span class="comment">// If we make it to this point then the connection was successful and we continue the script</span>
 <span class="comment">// knowing that $allErrors will take care of any future errors aswell.</span>
</pre></div> </div>
<hr class="footer"/><address style="text-align: right;"><small>Generated by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.3 </small></address>
</body>
</html>
