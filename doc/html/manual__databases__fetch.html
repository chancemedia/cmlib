<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>CMLIB: 5.4. Fetching Data</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.6.2 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="navpath"><a class="el" href="manual.html">Manual</a>&nbsp;&raquo;&nbsp;<a class="el" href="manual__databases.html">5. Databases</a>
  </div>
</div>
<div class="contents">
<h2><a class="anchor" id="manual_databases_fetch_contents">
Contents</a></h2>
<ol type="1">
<li><a class="el" href="manual__databases__fetch.html#manual_databases_fetch_fetch">Fetching Data</a></li>
<li><a class="el" href="manual__databases__fetch.html#manual_databases_fetch_fetchall">Fetching All Data</a></li>
</ol>
<h2><a class="anchor" id="manual_databases_fetch_fetch">
Fetching Data</a></h2>
<p>Data from a query handle can be retrived in a few ways, the simplest way is to use the fetch() method like; </p>
<div class="fragment"><pre class="fragment"> $dbh = <span class="keyword">new</span> <a class="code" href="class_c_m_my_s_q_l.html" title="MySQL connectivity class.">CMMySQL</a>(<span class="stringliteral">&quot;mysql://root:abc123/test&quot;</span>);
 $q = $dbh-&gt;query(<span class="stringliteral">&quot;select * from mytable&quot;</span>);
 <span class="keywordflow">while</span>($r = $q-&gt;fetch()) {
   echo $r[<span class="stringliteral">&#39;name&#39;</span>], <span class="stringliteral">&quot;\n&quot;</span>;
 }
</pre></div><p>With the default options fetch() will return the new row from the result set an associative array, that is with the names of the fields as the keys and respective values. There are extra parameters that can be passed to fetch() to get a different desired result: </p>
<div class="fragment"><pre class="fragment"> $dbh = <span class="keyword">new</span> <a class="code" href="class_c_m_my_s_q_l.html" title="MySQL connectivity class.">CMMySQL</a>(<span class="stringliteral">&quot;mysql://root:abc123/test&quot;</span>);
 $q = $dbh-&gt;query(<span class="stringliteral">&quot;select id, name, value from mytable&quot;</span>);
 <span class="keywordflow">while</span>($r = $q-&gt;fetch(<span class="stringliteral">&#39;line&#39;</span>)) {
   echo $r[1], <span class="stringliteral">&quot;\n&quot;</span>; <span class="comment">// the &#39;name&#39; field.</span>
 }
</pre></div><p>The list of row types are as follows: </p>
<table class="doxtable">
<tr>
<td><code>'assoc'</code>  </td><td>Associative array. This is the default  </td></tr>
<tr>
<td><code>'line'</code>  </td><td>Non-associative array.  </td></tr>
<tr>
<td><code>'pair'</code>  </td><td>First and second column become key-value.  </td></tr>
<tr>
<td><code>'cell'</code>  </td><td>Only use the first column and return it as a scalar not an array.  </td></tr>
</table>
<p>Another example using <code>'cell'</code> to fetch a single value: </p>
<div class="fragment"><pre class="fragment"> $dbh = <span class="keyword">new</span> <a class="code" href="class_c_m_my_s_q_l.html" title="MySQL connectivity class.">CMMySQL</a>(<span class="stringliteral">&quot;mysql://root:abc123/test&quot;</span>);
 $q = $dbh-&gt;query(<span class="stringliteral">&quot;select name from mytable where id=? limit 1&quot;</span>, 5);
 $name = $q-&gt;fetch(<span class="stringliteral">&#39;cell&#39;</span>); <span class="comment">// $name is &quot;Bob&quot;</span>
</pre></div><p>The second parameter that can be passed is a <a class="el" href="class_c_m_formatter.html" title="A reuseable data formatter.">CMFormatter</a>, see <a class="el" href="manual__databases__fmt.html#manual_databases_fmt_intro">Using a Formatter</a> below.</p>
<h2><a class="anchor" id="manual_databases_fetch_fetchall">
Fetching All Data</a></h2>
<p>You may fetch all the data from a query with the fetchAll() method. Just like with fetch(), you can attach a row mode and formatter, but with a third option to determine the direction of how the database rows are joined. The possible values are: </p>
<table class="doxtable">
<tr>
<td><code>'horizontal'</code>  </td><td>Each row is appended to the return array. This is the default  </td></tr>
<tr>
<td><code>'vertical'</code>  </td><td>All the rows are appended in a single linear array.  </td></tr>
<tr>
<td><code>'single'</code>  </td><td>Only use the first row.  </td></tr>
</table>
<p>An example of using <code>'vertical'</code> row direction and <code>'cell'</code> to get a single array of IDs: </p>
<div class="fragment"><pre class="fragment"> $dbh = <span class="keyword">new</span> <a class="code" href="class_c_m_my_s_q_l.html" title="MySQL connectivity class.">CMMySQL</a>(<span class="stringliteral">&quot;mysql://root:abc123/test&quot;</span>);
 $q = $dbh-&gt;query(<span class="stringliteral">&quot;select id from mytable limit 5&quot;</span>);
 $ids = $q-&gt;fetchAll(<span class="stringliteral">&#39;cell&#39;</span>, <span class="stringliteral">&#39;vertical&#39;</span>); <span class="comment">// $ids = array(1, 5, 7, 9, 10)</span>
</pre></div><p>Or shorten the above code into a single line: </p>
<div class="fragment"><pre class="fragment"> $dbh = <span class="keyword">new</span> <a class="code" href="class_c_m_my_s_q_l.html" title="MySQL connectivity class.">CMMySQL</a>(<span class="stringliteral">&quot;mysql://root:abc123/test&quot;</span>);
 $ids = $dbh-&gt;query(<span class="stringliteral">&quot;select id from mytable limit 5&quot;</span>)-&gt;fetchAll(<span class="stringliteral">&#39;cell&#39;</span>, <span class="stringliteral">&#39;vertical&#39;</span>);
</pre></div> </div>
<hr size="1"/><address style="text-align: right;"><small>Generated by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.2 </small></address>
</body>
</html>
