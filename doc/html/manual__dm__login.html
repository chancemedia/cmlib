<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>CMLIB: 6.3. Handling Logins</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.6.2 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="navpath"><a class="el" href="manual.html">Manual</a>&nbsp;&raquo;&nbsp;<a class="el" href="manual__dm.html">6. Data Model</a>
  </div>
</div>
<div class="contents">
<h2><a class="anchor" id="manual_dm_login_contents">
Contents</a></h2>
<ol type="1">
<li><a class="el" href="manual__dm__login.html#manual_dm_login_example">Example</a></li>
<li><a class="el" href="manual__dm__login.html#manual_dm_login_logout">Issuing a Logout</a></li>
<li><a class="el" href="manual__dm__login.html#manual_dm_login_access">Pages That Require Special Levels of Access</a></li>
</ol>
<h2><a class="anchor" id="manual_dm_login_example">
Example</a></h2>
<div class="fragment"><pre class="fragment"> &lt;?php
 include_once(<span class="stringliteral">&quot;cmlib/lib/CMDataModel.php&quot;</span>);
 
 <span class="comment">// get the default data model</span>
 $dm = <a class="code" href="class_c_m_data_model.html#a8dd8e36efd073d98f8b297df8958053a" title="Get a data model by name.">CMDataModel::GetDataModel</a>();
 
 <span class="comment">// attach a database if this hasn&#39;t already been done, lets use MySQL</span>
 <span class="keywordflow">if</span>(!$dm-&gt;hasDatabase())
   $dm-&gt;setDatabase(<span class="keyword">new</span> <a class="code" href="class_c_m_my_s_q_l.html" title="MySQL connectivity class.">CMMySQL</a>(<span class="stringliteral">&quot;mysql://root:abcd1234@localhost/test&quot;</span>));
 
 <span class="comment">// if the login form was submitted</span>
 <span class="keywordflow">if</span>($dm-&gt;request(<span class="stringliteral">&#39;submit&#39;</span>)) {
  
   <span class="comment">// force the reset of a &#39;login&#39; pool</span>
   $dm-&gt;addPool(<span class="stringliteral">&#39;login&#39;</span>, <span class="keyword">true</span>);
   
   <span class="comment">// set the login credentials, the name of the pool variables must match the login data table</span>
   $dm-&gt;set(<span class="stringliteral">&#39;username&#39;</span>, $dm-&gt;request(<span class="stringliteral">&#39;user&#39;</span>), <span class="stringliteral">&#39;login&#39;</span>);
   $dm-&gt;set(<span class="stringliteral">&#39;password&#39;</span>, $dm-&gt;request(<span class="stringliteral">&#39;pass&#39;</span>), <span class="stringliteral">&#39;login&#39;</span>);
 }
 
 <span class="comment">// the above if statement is only performed when they need to login, after which point we only need</span>
 <span class="comment">// the following code on top of each protected page</span>
 <span class="comment">// the name of the table is &#39;account&#39; and the fields are &#39;username&#39; and &#39;password&#39; to validate</span>
 <span class="comment">// against. it is important the variable names in the pool match the field names in the pool.</span>
 <span class="comment">// if there login isn&#39;t valid we bounce them back to the login.php page.</span>
 <span class="keywordflow">if</span>(!$dm-&gt;recordExists(<span class="stringliteral">&#39;login&#39;</span>, <span class="stringliteral">&#39;account&#39;</span>))
   $dm-&gt;redirect(<span class="stringliteral">&quot;login.php&quot;</span>);
   
 <span class="comment">// the rest of your script will flow on from here ...</span>
</pre></div><h2><a class="anchor" id="manual_dm_login_logout">
Issuing a Logout</a></h2>
<p>In most cases issuing a logout is as easy as resetting the pool that contains the authentication information. Your script should be checking every page if the login credentials are correct, therefore if they are reset the next page will be able to throw them back to the login page.</p>
<p>For example if your pool that contains the login information is called <code>login</code> : </p>
<div class="fragment"><pre class="fragment"> <span class="comment">// to issue a logout, simply drain the pool</span>
 $dm-&gt;drainPool(<span class="stringliteral">&#39;login&#39;</span>);
 
 <span class="comment">// optional, throw them out right now</span>
 $dm-&gt;redirect(<span class="stringliteral">&quot;login.php&quot;</span>);
</pre></div><h2><a class="anchor" id="manual_dm_login_access">
Pages That Require Special Levels of Access</a></h2>
<p>It is common for some pages to require either different or higher level access. An example of this is to have a website where each client can login, but only the boss can reach the admin section of the site.</p>
<p>For the normal pages we can use the login method in the above example. For the admin pages we add an extra attribute that will not modify teh values inside the pool. </p>
<div class="fragment"><pre class="fragment"> <span class="keywordflow">if</span>(!$dm-&gt;recordExists(<span class="stringliteral">&#39;login&#39;</span>, <span class="stringliteral">&#39;account&#39;</span>, array(<span class="stringliteral">&#39;level&#39;</span> =&gt; <span class="stringliteral">&#39;admin&#39;</span>)))
   $dm-&gt;redirect(<span class="stringliteral">&quot;login.php?needsadmin=1&quot;</span>);
</pre></div> </div>
<hr size="1"/><address style="text-align: right;"><small>Generated by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.2 </small></address>
</body>
</html>
