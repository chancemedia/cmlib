<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>CMLIB: CMDataModel.php Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.6.3 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
    </ul>
  </div>
<h1>CMDataModel.php</h1><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 &lt;?php
<a name="l00002"></a>00002 
<a name="l00003"></a>00003 include_once(<span class="stringliteral">&#39;CMClass.php&#39;</span>);
<a name="l00004"></a>00004 include_once(<span class="stringliteral">&#39;CMForm.php&#39;</span>);
<a name="l00005"></a>00005 include_once(<span class="stringliteral">&#39;CMValidator.php&#39;</span>);
<a name="l00006"></a>00006 include_once(<span class="stringliteral">&#39;CMError.php&#39;</span>);
<a name="l00007"></a>00007 include_once(<span class="stringliteral">&#39;CMHeader.php&#39;</span>);
<a name="l00008"></a>00008 
<a name="l00009"></a>00009 <span class="comment">// we need to load these otherwise the session variables can&#39;t deal with the database objects</span>
<a name="l00010"></a>00010 include_once(<span class="stringliteral">&#39;CMMySQL.php&#39;</span>);
<a name="l00011"></a>00011 include_once(<span class="stringliteral">&#39;CMOracle.php&#39;</span>);
<a name="l00012"></a>00012 include_once(<span class="stringliteral">&#39;CMPostgreSQL.php&#39;</span>);
<a name="l00013"></a>00013 
<a name="l00024"></a><a class="code" href="class_c_m_data_model.html">00024</a> <span class="keyword">class </span><a class="code" href="class_c_m_data_model.html" title="Data model provides above-session data modeling.">CMDataModel</a> <span class="keyword">extends</span> <a class="code" href="class_c_m_error.html" title="Error handling as a stand-alone or for classes vis inheritance.">CMError</a> implements <a class="code" href="interface_c_m_class.html" title="CM class interface.">CMClass</a> {
<a name="l00025"></a>00025  
<a name="l00031"></a><a class="code" href="class_c_m_data_model.html#a9e2d53558e7b299d52b25c13d310d7e0">00031</a>  <span class="keyword">public</span> <span class="keyword">static</span> function <a class="code" href="class_c_m_data_model.html#a9e2d53558e7b299d52b25c13d310d7e0" title="The version of this class.">Version</a>() {
<a name="l00032"></a>00032   <span class="keywordflow">return</span> <span class="stringliteral">&quot;1.0&quot;</span>;
<a name="l00033"></a>00033  }
<a name="l00034"></a>00034  
<a name="l00040"></a><a class="code" href="class_c_m_data_model.html#ab51e04ce58ff27601a503f46d611b7e6">00040</a>  <span class="keyword">public</span> <span class="keyword">static</span> function <a class="code" href="class_c_m_data_model.html#ab51e04ce58ff27601a503f46d611b7e6" title="The version this class was introduced to the library.">Since</a>() {
<a name="l00041"></a>00041   <span class="keywordflow">return</span> <span class="stringliteral">&quot;1.0&quot;</span>;
<a name="l00042"></a>00042  }
<a name="l00043"></a>00043  
<a name="l00051"></a><a class="code" href="class_c_m_data_model.html#acc1e62674bb7200ea73767c19dc1344d">00051</a>  <span class="keyword">private</span> <a class="code" href="class_c_m_data_model.html#acc1e62674bb7200ea73767c19dc1344d" title="Database handle.">$dbh</a> = <span class="keyword">false</span>;
<a name="l00052"></a>00052  
<a name="l00060"></a><a class="code" href="class_c_m_data_model.html#a3d7d5a057f46532483faf54f490f7587">00060</a>  <span class="keyword">private</span> <a class="code" href="class_c_m_data_model.html#a3d7d5a057f46532483faf54f490f7587" title="CMValidator handle.">$vh</a> = <span class="keyword">false</span>;
<a name="l00061"></a>00061  
<a name="l00074"></a><a class="code" href="class_c_m_data_model.html#a0e235d3f271fa9c26b947e1e14158d60">00074</a>  <span class="keyword">private</span> <a class="code" href="class_c_m_data_model.html#a0e235d3f271fa9c26b947e1e14158d60" title="Storage pools.">$pool</a> = array();
<a name="l00075"></a>00075  
<a name="l00079"></a><a class="code" href="class_c_m_data_model.html#a48b5b0ee04d350a950f19d0167e298e5">00079</a>  <span class="keyword">public</span> <a class="code" href="class_c_m_data_model.html#a48b5b0ee04d350a950f19d0167e298e5" title="Values that will always be determined to be false (unchecked) with checkboxes.">$falseValues</a> = array();
<a name="l00080"></a>00080  
<a name="l00084"></a><a class="code" href="class_c_m_data_model.html#a6208b0249325c3aebd3d458a4045ea27">00084</a>  <span class="keyword">public</span> <a class="code" href="class_c_m_data_model.html#a6208b0249325c3aebd3d458a4045ea27" title="Values that will always be determined to be true (checked) with checkboxes.">$trueValues</a> = array();
<a name="l00085"></a>00085  
<a name="l00092"></a><a class="code" href="class_c_m_data_model.html#af7b6b0a1e84c7b824dacabe1fb1046c9">00092</a>  <span class="keyword">private</span> <span class="keyword">static</span> <a class="code" href="class_c_m_data_model.html#af7b6b0a1e84c7b824dacabe1fb1046c9" title="The global pool.">$GlobalPool</a> = array();
<a name="l00093"></a>00093  
<a name="l00097"></a><a class="code" href="class_c_m_data_model.html#ab2fc40d43824ea3e1ce5d86dee0d763b">00097</a>  <span class="keyword">private</span> <a class="code" href="class_c_m_data_model.html#ab2fc40d43824ea3e1ce5d86dee0d763b" title="The data model name.">$name</a> = <span class="stringliteral">&#39;default&#39;</span>;
<a name="l00098"></a>00098  
<a name="l00103"></a><a class="code" href="class_c_m_data_model.html#a643b6c1895fa14f4f0823c39ca043df1">00103</a>  <span class="keyword">public</span> <a class="code" href="class_c_m_data_model.html#a643b6c1895fa14f4f0823c39ca043df1" title="Keeps track of the URL history.">$history</a> = array();
<a name="l00104"></a>00104  
<a name="l00113"></a><a class="code" href="class_c_m_data_model.html#a24f2101b0f1705098ad7417306188585">00113</a>  <span class="keyword">public</span> function <a class="code" href="class_c_m_data_model.html#a24f2101b0f1705098ad7417306188585" title="Create or restore a data model.">CMDataModel</a>(<a class="code" href="class_c_m_data_model.html#ab2fc40d43824ea3e1ce5d86dee0d763b" title="The data model name.">$name</a> = <span class="stringliteral">&#39;default&#39;</span>) {
<a name="l00114"></a>00114   $this-&gt;name = <a class="code" href="class_c_m_data_model.html#ab2fc40d43824ea3e1ce5d86dee0d763b" title="The data model name.">$name</a>;
<a name="l00115"></a>00115   
<a name="l00116"></a>00116   <span class="comment">// setup default pools</span>
<a name="l00117"></a>00117   $this-&gt;<a class="code" href="class_c_m_data_model.html#ae558e743817dcb7f76ac6827045bdc28" title="Add a new pool.">addPool</a>(<span class="stringliteral">&#39;get&#39;</span>);
<a name="l00118"></a>00118   $this-&gt;<a class="code" href="class_c_m_data_model.html#ae558e743817dcb7f76ac6827045bdc28" title="Add a new pool.">addPool</a>(<span class="stringliteral">&#39;post&#39;</span>);
<a name="l00119"></a>00119   $this-&gt;<a class="code" href="class_c_m_data_model.html#ae558e743817dcb7f76ac6827045bdc28" title="Add a new pool.">addPool</a>(<span class="stringliteral">&#39;public&#39;</span>);
<a name="l00120"></a>00120  }
<a name="l00121"></a>00121  
<a name="l00128"></a><a class="code" href="class_c_m_data_model.html#afec8c3e49651ee1379432dbd22ec0fc9">00128</a>  <span class="keyword">public</span> <span class="keyword">static</span> function <a class="code" href="class_c_m_data_model.html#afec8c3e49651ee1379432dbd22ec0fc9" title="Check if a data model exists.">DataModelExists</a>(<a class="code" href="class_c_m_data_model.html#ab2fc40d43824ea3e1ce5d86dee0d763b" title="The data model name.">$name</a> = <span class="stringliteral">&#39;default&#39;</span>) {
<a name="l00129"></a>00129   <span class="keywordflow">return</span> isset($_SESSION[<span class="stringliteral">&quot;datamodel_$name&quot;</span>]);
<a name="l00130"></a>00130  }
<a name="l00131"></a>00131  
<a name="l00140"></a><a class="code" href="class_c_m_data_model.html#a8dd8e36efd073d98f8b297df8958053a">00140</a>  <span class="keyword">public</span> <span class="keyword">static</span> function <a class="code" href="class_c_m_data_model.html#a8dd8e36efd073d98f8b297df8958053a" title="Get a data model by name.">GetDataModel</a>(<a class="code" href="class_c_m_data_model.html#ab2fc40d43824ea3e1ce5d86dee0d763b" title="The data model name.">$name</a> = <span class="stringliteral">&#39;default&#39;</span>) {
<a name="l00141"></a>00141   <span class="comment">// create it if needed</span>
<a name="l00142"></a>00142   <span class="keywordflow">if</span>(!isset($_SESSION[<span class="stringliteral">&quot;datamodel_$name&quot;</span>]))
<a name="l00143"></a>00143    $_SESSION[<span class="stringliteral">&quot;datamodel_$name&quot;</span>] = <span class="keyword">new</span> <a class="code" href="class_c_m_data_model.html#a24f2101b0f1705098ad7417306188585" title="Create or restore a data model.">CMDataModel</a>(<a class="code" href="class_c_m_data_model.html#ab2fc40d43824ea3e1ce5d86dee0d763b" title="The data model name.">$name</a>);
<a name="l00144"></a>00144   $dm = $_SESSION[<span class="stringliteral">&quot;datamodel_$name&quot;</span>];
<a name="l00145"></a>00145   
<a name="l00146"></a>00146   <span class="comment">// load the $_GET and $_POST</span>
<a name="l00147"></a>00147   $dm-&gt;addPool(<span class="stringliteral">&#39;get&#39;</span>, <span class="keyword">true</span>);
<a name="l00148"></a>00148   $dm-&gt;addPool(<span class="stringliteral">&#39;post&#39;</span>, <span class="keyword">true</span>);
<a name="l00149"></a>00149   $dm-&gt;fillPool(<a class="code" href="class_c_m_form.html#a45099772beda49af1a9a9c2c2ec6032e" title="Internal function for recursing an array to remove slashes.">CMForm::StripSlashesRecursive</a>($_GET), <span class="stringliteral">&#39;get&#39;</span>);
<a name="l00150"></a>00150   $dm-&gt;fillPool(<a class="code" href="class_c_m_form.html#a45099772beda49af1a9a9c2c2ec6032e" title="Internal function for recursing an array to remove slashes.">CMForm::StripSlashesRecursive</a>($_POST), <span class="stringliteral">&#39;post&#39;</span>);
<a name="l00151"></a>00151   
<a name="l00152"></a>00152   <span class="comment">// fill custom pools</span>
<a name="l00153"></a>00153   <span class="keywordflow">foreach</span>($_POST as $k =&gt; $v) {
<a name="l00154"></a>00154    <span class="keywordflow">if</span>(is_array($v)) {
<a name="l00155"></a>00155     <span class="comment">// create the pool if needed</span>
<a name="l00156"></a>00156     <span class="keywordflow">if</span>(!$dm-&gt;poolExists($k))
<a name="l00157"></a>00157      $dm-&gt;addPool($k);
<a name="l00158"></a>00158     $dm-&gt;fillPool($v, $k);
<a name="l00159"></a>00159    }
<a name="l00160"></a>00160   }
<a name="l00161"></a>00161   
<a name="l00162"></a>00162   <span class="comment">// append history information</span>
<a name="l00163"></a>00163   array_push($dm-&gt;history, array(
<a name="l00164"></a>00164    <span class="stringliteral">&#39;url&#39;</span> =&gt; $_SERVER[<span class="stringliteral">&#39;PHP_SELF&#39;</span>],
<a name="l00165"></a>00165    <span class="stringliteral">&#39;ts&#39;</span> =&gt; time()
<a name="l00166"></a>00166   ));
<a name="l00167"></a>00167   
<a name="l00168"></a>00168   <span class="keywordflow">return</span> $dm;
<a name="l00169"></a>00169  }
<a name="l00170"></a>00170  
<a name="l00179"></a><a class="code" href="class_c_m_data_model.html#a9b09f509bd7fc4d845d88da10effef73">00179</a>  <span class="keyword">public</span> function <a class="code" href="class_c_m_data_model.html#a9b09f509bd7fc4d845d88da10effef73" title="Get this data model&amp;#39;s name.">getDataModelName</a>() {
<a name="l00180"></a>00180   <span class="keywordflow">return</span> $this-&gt;name;
<a name="l00181"></a>00181  }
<a name="l00182"></a>00182  
<a name="l00201"></a><a class="code" href="class_c_m_data_model.html#a2a97b9448f87f01d19d9a592da4b0895">00201</a>  <span class="keyword">public</span> function <span class="keyword">get</span>(<a class="code" href="class_c_m_data_model.html#ab2fc40d43824ea3e1ce5d86dee0d763b" title="The data model name.">$name</a>, <a class="code" href="class_c_m_data_model.html#a0e235d3f271fa9c26b947e1e14158d60" title="Storage pools.">$pool</a> = <span class="stringliteral">&#39;public&#39;</span>, $default = NULL) {
<a name="l00202"></a>00202   <span class="comment">// if the pool doesn&#39;t exist we&#39;ll chuck an error</span>
<a name="l00203"></a>00203   <span class="keywordflow">if</span>(!$this-&gt;<a class="code" href="class_c_m_data_model.html#abfaed3adbf6f1db8dca30cb6047fc27e" title="Check if a pool exists.">poolExists</a>(<a class="code" href="class_c_m_data_model.html#a0e235d3f271fa9c26b947e1e14158d60" title="Storage pools.">$pool</a>)) {
<a name="l00204"></a>00204    <span class="keywordflow">if</span>($default == NULL)
<a name="l00205"></a>00205     $this-&gt;<a class="code" href="class_c_m_error.html#a6d110c63a1c5103df7979612ed5209d3" title="Throw a Warning level message.">throwWarning</a>(<span class="stringliteral">&quot;Pool &#39;$pool&#39; does not exist.&quot;</span>);
<a name="l00206"></a>00206    <span class="keywordflow">return</span> $default;
<a name="l00207"></a>00207   }
<a name="l00208"></a>00208   
<a name="l00209"></a>00209   <span class="keywordflow">if</span>(!isset($this-&gt;pool[<a class="code" href="class_c_m_data_model.html#a0e235d3f271fa9c26b947e1e14158d60" title="Storage pools.">$pool</a>][<a class="code" href="class_c_m_data_model.html#ab2fc40d43824ea3e1ce5d86dee0d763b" title="The data model name.">$name</a>]))
<a name="l00210"></a>00210    <span class="keywordflow">return</span> $default;
<a name="l00211"></a>00211   
<a name="l00212"></a>00212   <span class="keywordflow">return</span> $this-&gt;pool[<a class="code" href="class_c_m_data_model.html#a0e235d3f271fa9c26b947e1e14158d60" title="Storage pools.">$pool</a>][$name];
<a name="l00213"></a>00213  }
<a name="l00214"></a>00214  
<a name="l00234"></a><a class="code" href="class_c_m_data_model.html#a1f953164304b3bd1f67192f6f35cc59e">00234</a>  <span class="keyword">public</span> function <span class="keyword">set</span>(<a class="code" href="class_c_m_data_model.html#ab2fc40d43824ea3e1ce5d86dee0d763b" title="The data model name.">$name</a>, $value = <span class="keyword">false</span>, <a class="code" href="class_c_m_data_model.html#a0e235d3f271fa9c26b947e1e14158d60" title="Storage pools.">$pool</a> = <span class="stringliteral">&#39;public&#39;</span>) {
<a name="l00235"></a>00235   <span class="comment">// make sure the pool exists</span>
<a name="l00236"></a>00236   <span class="keywordflow">if</span>(!$this-&gt;<a class="code" href="class_c_m_data_model.html#abfaed3adbf6f1db8dca30cb6047fc27e" title="Check if a pool exists.">poolExists</a>(<a class="code" href="class_c_m_data_model.html#a0e235d3f271fa9c26b947e1e14158d60" title="Storage pools.">$pool</a>)) {
<a name="l00237"></a>00237    $this-&gt;<a class="code" href="class_c_m_error.html#a6d110c63a1c5103df7979612ed5209d3" title="Throw a Warning level message.">throwWarning</a>(<span class="stringliteral">&quot;Pool &#39;$pool&#39; does not exist.&quot;</span>);
<a name="l00238"></a>00238    <span class="keywordflow">return</span> NULL;
<a name="l00239"></a>00239   }
<a name="l00240"></a>00240   
<a name="l00241"></a>00241   <span class="comment">// set the variable</span>
<a name="l00242"></a>00242   $this-&gt;pool[<a class="code" href="class_c_m_data_model.html#a0e235d3f271fa9c26b947e1e14158d60" title="Storage pools.">$pool</a>][<a class="code" href="class_c_m_data_model.html#ab2fc40d43824ea3e1ce5d86dee0d763b" title="The data model name.">$name</a>] = $value;
<a name="l00243"></a>00243   <span class="keywordflow">return</span> $this-&gt;pool[<a class="code" href="class_c_m_data_model.html#a0e235d3f271fa9c26b947e1e14158d60" title="Storage pools.">$pool</a>][<a class="code" href="class_c_m_data_model.html#ab2fc40d43824ea3e1ce5d86dee0d763b" title="The data model name.">$name</a>];
<a name="l00244"></a>00244  }
<a name="l00245"></a>00245  
<a name="l00255"></a><a class="code" href="class_c_m_data_model.html#a29d1c0715b5c0846850a2b9290755bc1">00255</a>  <span class="keyword">public</span> function <a class="code" href="class_c_m_data_model.html#a29d1c0715b5c0846850a2b9290755bc1" title="Request a variable from the $_GET or $_POST.">request</a>(<a class="code" href="class_c_m_data_model.html#ab2fc40d43824ea3e1ce5d86dee0d763b" title="The data model name.">$name</a>) {
<a name="l00256"></a>00256   <span class="keywordflow">if</span>($this-&gt;<a class="code" href="class_c_m_data_model.html#ac27d633cdc18300238fcaa81aecf0eac" title="Check if a variable exists in a pool.">exists</a>(<a class="code" href="class_c_m_data_model.html#ab2fc40d43824ea3e1ce5d86dee0d763b" title="The data model name.">$name</a>, <span class="stringliteral">&#39;get&#39;</span>))
<a name="l00257"></a>00257    <span class="keywordflow">return</span> $this-&gt;<span class="keyword">get</span>(<a class="code" href="class_c_m_data_model.html#ab2fc40d43824ea3e1ce5d86dee0d763b" title="The data model name.">$name</a>, <span class="stringliteral">&#39;get&#39;</span>);
<a name="l00258"></a>00258   <span class="keywordflow">if</span>($this-&gt;<a class="code" href="class_c_m_data_model.html#ac27d633cdc18300238fcaa81aecf0eac" title="Check if a variable exists in a pool.">exists</a>(<a class="code" href="class_c_m_data_model.html#ab2fc40d43824ea3e1ce5d86dee0d763b" title="The data model name.">$name</a>, <span class="stringliteral">&#39;post&#39;</span>))
<a name="l00259"></a>00259    <span class="keywordflow">return</span> $this-&gt;<span class="keyword">get</span>(<a class="code" href="class_c_m_data_model.html#ab2fc40d43824ea3e1ce5d86dee0d763b" title="The data model name.">$name</a>, <span class="stringliteral">&#39;post&#39;</span>);
<a name="l00260"></a>00260   <span class="keywordflow">return</span> NULL;
<a name="l00261"></a>00261  }
<a name="l00262"></a>00262  
<a name="l00271"></a><a class="code" href="class_c_m_data_model.html#aa92996ce6f6f81429d549faf1d20a550">00271</a>  <span class="keyword">public</span> function <a class="code" href="class_c_m_data_model.html#aa92996ce6f6f81429d549faf1d20a550" title="Get the CMValidator.">getValidator</a>() {
<a name="l00272"></a>00272   <span class="keywordflow">return</span> $this-&gt;vh;
<a name="l00273"></a>00273  }
<a name="l00274"></a>00274  
<a name="l00283"></a><a class="code" href="class_c_m_data_model.html#a1c1400750e7bf35be8c28e1f6d449df0">00283</a>  <span class="keyword">public</span> function <a class="code" href="class_c_m_data_model.html#a1c1400750e7bf35be8c28e1f6d449df0" title="Has the validator been set?">hasValidator</a>() {
<a name="l00284"></a>00284   <span class="keywordflow">return</span> $this-&gt;vh !== <span class="keyword">false</span>;
<a name="l00285"></a>00285  }
<a name="l00286"></a>00286  
<a name="l00295"></a><a class="code" href="class_c_m_data_model.html#a4aba85beb43b0d820c38eabb7bbe5eca">00295</a>  <span class="keyword">public</span> function <a class="code" href="class_c_m_data_model.html#a4aba85beb43b0d820c38eabb7bbe5eca" title="Has the database handle been set?">hasDatabase</a>() {
<a name="l00296"></a>00296   <span class="keywordflow">return</span> $this-&gt;dbh !== <span class="keyword">false</span>;
<a name="l00297"></a>00297  }
<a name="l00298"></a>00298  
<a name="l00310"></a><a class="code" href="class_c_m_data_model.html#afbe885d4740131bbe89e00f665a1daa8">00310</a>  <span class="keyword">public</span> function <a class="code" href="class_c_m_data_model.html#afbe885d4740131bbe89e00f665a1daa8" title="Redirect page location.">redirect</a>($url, $values = array()) {
<a name="l00311"></a>00311   <a class="code" href="class_c_m_header.html#a5c3c4d2173a776fe82497c09d60b2e14" title="Redirect the browser to a new location.">CMHeader::Location</a>($url, $values);
<a name="l00312"></a>00312  }
<a name="l00313"></a>00313  
<a name="l00321"></a><a class="code" href="class_c_m_data_model.html#ac27d633cdc18300238fcaa81aecf0eac">00321</a>  <span class="keyword">public</span> function <a class="code" href="class_c_m_data_model.html#ac27d633cdc18300238fcaa81aecf0eac" title="Check if a variable exists in a pool.">exists</a>(<a class="code" href="class_c_m_data_model.html#ab2fc40d43824ea3e1ce5d86dee0d763b" title="The data model name.">$name</a>, <a class="code" href="class_c_m_data_model.html#a0e235d3f271fa9c26b947e1e14158d60" title="Storage pools.">$pool</a> = <span class="stringliteral">&#39;public&#39;</span>) {
<a name="l00322"></a>00322   <span class="comment">// check if the pool exists</span>
<a name="l00323"></a>00323   <span class="keywordflow">if</span>(!isset($this-&gt;pool[<a class="code" href="class_c_m_data_model.html#a0e235d3f271fa9c26b947e1e14158d60" title="Storage pools.">$pool</a>]))
<a name="l00324"></a>00324    <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00325"></a>00325    
<a name="l00326"></a>00326   <span class="keywordflow">return</span> isset($this-&gt;pool[$pool][<a class="code" href="class_c_m_data_model.html#ab2fc40d43824ea3e1ce5d86dee0d763b" title="The data model name.">$name</a>]);
<a name="l00327"></a>00327  }
<a name="l00328"></a>00328  
<a name="l00338"></a><a class="code" href="class_c_m_data_model.html#a21dc9dc2d1c9b7568a44b44113240873">00338</a>  <span class="keyword">public</span> function <a class="code" href="class_c_m_data_model.html#a21dc9dc2d1c9b7568a44b44113240873" title="Set a variable in the global pool.">setGlobal</a>(<a class="code" href="class_c_m_data_model.html#ab2fc40d43824ea3e1ce5d86dee0d763b" title="The data model name.">$name</a>, $value = <span class="keyword">false</span>) {
<a name="l00339"></a>00339   <a class="code" href="class_c_m_data_model.html#af7b6b0a1e84c7b824dacabe1fb1046c9" title="The global pool.">CMDataModel::$GlobalPool</a>[<a class="code" href="class_c_m_data_model.html#ab2fc40d43824ea3e1ce5d86dee0d763b" title="The data model name.">$name</a>] = $value;
<a name="l00340"></a>00340   <span class="keywordflow">return</span> <a class="code" href="class_c_m_data_model.html#af7b6b0a1e84c7b824dacabe1fb1046c9" title="The global pool.">CMDataModel::$GlobalPool</a>[<a class="code" href="class_c_m_data_model.html#ab2fc40d43824ea3e1ce5d86dee0d763b" title="The data model name.">$name</a>];
<a name="l00341"></a>00341  }
<a name="l00342"></a>00342 
<a name="l00351"></a><a class="code" href="class_c_m_data_model.html#a599e0e3a81f394e0515eeadaf65a2bc8">00351</a>  <span class="keyword">public</span> function <a class="code" href="class_c_m_data_model.html#a599e0e3a81f394e0515eeadaf65a2bc8" title="Get a variable from the global pool.">getGlobal</a>(<a class="code" href="class_c_m_data_model.html#ab2fc40d43824ea3e1ce5d86dee0d763b" title="The data model name.">$name</a>) {
<a name="l00352"></a>00352   <span class="keywordflow">if</span>(!isset(<a class="code" href="class_c_m_data_model.html#af7b6b0a1e84c7b824dacabe1fb1046c9" title="The global pool.">CMDataModel::$GlobalPool</a>[<a class="code" href="class_c_m_data_model.html#ab2fc40d43824ea3e1ce5d86dee0d763b" title="The data model name.">$name</a>]))
<a name="l00353"></a>00353    <span class="keywordflow">return</span> NULL;
<a name="l00354"></a>00354    
<a name="l00355"></a>00355   <span class="keywordflow">return</span> <a class="code" href="class_c_m_data_model.html#af7b6b0a1e84c7b824dacabe1fb1046c9" title="The global pool.">CMDataModel::$GlobalPool</a>[$name];
<a name="l00356"></a>00356  }
<a name="l00357"></a>00357  
<a name="l00364"></a><a class="code" href="class_c_m_data_model.html#abfaed3adbf6f1db8dca30cb6047fc27e">00364</a>  <span class="keyword">public</span> function <a class="code" href="class_c_m_data_model.html#abfaed3adbf6f1db8dca30cb6047fc27e" title="Check if a pool exists.">poolExists</a>(<a class="code" href="class_c_m_data_model.html#ab2fc40d43824ea3e1ce5d86dee0d763b" title="The data model name.">$name</a> = <span class="stringliteral">&#39;public&#39;</span>) {
<a name="l00365"></a>00365   <span class="keywordflow">return</span> isset($this-&gt;pool[<a class="code" href="class_c_m_data_model.html#ab2fc40d43824ea3e1ce5d86dee0d763b" title="The data model name.">$name</a>]);
<a name="l00366"></a>00366  }
<a name="l00367"></a>00367  
<a name="l00377"></a><a class="code" href="class_c_m_data_model.html#a5adeb54831286c98f640c18264be9b8c">00377</a>  <span class="keyword">public</span> function <a class="code" href="class_c_m_data_model.html#a5adeb54831286c98f640c18264be9b8c" title="Set the database handle.">setDatabase</a>(<a class="code" href="interface_c_m_database_protocol.html" title="All database connectivity classes implement this interface.">CMDatabaseProtocol</a> $database) {
<a name="l00378"></a>00378   $this-&gt;dbh = $database;
<a name="l00379"></a>00379   <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00380"></a>00380  }
<a name="l00381"></a>00381  
<a name="l00391"></a><a class="code" href="class_c_m_data_model.html#a3ca68c1e5f52636ec4b548deff898dc7">00391</a>  <span class="keyword">public</span> function <a class="code" href="class_c_m_data_model.html#a3ca68c1e5f52636ec4b548deff898dc7" title="Delete a pool.">deletePool</a>(<a class="code" href="class_c_m_data_model.html#ab2fc40d43824ea3e1ce5d86dee0d763b" title="The data model name.">$name</a>) {
<a name="l00392"></a>00392   unset($_SESSION[<span class="stringliteral">&quot;datamodel_$name&quot;</span>]);
<a name="l00393"></a>00393   <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00394"></a>00394  }
<a name="l00395"></a>00395  
<a name="l00406"></a><a class="code" href="class_c_m_data_model.html#a728138a9219e8751278542c3a8c5e3a9">00406</a>  <span class="keyword">public</span> function <a class="code" href="class_c_m_data_model.html#a728138a9219e8751278542c3a8c5e3a9" title="Return the database handle.">getDatabase</a>() {
<a name="l00407"></a>00407   <span class="keywordflow">return</span> $this-&gt;dbh;
<a name="l00408"></a>00408  }
<a name="l00409"></a>00409  
<a name="l00419"></a><a class="code" href="class_c_m_data_model.html#a4319ce5ab58d1596139a4cee9696b2dc">00419</a>  <span class="keyword">public</span> function <a class="code" href="class_c_m_data_model.html#a4319ce5ab58d1596139a4cee9696b2dc" title="Drain (reset, wipe, clear) a pool or pools of all its variables.">drainPool</a>(<a class="code" href="class_c_m_data_model.html#ab2fc40d43824ea3e1ce5d86dee0d763b" title="The data model name.">$name</a> = <span class="stringliteral">&#39;public&#39;</span>) {
<a name="l00420"></a>00420   <span class="comment">// recurse if needed</span>
<a name="l00421"></a>00421   <span class="keywordflow">if</span>(is_array(<a class="code" href="class_c_m_data_model.html#ab2fc40d43824ea3e1ce5d86dee0d763b" title="The data model name.">$name</a>)) {
<a name="l00422"></a>00422    <span class="keywordflow">foreach</span>(<a class="code" href="class_c_m_data_model.html#ab2fc40d43824ea3e1ce5d86dee0d763b" title="The data model name.">$name</a> as $n) {
<a name="l00423"></a>00423     <span class="keywordflow">if</span>(!$this-&gt;<a class="code" href="class_c_m_data_model.html#a4319ce5ab58d1596139a4cee9696b2dc" title="Drain (reset, wipe, clear) a pool or pools of all its variables.">drainPool</a>($n))
<a name="l00424"></a>00424      <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00425"></a>00425    }
<a name="l00426"></a>00426    <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00427"></a>00427   }
<a name="l00428"></a>00428   
<a name="l00429"></a>00429   <span class="comment">// make sure the pool exists</span>
<a name="l00430"></a>00430   <span class="keywordflow">if</span>(!$this-&gt;<a class="code" href="class_c_m_data_model.html#abfaed3adbf6f1db8dca30cb6047fc27e" title="Check if a pool exists.">poolExists</a>(<a class="code" href="class_c_m_data_model.html#ab2fc40d43824ea3e1ce5d86dee0d763b" title="The data model name.">$name</a>)) {
<a name="l00431"></a>00431    $this-&gt;<a class="code" href="class_c_m_error.html#a979e2a7fdb7568763efba5d34f763ea7" title="Throw a Notice level message.">throwNotice</a>(<span class="stringliteral">&quot;Pool &#39;$name&#39; does not exist.&quot;</span>);
<a name="l00432"></a>00432    <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00433"></a>00433   }
<a name="l00434"></a>00434   
<a name="l00435"></a>00435   <span class="comment">// drain pool</span>
<a name="l00436"></a>00436   $this-&gt;pool[<a class="code" href="class_c_m_data_model.html#ab2fc40d43824ea3e1ce5d86dee0d763b" title="The data model name.">$name</a>] = array();
<a name="l00437"></a>00437   
<a name="l00438"></a>00438   <span class="comment">// drain validator</span>
<a name="l00439"></a>00439   <span class="keywordflow">if</span>($this-&gt;vh !== <span class="keyword">false</span>) {
<a name="l00440"></a>00440    <span class="keywordflow">foreach</span>($this-&gt;vh-&gt;invalidFields as $k =&gt; $v) {
<a name="l00441"></a>00441     $pos = strpos($k, <span class="charliteral">&#39;[&#39;</span>);
<a name="l00442"></a>00442     <span class="keywordflow">if</span>($pos !== <span class="keyword">false</span> &amp;&amp; substr($k, 0, $pos) == <a class="code" href="class_c_m_data_model.html#ab2fc40d43824ea3e1ce5d86dee0d763b" title="The data model name.">$name</a>)
<a name="l00443"></a>00443      unset($this-&gt;vh-&gt;invalidFields[$k]);
<a name="l00444"></a>00444    }
<a name="l00445"></a>00445   }
<a name="l00446"></a>00446   
<a name="l00447"></a>00447   <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00448"></a>00448  }
<a name="l00449"></a>00449  
<a name="l00462"></a><a class="code" href="class_c_m_data_model.html#a184909dab34698899937d810a9f5d393">00462</a>  <span class="keyword">public</span> function <a class="code" href="class_c_m_data_model.html#a184909dab34698899937d810a9f5d393" title="Validate.">validate</a>() {
<a name="l00463"></a>00463   <span class="comment">// make sure we have a validating object</span>
<a name="l00464"></a>00464   <span class="keywordflow">if</span>($this-&gt;vh === <span class="keyword">false</span>)
<a name="l00465"></a>00465    <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00466"></a>00466   
<a name="l00467"></a>00467   <span class="keywordflow">return</span> $this-&gt;vh-&gt;validate($this);
<a name="l00468"></a>00468  }
<a name="l00469"></a>00469  
<a name="l00479"></a><a class="code" href="class_c_m_data_model.html#abf7461b9c7ab978f032ca285f6fa00f6">00479</a>  <span class="keyword">public</span> function <a class="code" href="class_c_m_data_model.html#abf7461b9c7ab978f032ca285f6fa00f6" title="Set the validator object.">setValidator</a>(<a class="code" href="class_c_m_validator.html" title="Validation interface.">CMValidator</a> $validator) {
<a name="l00480"></a>00480   $this-&gt;vh = $validator;
<a name="l00481"></a>00481   <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00482"></a>00482  }
<a name="l00483"></a>00483  
<a name="l00492"></a><a class="code" href="class_c_m_data_model.html#aee3546ecf44233d599e9c38d2ad30b44">00492</a>  <span class="keyword">public</span> function <a class="code" href="class_c_m_data_model.html#aee3546ecf44233d599e9c38d2ad30b44" title="Get a pool as an array.">getPool</a>(<a class="code" href="class_c_m_data_model.html#ab2fc40d43824ea3e1ce5d86dee0d763b" title="The data model name.">$name</a> = <span class="stringliteral">&#39;public&#39;</span>) {
<a name="l00493"></a>00493   <span class="comment">// make sure the pool exists</span>
<a name="l00494"></a>00494   <span class="keywordflow">if</span>(!$this-&gt;<a class="code" href="class_c_m_data_model.html#abfaed3adbf6f1db8dca30cb6047fc27e" title="Check if a pool exists.">poolExists</a>(<a class="code" href="class_c_m_data_model.html#ab2fc40d43824ea3e1ce5d86dee0d763b" title="The data model name.">$name</a>)) {
<a name="l00495"></a>00495    $this-&gt;<a class="code" href="class_c_m_error.html#a6d110c63a1c5103df7979612ed5209d3" title="Throw a Warning level message.">throwWarning</a>(<span class="stringliteral">&quot;Pool &#39;$name&#39; does not exist.&quot;</span>);
<a name="l00496"></a>00496    <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00497"></a>00497   }
<a name="l00498"></a>00498   
<a name="l00499"></a>00499   <span class="keywordflow">return</span> $this-&gt;pool[<a class="code" href="class_c_m_data_model.html#ab2fc40d43824ea3e1ce5d86dee0d763b" title="The data model name.">$name</a>];
<a name="l00500"></a>00500  }
<a name="l00501"></a>00501  
<a name="l00523"></a><a class="code" href="class_c_m_data_model.html#a22665a019691286a583d60776c1b876a">00523</a>  <span class="keyword">public</span> function <a class="code" href="class_c_m_data_model.html#a22665a019691286a583d60776c1b876a" title="Perform a database INSERT.">databaseInsert</a>($tableName, $fields = <span class="stringliteral">&#39;auto&#39;</span>, $a = <span class="keyword">false</span>) {
<a name="l00524"></a>00524   <span class="comment">// if the $fields are &#39;auto&#39; we use the pool that is the same name as the table</span>
<a name="l00525"></a>00525   <span class="keywordflow">if</span>($fields == <span class="stringliteral">&#39;auto&#39;</span>) {
<a name="l00526"></a>00526    <span class="keywordflow">if</span>(!$this-&gt;<a class="code" href="class_c_m_data_model.html#abfaed3adbf6f1db8dca30cb6047fc27e" title="Check if a pool exists.">poolExists</a>($tableName))
<a name="l00527"></a>00527     <span class="keywordflow">return</span> $this-&gt;<a class="code" href="class_c_m_error.html#a6d110c63a1c5103df7979612ed5209d3" title="Throw a Warning level message.">throwWarning</a>(<span class="stringliteral">&quot;Pool &#39;$tableName&#39; does not exist.&quot;</span>);
<a name="l00528"></a>00528    $fields = $this-&gt;pool[$tableName];
<a name="l00529"></a>00529   }
<a name="l00530"></a>00530    
<a name="l00531"></a>00531   <span class="comment">// we need a database handle</span>
<a name="l00532"></a>00532   <span class="keywordflow">if</span>(!$this-&gt;dbh)
<a name="l00533"></a>00533    <span class="keywordflow">return</span> $this-&gt;<a class="code" href="class_c_m_error.html#a6d110c63a1c5103df7979612ed5209d3" title="Throw a Warning level message.">throwWarning</a>(<span class="stringliteral">&quot;No database handle.&quot;</span>);
<a name="l00534"></a>00534   
<a name="l00535"></a>00535   <span class="comment">// perform the insert</span>
<a name="l00536"></a>00536   <span class="keywordflow">return</span> $this-&gt;dbh-&gt;insert($tableName, $fields, $a);
<a name="l00537"></a>00537  }
<a name="l00538"></a>00538  
<a name="l00556"></a><a class="code" href="class_c_m_data_model.html#aab90eeaafcae186a2c69527311544e94">00556</a>  <span class="keyword">public</span> function <a class="code" href="class_c_m_data_model.html#aab90eeaafcae186a2c69527311544e94" title="Perform a database UPDATE.">databaseUpdate</a>($tableName, $filter, $fields = <span class="stringliteral">&#39;auto&#39;</span>, $a = <span class="keyword">false</span>) {
<a name="l00557"></a>00557   <span class="comment">// if the $fields are &#39;auto&#39; we use the pool that is the same name as the table</span>
<a name="l00558"></a>00558   <span class="keywordflow">if</span>($fields == <span class="stringliteral">&#39;auto&#39;</span>) {
<a name="l00559"></a>00559    <span class="keywordflow">if</span>(!$this-&gt;<a class="code" href="class_c_m_data_model.html#abfaed3adbf6f1db8dca30cb6047fc27e" title="Check if a pool exists.">poolExists</a>($tableName))
<a name="l00560"></a>00560     <span class="keywordflow">return</span> $this-&gt;<a class="code" href="class_c_m_error.html#a6d110c63a1c5103df7979612ed5209d3" title="Throw a Warning level message.">throwWarning</a>(<span class="stringliteral">&quot;Pool &#39;$tableName&#39; does not exist.&quot;</span>);
<a name="l00561"></a>00561    $fields = $this-&gt;pool[$tableName];
<a name="l00562"></a>00562   }
<a name="l00563"></a>00563    
<a name="l00564"></a>00564   <span class="comment">// we need a database handle</span>
<a name="l00565"></a>00565   <span class="keywordflow">if</span>(!$this-&gt;dbh)
<a name="l00566"></a>00566    <span class="keywordflow">return</span> $this-&gt;<a class="code" href="class_c_m_error.html#a6d110c63a1c5103df7979612ed5209d3" title="Throw a Warning level message.">throwWarning</a>(<span class="stringliteral">&quot;No database handle.&quot;</span>);
<a name="l00567"></a>00567   
<a name="l00568"></a>00568   <span class="comment">// perform the update</span>
<a name="l00569"></a>00569   <span class="keywordflow">return</span> $this-&gt;dbh-&gt;update($tableName, $fields, $filter, $a);
<a name="l00570"></a>00570  }
<a name="l00571"></a>00571  
<a name="l00588"></a><a class="code" href="class_c_m_data_model.html#ad7089636cd9321b024e682ed9f90bed6">00588</a>  <span class="keyword">public</span> function <a class="code" href="class_c_m_data_model.html#ad7089636cd9321b024e682ed9f90bed6" title="Perform a database DELETE.">databaseDelete</a>($tableName, $filter, $a = <span class="keyword">false</span>) {
<a name="l00589"></a>00589   <span class="comment">// we need a database handle</span>
<a name="l00590"></a>00590   <span class="keywordflow">if</span>(!$this-&gt;dbh)
<a name="l00591"></a>00591    <span class="keywordflow">return</span> $this-&gt;<a class="code" href="class_c_m_error.html#a6d110c63a1c5103df7979612ed5209d3" title="Throw a Warning level message.">throwWarning</a>(<span class="stringliteral">&quot;No database handle.&quot;</span>);
<a name="l00592"></a>00592   
<a name="l00593"></a>00593   <span class="comment">// perform the delete</span>
<a name="l00594"></a>00594   <span class="keywordflow">return</span> $this-&gt;dbh-&gt;delete($tableName, $filter, $a);
<a name="l00595"></a>00595  }
<a name="l00596"></a>00596  
<a name="l00605"></a><a class="code" href="class_c_m_data_model.html#ae558e743817dcb7f76ac6827045bdc28">00605</a>  <span class="keyword">public</span> function <a class="code" href="class_c_m_data_model.html#ae558e743817dcb7f76ac6827045bdc28" title="Add a new pool.">addPool</a>(<a class="code" href="class_c_m_data_model.html#ab2fc40d43824ea3e1ce5d86dee0d763b" title="The data model name.">$name</a>, $replace = <span class="keyword">false</span>) {
<a name="l00606"></a>00606   <span class="comment">// if $replace is off and the pool exists we take no action</span>
<a name="l00607"></a>00607   <span class="keywordflow">if</span>(!$replace &amp;&amp; $this-&gt;<a class="code" href="class_c_m_data_model.html#abfaed3adbf6f1db8dca30cb6047fc27e" title="Check if a pool exists.">poolExists</a>(<a class="code" href="class_c_m_data_model.html#ab2fc40d43824ea3e1ce5d86dee0d763b" title="The data model name.">$name</a>))
<a name="l00608"></a>00608    <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00609"></a>00609   
<a name="l00610"></a>00610   $this-&gt;pool[<a class="code" href="class_c_m_data_model.html#ab2fc40d43824ea3e1ce5d86dee0d763b" title="The data model name.">$name</a>] = array();
<a name="l00611"></a>00611   <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00612"></a>00612  }
<a name="l00613"></a>00613  
<a name="l00624"></a><a class="code" href="class_c_m_data_model.html#aba80786f64c89c654783baddf84c8fbc">00624</a>  <span class="keyword">public</span> function <a class="code" href="class_c_m_data_model.html#aba80786f64c89c654783baddf84c8fbc" title="Fill (but not wipe) a pool from an array.">fillPool</a>(array $values, <a class="code" href="class_c_m_data_model.html#ab2fc40d43824ea3e1ce5d86dee0d763b" title="The data model name.">$name</a> = <span class="stringliteral">&#39;public&#39;</span>) {
<a name="l00625"></a>00625   <span class="comment">// make sure the pool exists</span>
<a name="l00626"></a>00626   <span class="keywordflow">if</span>(!$this-&gt;<a class="code" href="class_c_m_data_model.html#abfaed3adbf6f1db8dca30cb6047fc27e" title="Check if a pool exists.">poolExists</a>(<a class="code" href="class_c_m_data_model.html#ab2fc40d43824ea3e1ce5d86dee0d763b" title="The data model name.">$name</a>))
<a name="l00627"></a>00627    <span class="keywordflow">return</span> $this-&gt;<a class="code" href="class_c_m_error.html#a6d110c63a1c5103df7979612ed5209d3" title="Throw a Warning level message.">throwWarning</a>(<span class="stringliteral">&quot;Pool &#39;$name&#39; does not exist.&quot;</span>);
<a name="l00628"></a>00628   
<a name="l00629"></a>00629   <span class="comment">// add items to the pool</span>
<a name="l00630"></a>00630   <span class="keywordflow">foreach</span>($values as $k =&gt; $v)
<a name="l00631"></a>00631    $this-&gt;pool[<a class="code" href="class_c_m_data_model.html#ab2fc40d43824ea3e1ce5d86dee0d763b" title="The data model name.">$name</a>][$k] = $v;
<a name="l00632"></a>00632   
<a name="l00633"></a>00633   <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00634"></a>00634  }
<a name="l00635"></a>00635  
<a name="l00641"></a><a class="code" href="class_c_m_data_model.html#a7b2c35294ce6c20349be500ed59bb96d">00641</a>  <span class="keyword">public</span> <span class="keyword">static</span> function <a class="code" href="class_c_m_data_model.html#a7b2c35294ce6c20349be500ed59bb96d" title="Get the names of all the data models connected with this session.">GetDataModelNames</a>() {
<a name="l00642"></a>00642   $r = array();
<a name="l00643"></a>00643   <span class="keywordflow">foreach</span>(array_keys($_SESSION) as $k) {
<a name="l00644"></a>00644    <span class="keywordflow">if</span>(substr($k, 0, 10) == <span class="stringliteral">&#39;datamodel_&#39;</span>)
<a name="l00645"></a>00645     array_push($r, substr($k, 10));
<a name="l00646"></a>00646   }
<a name="l00647"></a>00647   <span class="keywordflow">return</span> $r;
<a name="l00648"></a>00648  }
<a name="l00649"></a>00649  
<a name="l00658"></a><a class="code" href="class_c_m_data_model.html#a64651b904ad25f480669c2c02a6d9b88">00658</a>  <span class="keyword">public</span> <span class="keyword">static</span> function <a class="code" href="class_c_m_data_model.html#a64651b904ad25f480669c2c02a6d9b88" title="Create a new data model.">CreateDataModel</a>(<a class="code" href="class_c_m_data_model.html#ab2fc40d43824ea3e1ce5d86dee0d763b" title="The data model name.">$name</a> = <span class="stringliteral">&#39;default&#39;</span>, $force = <span class="keyword">false</span>) {
<a name="l00659"></a>00659   <span class="comment">// check if the data model already exists</span>
<a name="l00660"></a>00660   <span class="keywordflow">if</span>(isset($_SESSION[<span class="stringliteral">&quot;datamodel_$name&quot;</span>])) {
<a name="l00661"></a>00661    <span class="keywordflow">if</span>($force)
<a name="l00662"></a>00662     $_SESSION[<span class="stringliteral">&quot;datamodel_$name&quot;</span>] = <span class="keyword">new</span> <a class="code" href="class_c_m_data_model.html#a24f2101b0f1705098ad7417306188585" title="Create or restore a data model.">CMDataModel</a>(<a class="code" href="class_c_m_data_model.html#ab2fc40d43824ea3e1ce5d86dee0d763b" title="The data model name.">$name</a>);
<a name="l00663"></a>00663   } <span class="keywordflow">else</span> $_SESSION[<span class="stringliteral">&quot;datamodel_$name&quot;</span>] = <span class="keyword">new</span> <a class="code" href="class_c_m_data_model.html#a24f2101b0f1705098ad7417306188585" title="Create or restore a data model.">CMDataModel</a>(<a class="code" href="class_c_m_data_model.html#ab2fc40d43824ea3e1ce5d86dee0d763b" title="The data model name.">$name</a>);
<a name="l00664"></a>00664   
<a name="l00665"></a>00665   <span class="keywordflow">return</span> $_SESSION[<span class="stringliteral">&quot;datamodel_$name&quot;</span>];
<a name="l00666"></a>00666  }
<a name="l00667"></a>00667  
<a name="l00674"></a><a class="code" href="class_c_m_data_model.html#a5d4e6d0d4d9300f9ab2c4c5d7cf4998d">00674</a>  <span class="keyword">public</span> <span class="keyword">static</span> function <a class="code" href="class_c_m_data_model.html#a5d4e6d0d4d9300f9ab2c4c5d7cf4998d" title="Delete a data model.">DeleteDataModel</a>(<a class="code" href="class_c_m_data_model.html#ab2fc40d43824ea3e1ce5d86dee0d763b" title="The data model name.">$name</a> = <span class="stringliteral">&#39;default&#39;</span>) {
<a name="l00675"></a>00675   unset($_SESSION[<span class="stringliteral">&quot;datamodel_$name&quot;</span>]);
<a name="l00676"></a>00676   <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00677"></a>00677  }
<a name="l00678"></a>00678  
<a name="l00684"></a><a class="code" href="class_c_m_data_model.html#a66670e930bddd69a482c10c634a9f056">00684</a>  <span class="keyword">public</span> function <a class="code" href="class_c_m_data_model.html#a66670e930bddd69a482c10c634a9f056" title="Get history URLs.">getHistory</a>() {
<a name="l00685"></a>00685   <span class="keywordflow">return</span> $this-&gt;history;
<a name="l00686"></a>00686  }
<a name="l00687"></a>00687  
<a name="l00694"></a><a class="code" href="class_c_m_data_model.html#a1dc5caf4c20fbcf9ca3976a3e7de74aa">00694</a>  <span class="keyword">public</span> function <a class="code" href="class_c_m_data_model.html#a1dc5caf4c20fbcf9ca3976a3e7de74aa" title="Submit to a previous location.">submitBackwards</a>($length = 1) {
<a name="l00695"></a>00695   $this-&gt;<a class="code" href="class_c_m_data_model.html#afbe885d4740131bbe89e00f665a1daa8" title="Redirect page location.">redirect</a>($this-&gt;history[count($this-&gt;history) - $length - 1][<span class="stringliteral">&#39;url&#39;</span>]);
<a name="l00696"></a>00696  }
<a name="l00697"></a>00697  
<a name="l00708"></a><a class="code" href="class_c_m_data_model.html#a71960d5bc22f30db33c43e2f4f3e72b5">00708</a>  <span class="keyword">public</span> function <a class="code" href="class_c_m_data_model.html#a71960d5bc22f30db33c43e2f4f3e72b5" title="Extract the bare name and real value from a variable.">extractNameValue</a>(<a class="code" href="class_c_m_data_model.html#ab2fc40d43824ea3e1ce5d86dee0d763b" title="The data model name.">$name</a>, $a = array()) {
<a name="l00709"></a>00709   $pos = strpos(<a class="code" href="class_c_m_data_model.html#ab2fc40d43824ea3e1ce5d86dee0d763b" title="The data model name.">$name</a>, <span class="charliteral">&#39;[&#39;</span>);
<a name="l00710"></a>00710   <span class="keywordflow">if</span>($pos !== <span class="keyword">false</span>) {
<a name="l00711"></a>00711    <a class="code" href="class_c_m_data_model.html#a0e235d3f271fa9c26b947e1e14158d60" title="Storage pools.">$pool</a> = substr(<a class="code" href="class_c_m_data_model.html#ab2fc40d43824ea3e1ce5d86dee0d763b" title="The data model name.">$name</a>, 0, $pos);
<a name="l00712"></a>00712    $newname = substr(<a class="code" href="class_c_m_data_model.html#ab2fc40d43824ea3e1ce5d86dee0d763b" title="The data model name.">$name</a>, $pos + 1, strlen(<a class="code" href="class_c_m_data_model.html#ab2fc40d43824ea3e1ce5d86dee0d763b" title="The data model name.">$name</a>) - $pos - 2);
<a name="l00713"></a>00713    
<a name="l00714"></a>00714    $value = <span class="stringliteral">&#39;&#39;</span>;
<a name="l00715"></a>00715    <span class="keywordflow">if</span>(isset($a[<span class="stringliteral">&#39;name&#39;</span>]))
<a name="l00716"></a>00716     <a class="code" href="class_c_m_data_model.html#ab2fc40d43824ea3e1ce5d86dee0d763b" title="The data model name.">$name</a> = $a[<span class="stringliteral">&#39;name&#39;</span>];
<a name="l00717"></a>00717    <span class="keywordflow">if</span>(isset($this-&gt;pool[<a class="code" href="class_c_m_data_model.html#a0e235d3f271fa9c26b947e1e14158d60" title="Storage pools.">$pool</a>][$newname]))
<a name="l00718"></a>00718     $value = $this-&gt;pool[<a class="code" href="class_c_m_data_model.html#a0e235d3f271fa9c26b947e1e14158d60" title="Storage pools.">$pool</a>][$newname];
<a name="l00719"></a>00719    <span class="keywordflow">if</span>(isset($a[<span class="stringliteral">&#39;value&#39;</span>]))
<a name="l00720"></a>00720     $value = $a[<span class="stringliteral">&#39;value&#39;</span>];
<a name="l00721"></a>00721    
<a name="l00722"></a>00722    <span class="keywordflow">return</span> array(<a class="code" href="class_c_m_data_model.html#ab2fc40d43824ea3e1ce5d86dee0d763b" title="The data model name.">$name</a>, $value);
<a name="l00723"></a>00723   }
<a name="l00724"></a>00724    
<a name="l00725"></a>00725   $value = <span class="stringliteral">&#39;&#39;</span>;
<a name="l00726"></a>00726   <span class="keywordflow">if</span>(isset($a[<span class="stringliteral">&#39;name&#39;</span>]))
<a name="l00727"></a>00727    <a class="code" href="class_c_m_data_model.html#ab2fc40d43824ea3e1ce5d86dee0d763b" title="The data model name.">$name</a> = $a[<span class="stringliteral">&#39;name&#39;</span>];
<a name="l00728"></a>00728   <span class="keywordflow">if</span>(isset($this-&gt;pool[<span class="stringliteral">&#39;public&#39;</span>][<a class="code" href="class_c_m_data_model.html#ab2fc40d43824ea3e1ce5d86dee0d763b" title="The data model name.">$name</a>]))
<a name="l00729"></a>00729    $value = $this-&gt;pool[<span class="stringliteral">&#39;public&#39;</span>][$name];
<a name="l00730"></a>00730   <span class="keywordflow">if</span>(isset($a[<span class="stringliteral">&#39;value&#39;</span>]))
<a name="l00731"></a>00731    $value = $a[<span class="stringliteral">&#39;value&#39;</span>];
<a name="l00732"></a>00732    
<a name="l00733"></a>00733   <span class="keywordflow">return</span> array($name, $value);
<a name="l00734"></a>00734  }
<a name="l00735"></a>00735  
<a name="l00749"></a><a class="code" href="class_c_m_data_model.html#a762b23e6a00e0019ccbd443394d4aab3">00749</a>  <span class="keyword">public</span> function <a class="code" href="class_c_m_data_model.html#a762b23e6a00e0019ccbd443394d4aab3" title="Render a text box.">textBox</a>(<a class="code" href="class_c_m_data_model.html#ab2fc40d43824ea3e1ce5d86dee0d763b" title="The data model name.">$name</a> = <span class="stringliteral">&#39;textbox&#39;</span>, $a = <span class="keyword">false</span>) {
<a name="l00750"></a>00750   list($a[<span class="stringliteral">&#39;name&#39;</span>], $a[<span class="stringliteral">&#39;value&#39;</span>]) = $this-&gt;<a class="code" href="class_c_m_data_model.html#a71960d5bc22f30db33c43e2f4f3e72b5" title="Extract the bare name and real value from a variable.">extractNameValue</a>(<a class="code" href="class_c_m_data_model.html#ab2fc40d43824ea3e1ce5d86dee0d763b" title="The data model name.">$name</a>, $a);
<a name="l00751"></a>00751   <span class="keywordflow">return</span> <a class="code" href="class_c_m_form.html#adaefe5e02971807c89f7dde072e91769" title="Create a single line text box.">CMForm::TextBox</a>($a);
<a name="l00752"></a>00752  }
<a name="l00753"></a>00753  
<a name="l00767"></a><a class="code" href="class_c_m_data_model.html#a66fd591c492407a2df6e688a2fc7f106">00767</a>  <span class="keyword">public</span> function <a class="code" href="class_c_m_data_model.html#a66fd591c492407a2df6e688a2fc7f106" title="Render a file uploader box.">fileBox</a>(<a class="code" href="class_c_m_data_model.html#ab2fc40d43824ea3e1ce5d86dee0d763b" title="The data model name.">$name</a> = <span class="stringliteral">&#39;fileupload&#39;</span>, $a = <span class="keyword">false</span>) {
<a name="l00768"></a>00768   list($a[<span class="stringliteral">&#39;name&#39;</span>], $a[<span class="stringliteral">&#39;value&#39;</span>]) = $this-&gt;<a class="code" href="class_c_m_data_model.html#a71960d5bc22f30db33c43e2f4f3e72b5" title="Extract the bare name and real value from a variable.">extractNameValue</a>(<a class="code" href="class_c_m_data_model.html#ab2fc40d43824ea3e1ce5d86dee0d763b" title="The data model name.">$name</a>, $a);
<a name="l00769"></a>00769   <span class="keywordflow">return</span> <a class="code" href="class_c_m_form.html#a65e67db547eda9b893b3eae796ec220b" title="File upload box.">CMForm::FileBox</a>($a);
<a name="l00770"></a>00770  }
<a name="l00771"></a>00771  
<a name="l00785"></a><a class="code" href="class_c_m_data_model.html#ad26bcd016934fae591c02792499c2044">00785</a>  <span class="keyword">public</span> function <a class="code" href="class_c_m_data_model.html#ad26bcd016934fae591c02792499c2044" title="Render a password box.">passwordBox</a>(<a class="code" href="class_c_m_data_model.html#ab2fc40d43824ea3e1ce5d86dee0d763b" title="The data model name.">$name</a> = <span class="stringliteral">&#39;password&#39;</span>, $a = <span class="keyword">false</span>) {
<a name="l00786"></a>00786   list($a[<span class="stringliteral">&#39;name&#39;</span>], $a[<span class="stringliteral">&#39;value&#39;</span>]) = $this-&gt;<a class="code" href="class_c_m_data_model.html#a71960d5bc22f30db33c43e2f4f3e72b5" title="Extract the bare name and real value from a variable.">extractNameValue</a>(<a class="code" href="class_c_m_data_model.html#ab2fc40d43824ea3e1ce5d86dee0d763b" title="The data model name.">$name</a>, $a);
<a name="l00787"></a>00787   <span class="keywordflow">return</span> <a class="code" href="class_c_m_form.html#a3cfe321b6ef9794e10a6bc86f7055989" title="Create a password box.">CMForm::PasswordBox</a>($a);
<a name="l00788"></a>00788  }
<a name="l00789"></a>00789  
<a name="l00803"></a><a class="code" href="class_c_m_data_model.html#aa9dbd120c2e29cedd656db7d8be5e919">00803</a>  <span class="keyword">public</span> function <a class="code" href="class_c_m_data_model.html#aa9dbd120c2e29cedd656db7d8be5e919" title="Render a form submit button.">submitButton</a>(<a class="code" href="class_c_m_data_model.html#ab2fc40d43824ea3e1ce5d86dee0d763b" title="The data model name.">$name</a> = <span class="stringliteral">&#39;submit&#39;</span>, $a = <span class="keyword">false</span>) {
<a name="l00804"></a>00804   list($a[<span class="stringliteral">&#39;name&#39;</span>], $a[<span class="stringliteral">&#39;value&#39;</span>]) = $this-&gt;<a class="code" href="class_c_m_data_model.html#a71960d5bc22f30db33c43e2f4f3e72b5" title="Extract the bare name and real value from a variable.">extractNameValue</a>(<a class="code" href="class_c_m_data_model.html#ab2fc40d43824ea3e1ce5d86dee0d763b" title="The data model name.">$name</a>, $a);
<a name="l00805"></a>00805   <span class="keywordflow">return</span> <a class="code" href="class_c_m_form.html#a5541dbf0e2b8b8725ec9a46cbc8feb60" title="Create a submit button.">CMForm::SubmitButton</a>($a);
<a name="l00806"></a>00806  }
<a name="l00807"></a>00807  
<a name="l00821"></a><a class="code" href="class_c_m_data_model.html#a7f22eb27c02ec2cc509b2c3b77f61bb0">00821</a>  <span class="keyword">public</span> function <a class="code" href="class_c_m_data_model.html#a7f22eb27c02ec2cc509b2c3b77f61bb0" title="Render a form reset button.">resetButton</a>(<a class="code" href="class_c_m_data_model.html#ab2fc40d43824ea3e1ce5d86dee0d763b" title="The data model name.">$name</a> = <span class="stringliteral">&#39;reset&#39;</span>, $a = <span class="keyword">false</span>) {
<a name="l00822"></a>00822   list($a[<span class="stringliteral">&#39;name&#39;</span>], $a[<span class="stringliteral">&#39;value&#39;</span>]) = $this-&gt;<a class="code" href="class_c_m_data_model.html#a71960d5bc22f30db33c43e2f4f3e72b5" title="Extract the bare name and real value from a variable.">extractNameValue</a>(<a class="code" href="class_c_m_data_model.html#ab2fc40d43824ea3e1ce5d86dee0d763b" title="The data model name.">$name</a>, $a);
<a name="l00823"></a>00823   <span class="keywordflow">return</span> <a class="code" href="class_c_m_form.html#ac7d9025d6f1d5980b4e2261be6ee2ba4" title="Create a form reset button.">CMForm::ResetButton</a>($a);
<a name="l00824"></a>00824  }
<a name="l00825"></a>00825  
<a name="l00839"></a><a class="code" href="class_c_m_data_model.html#a479b9169acd8adc146a1d546a0089240">00839</a>  <span class="keyword">public</span> function <a class="code" href="class_c_m_data_model.html#a479b9169acd8adc146a1d546a0089240" title="Render a non-submit form button.">button</a>(<a class="code" href="class_c_m_data_model.html#ab2fc40d43824ea3e1ce5d86dee0d763b" title="The data model name.">$name</a> = <span class="stringliteral">&#39;button&#39;</span>, $a = <span class="keyword">false</span>) {
<a name="l00840"></a>00840   list($a[<span class="stringliteral">&#39;name&#39;</span>], $a[<span class="stringliteral">&#39;value&#39;</span>]) = $this-&gt;<a class="code" href="class_c_m_data_model.html#a71960d5bc22f30db33c43e2f4f3e72b5" title="Extract the bare name and real value from a variable.">extractNameValue</a>(<a class="code" href="class_c_m_data_model.html#ab2fc40d43824ea3e1ce5d86dee0d763b" title="The data model name.">$name</a>, $a);
<a name="l00841"></a>00841   <span class="keywordflow">return</span> <a class="code" href="class_c_m_form.html#a2fd0a11ea628e68b103b1cef8d0ea99a" title="Create a non-submitting button.">CMForm::Button</a>($a);
<a name="l00842"></a>00842  }
<a name="l00843"></a>00843  
<a name="l00857"></a><a class="code" href="class_c_m_data_model.html#ae068b26ae00a7beb63d335f236cd36fb">00857</a>  <span class="keyword">public</span> function <a class="code" href="class_c_m_data_model.html#ae068b26ae00a7beb63d335f236cd36fb" title="Render a hidden field.">hidden</a>(<a class="code" href="class_c_m_data_model.html#ab2fc40d43824ea3e1ce5d86dee0d763b" title="The data model name.">$name</a> = <span class="stringliteral">&#39;hidden&#39;</span>, $a = <span class="keyword">false</span>) {
<a name="l00858"></a>00858   list($a[<span class="stringliteral">&#39;name&#39;</span>], $a[<span class="stringliteral">&#39;value&#39;</span>]) = $this-&gt;<a class="code" href="class_c_m_data_model.html#a71960d5bc22f30db33c43e2f4f3e72b5" title="Extract the bare name and real value from a variable.">extractNameValue</a>(<a class="code" href="class_c_m_data_model.html#ab2fc40d43824ea3e1ce5d86dee0d763b" title="The data model name.">$name</a>, $a);
<a name="l00859"></a>00859   <span class="keywordflow">return</span> <a class="code" href="class_c_m_form.html#aacf8b065b9ea18fc98a977be6eb85e13" title="Create a hidden field.">CMForm::Hidden</a>($a);
<a name="l00860"></a>00860  }
<a name="l00861"></a>00861  
<a name="l00878"></a><a class="code" href="class_c_m_data_model.html#ab74d7aa82ab0087c09ac00082cf2ab94">00878</a>  <span class="keyword">public</span> function <a class="code" href="class_c_m_data_model.html#ab74d7aa82ab0087c09ac00082cf2ab94" title="Render a drop down menu.">menu</a>(<a class="code" href="class_c_m_data_model.html#ab2fc40d43824ea3e1ce5d86dee0d763b" title="The data model name.">$name</a> = <span class="stringliteral">&#39;menu&#39;</span>, $a = <span class="keyword">false</span>) {
<a name="l00879"></a>00879   list($a[<span class="stringliteral">&#39;name&#39;</span>], $a[<span class="stringliteral">&#39;value&#39;</span>]) = $this-&gt;<a class="code" href="class_c_m_data_model.html#a71960d5bc22f30db33c43e2f4f3e72b5" title="Extract the bare name and real value from a variable.">extractNameValue</a>(<a class="code" href="class_c_m_data_model.html#ab2fc40d43824ea3e1ce5d86dee0d763b" title="The data model name.">$name</a>, $a);
<a name="l00880"></a>00880   <span class="keywordflow">return</span> <a class="code" href="class_c_m_form.html#a15f48d56db687516bbbf67e201034e70" title="Create a popup menu.">CMForm::Menu</a>($a);
<a name="l00881"></a>00881  }
<a name="l00882"></a>00882  
<a name="l00896"></a><a class="code" href="class_c_m_data_model.html#a3bac1bce88767020c0b5684cb18618d5">00896</a>  <span class="keyword">public</span> function <a class="code" href="class_c_m_data_model.html#a3bac1bce88767020c0b5684cb18618d5" title="Render a checkbox.">checkbox</a>(<a class="code" href="class_c_m_data_model.html#ab2fc40d43824ea3e1ce5d86dee0d763b" title="The data model name.">$name</a> = <span class="stringliteral">&#39;checkbox&#39;</span>, $a = <span class="keyword">false</span>) {
<a name="l00897"></a>00897   list($a[<span class="stringliteral">&#39;name&#39;</span>], $a[<span class="stringliteral">&#39;value&#39;</span>]) = $this-&gt;<a class="code" href="class_c_m_data_model.html#a71960d5bc22f30db33c43e2f4f3e72b5" title="Extract the bare name and real value from a variable.">extractNameValue</a>(<a class="code" href="class_c_m_data_model.html#ab2fc40d43824ea3e1ce5d86dee0d763b" title="The data model name.">$name</a>, $a);
<a name="l00898"></a>00898   $a[<span class="stringliteral">&#39;checked&#39;</span>] = $this-&gt;<a class="code" href="class_c_m_data_model.html#a94cbe4a871c1c28abe39a9551beb849e" title="Determine the boolean value based on falseValues and trueValues.">determineChecked</a>($a[<span class="stringliteral">&#39;value&#39;</span>]);
<a name="l00899"></a>00899   <span class="keywordflow">return</span> <a class="code" href="class_c_m_form.html#a117240abe236a0c688f484289fa677d4" title="Create a checkbox.">CMForm::Checkbox</a>($a);
<a name="l00900"></a>00900  }
<a name="l00901"></a>00901  
<a name="l00918"></a><a class="code" href="class_c_m_data_model.html#a4c5aa812881add9048c975d4df4ccdbc">00918</a>  <span class="keyword">public</span> function <a class="code" href="class_c_m_data_model.html#a4c5aa812881add9048c975d4df4ccdbc" title="Render a list.">listBox</a>(<a class="code" href="class_c_m_data_model.html#ab2fc40d43824ea3e1ce5d86dee0d763b" title="The data model name.">$name</a> = <span class="stringliteral">&#39;listbox&#39;</span>, $a = <span class="keyword">false</span>) {
<a name="l00919"></a>00919   list($a[<span class="stringliteral">&#39;name&#39;</span>], $a[<span class="stringliteral">&#39;value&#39;</span>]) = $this-&gt;<a class="code" href="class_c_m_data_model.html#a71960d5bc22f30db33c43e2f4f3e72b5" title="Extract the bare name and real value from a variable.">extractNameValue</a>(<a class="code" href="class_c_m_data_model.html#ab2fc40d43824ea3e1ce5d86dee0d763b" title="The data model name.">$name</a>, $a);
<a name="l00920"></a>00920   <span class="keywordflow">return</span> <a class="code" href="class_c_m_form.html#a4bc73067e9cc052d2888596fe868868b" title="Create a list box.">CMForm::ListBox</a>($a);
<a name="l00921"></a>00921  }
<a name="l00922"></a>00922  
<a name="l00939"></a><a class="code" href="class_c_m_data_model.html#ad36c0867ed39a18b452bae2416529b1c">00939</a>  <span class="keyword">public</span> function <a class="code" href="class_c_m_data_model.html#ad36c0867ed39a18b452bae2416529b1c" title="Render a group of radio buttons.">radioGroup</a>(<a class="code" href="class_c_m_data_model.html#ab2fc40d43824ea3e1ce5d86dee0d763b" title="The data model name.">$name</a> = <span class="stringliteral">&#39;radiogroup&#39;</span>, $a = <span class="keyword">false</span>) {
<a name="l00940"></a>00940   list($a[<span class="stringliteral">&#39;name&#39;</span>], $a[<span class="stringliteral">&#39;value&#39;</span>]) = $this-&gt;<a class="code" href="class_c_m_data_model.html#a71960d5bc22f30db33c43e2f4f3e72b5" title="Extract the bare name and real value from a variable.">extractNameValue</a>(<a class="code" href="class_c_m_data_model.html#ab2fc40d43824ea3e1ce5d86dee0d763b" title="The data model name.">$name</a>, $a);
<a name="l00941"></a>00941   <span class="keywordflow">return</span> <a class="code" href="class_c_m_form.html#a59a84e7f3e9db3ffada7c36e8111a0ae" title="Create a radio button set.">CMForm::RadioGroup</a>($a);
<a name="l00942"></a>00942  }
<a name="l00943"></a>00943  
<a name="l00960"></a><a class="code" href="class_c_m_data_model.html#a2438648eea8319bd64f1d11975f215bd">00960</a>  <span class="keyword">public</span> function <a class="code" href="class_c_m_data_model.html#a2438648eea8319bd64f1d11975f215bd" title="Render a group of checkboxes.">checkboxGroup</a>(<a class="code" href="class_c_m_data_model.html#ab2fc40d43824ea3e1ce5d86dee0d763b" title="The data model name.">$name</a> = <span class="stringliteral">&#39;checkboxgroup&#39;</span>, $a = <span class="keyword">false</span>) {
<a name="l00961"></a>00961   list($a[<span class="stringliteral">&#39;name&#39;</span>], $a[<span class="stringliteral">&#39;value&#39;</span>]) = $this-&gt;<a class="code" href="class_c_m_data_model.html#a71960d5bc22f30db33c43e2f4f3e72b5" title="Extract the bare name and real value from a variable.">extractNameValue</a>(<a class="code" href="class_c_m_data_model.html#ab2fc40d43824ea3e1ce5d86dee0d763b" title="The data model name.">$name</a>, $a);
<a name="l00962"></a>00962   <span class="keywordflow">return</span> <a class="code" href="class_c_m_form.html#ab76da49fb3531d1e087abdfbfaf5465b" title="Create a checkbox set.">CMForm::CheckboxGroup</a>($a);
<a name="l00963"></a>00963  }
<a name="l00964"></a>00964  
<a name="l00978"></a><a class="code" href="class_c_m_data_model.html#add8e63e1af2b419457ce5942967f4886">00978</a>  <span class="keyword">public</span> function <a class="code" href="class_c_m_data_model.html#add8e63e1af2b419457ce5942967f4886" title="Render a text area.">textArea</a>(<a class="code" href="class_c_m_data_model.html#ab2fc40d43824ea3e1ce5d86dee0d763b" title="The data model name.">$name</a> = <span class="stringliteral">&#39;textarea&#39;</span>, $a = <span class="keyword">false</span>) {
<a name="l00979"></a>00979   list($a[<span class="stringliteral">&#39;name&#39;</span>], $a[<span class="stringliteral">&#39;value&#39;</span>]) = $this-&gt;<a class="code" href="class_c_m_data_model.html#a71960d5bc22f30db33c43e2f4f3e72b5" title="Extract the bare name and real value from a variable.">extractNameValue</a>(<a class="code" href="class_c_m_data_model.html#ab2fc40d43824ea3e1ce5d86dee0d763b" title="The data model name.">$name</a>, $a);
<a name="l00980"></a>00980   <span class="keywordflow">return</span> <a class="code" href="class_c_m_form.html#a86d2d20ed424da849ed44b1636ebe51e" title="Create a text area.">CMForm::TextArea</a>($a);
<a name="l00981"></a>00981  }
<a name="l00982"></a>00982  
<a name="l00989"></a><a class="code" href="class_c_m_data_model.html#a4eb23ebf75009f6966eaf62423de3ee5">00989</a>  <span class="keyword">public</span> function <a class="code" href="class_c_m_data_model.html#a4eb23ebf75009f6966eaf62423de3ee5" title="Get an array of the invalid fields.">getInvalidFields</a>() {
<a name="l00990"></a>00990   <span class="keywordflow">return</span> $this-&gt;vh-&gt;getInvalidFields();
<a name="l00991"></a>00991  }
<a name="l00992"></a>00992  
<a name="l00999"></a><a class="code" href="class_c_m_data_model.html#a899afabad5d03c34598f85efd27bbe30">00999</a>  <span class="keyword">public</span> function <a class="code" href="class_c_m_data_model.html#a899afabad5d03c34598f85efd27bbe30" title="A human-readable explanation of why the validation failed.">fieldError</a>(<a class="code" href="class_c_m_data_model.html#ab2fc40d43824ea3e1ce5d86dee0d763b" title="The data model name.">$name</a>) {
<a name="l01000"></a>01000   <span class="keywordflow">if</span>(is_array($this-&gt;vh-&gt;invalidFields[<a class="code" href="class_c_m_data_model.html#ab2fc40d43824ea3e1ce5d86dee0d763b" title="The data model name.">$name</a>]))
<a name="l01001"></a>01001    <span class="keywordflow">return</span> implode(<span class="stringliteral">&#39;, &#39;</span>, $this-&gt;vh-&gt;invalidFields[<a class="code" href="class_c_m_data_model.html#ab2fc40d43824ea3e1ce5d86dee0d763b" title="The data model name.">$name</a>]);
<a name="l01002"></a>01002   <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l01003"></a>01003  }
<a name="l01004"></a>01004  
<a name="l01015"></a><a class="code" href="class_c_m_data_model.html#a094a115bc3f56c1fc041314247eb5aac">01015</a>  <span class="keyword">public</span> function <a class="code" href="class_c_m_data_model.html#a094a115bc3f56c1fc041314247eb5aac" title="Replace a pool with an array.">setPool</a>(array $values, <a class="code" href="class_c_m_data_model.html#ab2fc40d43824ea3e1ce5d86dee0d763b" title="The data model name.">$name</a> = <span class="stringliteral">&#39;default&#39;</span>) {
<a name="l01016"></a>01016   $this-&gt;pool[<a class="code" href="class_c_m_data_model.html#ab2fc40d43824ea3e1ce5d86dee0d763b" title="The data model name.">$name</a>] = $values;
<a name="l01017"></a>01017   <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l01018"></a>01018  }
<a name="l01019"></a>01019  
<a name="l01028"></a><a class="code" href="class_c_m_data_model.html#a0e2c075b9ec47f8c999b904c2a26b15a">01028</a>  <span class="keyword">public</span> function <a class="code" href="class_c_m_data_model.html#a0e2c075b9ec47f8c999b904c2a26b15a" title="Set multiple pools.">setPools</a>(array $pools) {
<a name="l01029"></a>01029   <span class="keywordflow">foreach</span>($pools as $k =&gt; $v)
<a name="l01030"></a>01030    $this-&gt;<a class="code" href="class_c_m_data_model.html#a094a115bc3f56c1fc041314247eb5aac" title="Replace a pool with an array.">setPool</a>($k, $v);
<a name="l01031"></a>01031   <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l01032"></a>01032  }
<a name="l01033"></a>01033  
<a name="l01059"></a><a class="code" href="class_c_m_data_model.html#a7de9a67b4f5a283dd4c03b4fe08792e3">01059</a>  <span class="keyword">public</span> function <a class="code" href="class_c_m_data_model.html#a7de9a67b4f5a283dd4c03b4fe08792e3" title="Check if a table contains one or more records where all the values in a pool match...">recordExists</a>(<a class="code" href="class_c_m_data_model.html#a0e235d3f271fa9c26b947e1e14158d60" title="Storage pools.">$pool</a>, $tableName = <span class="keyword">false</span>, $extra = array()) {
<a name="l01060"></a>01060   <span class="comment">// we need a table name</span>
<a name="l01061"></a>01061   <span class="keywordflow">if</span>($tableName === <span class="keyword">false</span>)
<a name="l01062"></a>01062    $tableName = <a class="code" href="class_c_m_data_model.html#a0e235d3f271fa9c26b947e1e14158d60" title="Storage pools.">$pool</a>;
<a name="l01063"></a>01063    
<a name="l01064"></a>01064   <span class="comment">// the pool must exist</span>
<a name="l01065"></a>01065   <span class="keywordflow">if</span>(!$this-&gt;<a class="code" href="class_c_m_data_model.html#abfaed3adbf6f1db8dca30cb6047fc27e" title="Check if a pool exists.">poolExists</a>(<a class="code" href="class_c_m_data_model.html#a0e235d3f271fa9c26b947e1e14158d60" title="Storage pools.">$pool</a>))
<a name="l01066"></a>01066    <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01067"></a>01067    
<a name="l01068"></a>01068   <span class="comment">// we must have a database</span>
<a name="l01069"></a>01069   <span class="keywordflow">if</span>($this-&gt;dbh === <span class="keyword">false</span>)
<a name="l01070"></a>01070    <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01071"></a>01071   
<a name="l01072"></a>01072   <span class="comment">// create SQL</span>
<a name="l01073"></a>01073   $sql = <span class="stringliteral">&quot;SELECT COUNT(1) FROM $tableName WHERE &quot;</span>;
<a name="l01074"></a>01074   $first = <span class="keyword">true</span>;
<a name="l01075"></a>01075   <span class="keywordflow">foreach</span>($this-&gt;pool[<a class="code" href="class_c_m_data_model.html#a0e235d3f271fa9c26b947e1e14158d60" title="Storage pools.">$pool</a>] as $k =&gt; $v) {
<a name="l01076"></a>01076    <span class="keywordflow">if</span>(!$first)
<a name="l01077"></a>01077     $sql .= <span class="stringliteral">&quot; AND &quot;</span>;
<a name="l01078"></a>01078    <span class="keywordflow">else</span>
<a name="l01079"></a>01079     $first = <span class="keyword">false</span>;
<a name="l01080"></a>01080    
<a name="l01081"></a>01081    $sql .= $this-&gt;dbh-&gt;escapeEntity($k) . <span class="stringliteral">&quot;=&#39;$v&#39;&quot;</span>;
<a name="l01082"></a>01082   }
<a name="l01083"></a>01083   <span class="keywordflow">foreach</span>($extra as $k =&gt; $v) {
<a name="l01084"></a>01084    <span class="keywordflow">if</span>(!$first)
<a name="l01085"></a>01085     $sql .= <span class="stringliteral">&quot; AND &quot;</span>;
<a name="l01086"></a>01086    <span class="keywordflow">else</span>
<a name="l01087"></a>01087     $first = <span class="keyword">false</span>;
<a name="l01088"></a>01088    
<a name="l01089"></a>01089    $sql .= $this-&gt;dbh-&gt;escapeEntity($k) . <span class="stringliteral">&quot;=&#39;$v&#39;&quot;</span>;
<a name="l01090"></a>01090   }
<a name="l01091"></a>01091   
<a name="l01092"></a>01092   <span class="comment">// perform lookup</span>
<a name="l01093"></a>01093   <span class="keywordflow">return</span> $this-&gt;dbh-&gt;query($sql)-&gt;fetch(<span class="stringliteral">&#39;cell&#39;</span>) &gt; 0;
<a name="l01094"></a>01094  }
<a name="l01095"></a>01095  
<a name="l01102"></a><a class="code" href="class_c_m_data_model.html#a94cbe4a871c1c28abe39a9551beb849e">01102</a>  <span class="keyword">private</span> function <a class="code" href="class_c_m_data_model.html#a94cbe4a871c1c28abe39a9551beb849e" title="Determine the boolean value based on falseValues and trueValues.">determineChecked</a>($value) {
<a name="l01103"></a>01103   <span class="comment">// first check the falseValues</span>
<a name="l01104"></a>01104   <span class="keywordflow">foreach</span>($this-&gt;falseValues as $v) {
<a name="l01105"></a>01105    <span class="keywordflow">if</span>($value == $v)
<a name="l01106"></a>01106     <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01107"></a>01107   }
<a name="l01108"></a>01108  
<a name="l01109"></a>01109   <span class="comment">// first check the trueValues</span>
<a name="l01110"></a>01110   <span class="keywordflow">foreach</span>($this-&gt;trueValues as $v) {
<a name="l01111"></a>01111    <span class="keywordflow">if</span>($value == $v)
<a name="l01112"></a>01112     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l01113"></a>01113   }
<a name="l01114"></a>01114   
<a name="l01115"></a>01115   <span class="comment">// if its neither then use PHP rules to cast</span>
<a name="l01116"></a>01116   <span class="keywordflow">return</span> (<span class="keywordtype">boolean</span>) $value;
<a name="l01117"></a>01117  }
<a name="l01118"></a>01118  
<a name="l01122"></a><a class="code" href="class_c_m_data_model.html#a7516ca30af0db3cdbf9a7739b48ce91d">01122</a>  <span class="keyword">public</span> function <a class="code" href="class_c_m_data_model.html#a7516ca30af0db3cdbf9a7739b48ce91d" title="Return the string value of this object.">__toString</a>() {
<a name="l01123"></a>01123   <span class="keywordflow">return</span> <span class="stringliteral">&quot;&lt;&quot;</span> . get_class($this) . <span class="stringliteral">&quot;&gt;&quot;</span>;
<a name="l01124"></a>01124  }
<a name="l01125"></a>01125  
<a name="l01130"></a><a class="code" href="class_c_m_data_model.html#a7017938bc363ce5b5b2087e685f3ce5d">01130</a>  <span class="keyword">public</span> function <a class="code" href="class_c_m_data_model.html#a7017938bc363ce5b5b2087e685f3ce5d" title="Get all pools.">getPools</a>() {
<a name="l01131"></a>01131   <span class="keywordflow">return</span> $this-&gt;pool;
<a name="l01132"></a>01132  }
<a name="l01133"></a>01133  
<a name="l01146"></a><a class="code" href="class_c_m_data_model.html#ad07ac3a44670787b9f1e80303c410105">01146</a>  <span class="keyword">public</span> function <a class="code" href="class_c_m_data_model.html#ad07ac3a44670787b9f1e80303c410105" title="Set a variable if it doesn&amp;#39;t exist.">setDefault</a>(<a class="code" href="class_c_m_data_model.html#ab2fc40d43824ea3e1ce5d86dee0d763b" title="The data model name.">$name</a>, $value = <span class="keyword">false</span>, <a class="code" href="class_c_m_data_model.html#a0e235d3f271fa9c26b947e1e14158d60" title="Storage pools.">$pool</a> = <span class="stringliteral">&#39;public&#39;</span>) {
<a name="l01147"></a>01147   <span class="comment">// if the pool doesn&#39;t exist we are allowed to create it</span>
<a name="l01148"></a>01148   <span class="keywordflow">if</span>(!$this-&gt;<a class="code" href="class_c_m_data_model.html#abfaed3adbf6f1db8dca30cb6047fc27e" title="Check if a pool exists.">poolExists</a>(<a class="code" href="class_c_m_data_model.html#a0e235d3f271fa9c26b947e1e14158d60" title="Storage pools.">$pool</a>))
<a name="l01149"></a>01149    $this-&gt;<a class="code" href="class_c_m_data_model.html#ae558e743817dcb7f76ac6827045bdc28" title="Add a new pool.">addPool</a>(<a class="code" href="class_c_m_data_model.html#a0e235d3f271fa9c26b947e1e14158d60" title="Storage pools.">$pool</a>);
<a name="l01150"></a>01150   
<a name="l01151"></a>01151   <span class="keywordflow">if</span>(!$this-&gt;<a class="code" href="class_c_m_data_model.html#ac27d633cdc18300238fcaa81aecf0eac" title="Check if a variable exists in a pool.">exists</a>(<a class="code" href="class_c_m_data_model.html#ab2fc40d43824ea3e1ce5d86dee0d763b" title="The data model name.">$name</a>, <a class="code" href="class_c_m_data_model.html#a0e235d3f271fa9c26b947e1e14158d60" title="Storage pools.">$pool</a>))
<a name="l01152"></a>01152    $this-&gt;<span class="keyword">set</span>(<a class="code" href="class_c_m_data_model.html#ab2fc40d43824ea3e1ce5d86dee0d763b" title="The data model name.">$name</a>, $value, <a class="code" href="class_c_m_data_model.html#a0e235d3f271fa9c26b947e1e14158d60" title="Storage pools.">$pool</a>);
<a name="l01153"></a>01153   
<a name="l01154"></a>01154   <span class="keywordflow">return</span> $this-&gt;<span class="keyword">get</span>(<a class="code" href="class_c_m_data_model.html#ab2fc40d43824ea3e1ce5d86dee0d763b" title="The data model name.">$name</a>, <a class="code" href="class_c_m_data_model.html#a0e235d3f271fa9c26b947e1e14158d60" title="Storage pools.">$pool</a>);
<a name="l01155"></a>01155  }
<a name="l01156"></a>01156  
<a name="l01157"></a>01157 }
<a name="l01158"></a>01158 
<a name="l01159"></a>01159 <span class="comment">// make sure the session is started</span>
<a name="l01160"></a>01160 <span class="comment">// WARNING: this line must be after the class definition</span>
<a name="l01161"></a>01161 session_start();
<a name="l01162"></a>01162 
<a name="l01163"></a>01163 ?&gt;
</pre></div></div>
<hr class="footer"/><address style="text-align: right;"><small>Generated by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.3 </small></address>
</body>
</html>
