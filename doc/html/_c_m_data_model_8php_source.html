<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>CMLIB: CMDataModel.php Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.6.3 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
    </ul>
  </div>
<h1>CMDataModel.php</h1><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 &lt;?php
<a name="l00002"></a>00002 
<a name="l00003"></a>00003 include_once(<span class="stringliteral">&#39;CMClass.php&#39;</span>);
<a name="l00004"></a>00004 include_once(<span class="stringliteral">&#39;CMForm.php&#39;</span>);
<a name="l00005"></a>00005 include_once(<span class="stringliteral">&#39;CMValidator.php&#39;</span>);
<a name="l00006"></a>00006 include_once(<span class="stringliteral">&#39;CMError.php&#39;</span>);
<a name="l00007"></a>00007 include_once(<span class="stringliteral">&#39;CMHeader.php&#39;</span>);
<a name="l00008"></a>00008 
<a name="l00009"></a>00009 <span class="comment">// we need to load these otherwise the session variables can&#39;t deal with the database objects</span>
<a name="l00010"></a>00010 include_once(<span class="stringliteral">&#39;CMMySQL.php&#39;</span>);
<a name="l00011"></a>00011 include_once(<span class="stringliteral">&#39;CMOracle.php&#39;</span>);
<a name="l00012"></a>00012 include_once(<span class="stringliteral">&#39;CMPostgreSQL.php&#39;</span>);
<a name="l00013"></a>00013 
<a name="l00024"></a><a class="code" href="class_c_m_data_model.html">00024</a> <span class="keyword">class </span><a class="code" href="class_c_m_data_model.html" title="Data model provides above-session data modeling.">CMDataModel</a> <span class="keyword">extends</span> <a class="code" href="class_c_m_error.html" title="Error handling as a stand-alone or for classes vis inheritance.">CMError</a> implements <a class="code" href="interface_c_m_class.html" title="CM class interface.">CMClass</a> {
<a name="l00025"></a>00025  
<a name="l00031"></a><a class="code" href="class_c_m_data_model.html#a9e2d53558e7b299d52b25c13d310d7e0">00031</a>  <span class="keyword">public</span> <span class="keyword">static</span> function <a class="code" href="class_c_m_data_model.html#a9e2d53558e7b299d52b25c13d310d7e0" title="The version of this class.">Version</a>() {
<a name="l00032"></a>00032   <span class="keywordflow">return</span> <span class="stringliteral">&quot;1.0&quot;</span>;
<a name="l00033"></a>00033  }
<a name="l00034"></a>00034  
<a name="l00040"></a><a class="code" href="class_c_m_data_model.html#ab51e04ce58ff27601a503f46d611b7e6">00040</a>  <span class="keyword">public</span> <span class="keyword">static</span> function <a class="code" href="class_c_m_data_model.html#ab51e04ce58ff27601a503f46d611b7e6" title="The version this class was introduced to the library.">Since</a>() {
<a name="l00041"></a>00041   <span class="keywordflow">return</span> <span class="stringliteral">&quot;1.0&quot;</span>;
<a name="l00042"></a>00042  }
<a name="l00043"></a>00043  
<a name="l00051"></a><a class="code" href="class_c_m_data_model.html#acc1e62674bb7200ea73767c19dc1344d">00051</a>  <span class="keyword">private</span> <a class="code" href="class_c_m_data_model.html#acc1e62674bb7200ea73767c19dc1344d" title="Database handle.">$dbh</a> = <span class="keyword">false</span>;
<a name="l00052"></a>00052  
<a name="l00060"></a><a class="code" href="class_c_m_data_model.html#a3d7d5a057f46532483faf54f490f7587">00060</a>  <span class="keyword">private</span> <a class="code" href="class_c_m_data_model.html#a3d7d5a057f46532483faf54f490f7587" title="CMValidator handle.">$vh</a> = <span class="keyword">false</span>;
<a name="l00061"></a>00061  
<a name="l00074"></a><a class="code" href="class_c_m_data_model.html#a0e235d3f271fa9c26b947e1e14158d60">00074</a>  <span class="keyword">private</span> <a class="code" href="class_c_m_data_model.html#a0e235d3f271fa9c26b947e1e14158d60" title="Storage pools.">$pool</a> = array();
<a name="l00075"></a>00075  
<a name="l00079"></a><a class="code" href="class_c_m_data_model.html#a48b5b0ee04d350a950f19d0167e298e5">00079</a>  <span class="keyword">public</span> <a class="code" href="class_c_m_data_model.html#a48b5b0ee04d350a950f19d0167e298e5" title="Values that will always be determined to be false (unchecked) with checkboxes.">$falseValues</a> = array();
<a name="l00080"></a>00080  
<a name="l00084"></a><a class="code" href="class_c_m_data_model.html#a6208b0249325c3aebd3d458a4045ea27">00084</a>  <span class="keyword">public</span> <a class="code" href="class_c_m_data_model.html#a6208b0249325c3aebd3d458a4045ea27" title="Values that will always be determined to be true (checked) with checkboxes.">$trueValues</a> = array();
<a name="l00085"></a>00085  
<a name="l00092"></a><a class="code" href="class_c_m_data_model.html#af7b6b0a1e84c7b824dacabe1fb1046c9">00092</a>  <span class="keyword">private</span> <span class="keyword">static</span> <a class="code" href="class_c_m_data_model.html#af7b6b0a1e84c7b824dacabe1fb1046c9" title="The global pool.">$GlobalPool</a> = array();
<a name="l00093"></a>00093  
<a name="l00097"></a><a class="code" href="class_c_m_data_model.html#ab2fc40d43824ea3e1ce5d86dee0d763b">00097</a>  <span class="keyword">private</span> <a class="code" href="class_c_m_data_model.html#ab2fc40d43824ea3e1ce5d86dee0d763b" title="The data model name.">$name</a> = <span class="stringliteral">&#39;default&#39;</span>;
<a name="l00098"></a>00098  
<a name="l00103"></a><a class="code" href="class_c_m_data_model.html#a643b6c1895fa14f4f0823c39ca043df1">00103</a>  <span class="keyword">public</span> <a class="code" href="class_c_m_data_model.html#a643b6c1895fa14f4f0823c39ca043df1" title="Keeps track of the URL history.">$history</a> = array();
<a name="l00104"></a>00104  
<a name="l00113"></a><a class="code" href="class_c_m_data_model.html#a24f2101b0f1705098ad7417306188585">00113</a>  <span class="keyword">public</span> function <a class="code" href="class_c_m_data_model.html#a24f2101b0f1705098ad7417306188585" title="Create or restore a data model.">CMDataModel</a>(<a class="code" href="class_c_m_data_model.html#ab2fc40d43824ea3e1ce5d86dee0d763b" title="The data model name.">$name</a> = <span class="stringliteral">&#39;default&#39;</span>) {
<a name="l00114"></a>00114   $this-&gt;name = <a class="code" href="class_c_m_data_model.html#ab2fc40d43824ea3e1ce5d86dee0d763b" title="The data model name.">$name</a>;
<a name="l00115"></a>00115   
<a name="l00116"></a>00116   <span class="comment">// setup default pools</span>
<a name="l00117"></a>00117   $this-&gt;<a class="code" href="class_c_m_data_model.html#ae558e743817dcb7f76ac6827045bdc28" title="Add a new pool.">addPool</a>(<span class="stringliteral">&#39;get&#39;</span>);
<a name="l00118"></a>00118   $this-&gt;<a class="code" href="class_c_m_data_model.html#ae558e743817dcb7f76ac6827045bdc28" title="Add a new pool.">addPool</a>(<span class="stringliteral">&#39;post&#39;</span>);
<a name="l00119"></a>00119   $this-&gt;<a class="code" href="class_c_m_data_model.html#ae558e743817dcb7f76ac6827045bdc28" title="Add a new pool.">addPool</a>(<span class="stringliteral">&#39;public&#39;</span>);
<a name="l00120"></a>00120  }
<a name="l00121"></a>00121  
<a name="l00128"></a><a class="code" href="class_c_m_data_model.html#afec8c3e49651ee1379432dbd22ec0fc9">00128</a>  <span class="keyword">public</span> <span class="keyword">static</span> function <a class="code" href="class_c_m_data_model.html#afec8c3e49651ee1379432dbd22ec0fc9" title="Check if a data model exists.">DataModelExists</a>(<a class="code" href="class_c_m_data_model.html#ab2fc40d43824ea3e1ce5d86dee0d763b" title="The data model name.">$name</a> = <span class="stringliteral">&#39;default&#39;</span>) {
<a name="l00129"></a>00129   <span class="keywordflow">return</span> isset($_SESSION[<span class="stringliteral">&quot;datamodel_$name&quot;</span>]);
<a name="l00130"></a>00130  }
<a name="l00131"></a>00131  
<a name="l00140"></a><a class="code" href="class_c_m_data_model.html#a8dd8e36efd073d98f8b297df8958053a">00140</a>  <span class="keyword">public</span> <span class="keyword">static</span> function <a class="code" href="class_c_m_data_model.html#a8dd8e36efd073d98f8b297df8958053a" title="Get a data model by name.">GetDataModel</a>(<a class="code" href="class_c_m_data_model.html#ab2fc40d43824ea3e1ce5d86dee0d763b" title="The data model name.">$name</a> = <span class="stringliteral">&#39;default&#39;</span>) {
<a name="l00141"></a>00141   <span class="comment">// create it if needed</span>
<a name="l00142"></a>00142   <span class="keywordflow">if</span>(!isset($_SESSION[<span class="stringliteral">&quot;datamodel_$name&quot;</span>]))
<a name="l00143"></a>00143    $_SESSION[<span class="stringliteral">&quot;datamodel_$name&quot;</span>] = <span class="keyword">new</span> <a class="code" href="class_c_m_data_model.html#a24f2101b0f1705098ad7417306188585" title="Create or restore a data model.">CMDataModel</a>(<a class="code" href="class_c_m_data_model.html#ab2fc40d43824ea3e1ce5d86dee0d763b" title="The data model name.">$name</a>);
<a name="l00144"></a>00144   $dm = $_SESSION[<span class="stringliteral">&quot;datamodel_$name&quot;</span>];
<a name="l00145"></a>00145    
<a name="l00146"></a>00146   <span class="comment">// load the $_GET and $_POST</span>
<a name="l00147"></a>00147   $dm-&gt;drainPool(array(<span class="stringliteral">&#39;get&#39;</span>, <span class="stringliteral">&#39;post&#39;</span>));
<a name="l00148"></a>00148   $dm-&gt;fillPool(<a class="code" href="class_c_m_form.html#a45099772beda49af1a9a9c2c2ec6032e" title="Internal function for recursing an array to remove slashes.">CMForm::StripSlashesRecursive</a>($_GET), <span class="stringliteral">&#39;get&#39;</span>);
<a name="l00149"></a>00149   $dm-&gt;fillPool(<a class="code" href="class_c_m_form.html#a45099772beda49af1a9a9c2c2ec6032e" title="Internal function for recursing an array to remove slashes.">CMForm::StripSlashesRecursive</a>($_POST), <span class="stringliteral">&#39;post&#39;</span>);
<a name="l00150"></a>00150   
<a name="l00151"></a>00151   <span class="comment">// fill custom pools</span>
<a name="l00152"></a>00152   <span class="keywordflow">foreach</span>($_POST as $k =&gt; $v) {
<a name="l00153"></a>00153    <span class="keywordflow">if</span>(is_array($v)) {
<a name="l00154"></a>00154     <span class="comment">// create the pool if needed</span>
<a name="l00155"></a>00155     <span class="keywordflow">if</span>(!$dm-&gt;poolExists($k))
<a name="l00156"></a>00156      $dm-&gt;addPool($k);
<a name="l00157"></a>00157     $dm-&gt;fillPool($v, $k);
<a name="l00158"></a>00158    }
<a name="l00159"></a>00159   }
<a name="l00160"></a>00160   
<a name="l00161"></a>00161   <span class="comment">// append history information</span>
<a name="l00162"></a>00162   array_push($dm-&gt;history, array(
<a name="l00163"></a>00163    <span class="stringliteral">&#39;url&#39;</span> =&gt; $_SERVER[<span class="stringliteral">&#39;PHP_SELF&#39;</span>],
<a name="l00164"></a>00164    <span class="stringliteral">&#39;ts&#39;</span> =&gt; time()
<a name="l00165"></a>00165   ));
<a name="l00166"></a>00166   
<a name="l00167"></a>00167   <span class="keywordflow">return</span> $dm;
<a name="l00168"></a>00168  }
<a name="l00169"></a>00169  
<a name="l00178"></a><a class="code" href="class_c_m_data_model.html#a9b09f509bd7fc4d845d88da10effef73">00178</a>  <span class="keyword">public</span> function <a class="code" href="class_c_m_data_model.html#a9b09f509bd7fc4d845d88da10effef73" title="Get this data model&amp;#39;s name.">getDataModelName</a>() {
<a name="l00179"></a>00179   <span class="keywordflow">return</span> $this-&gt;name;
<a name="l00180"></a>00180  }
<a name="l00181"></a>00181  
<a name="l00196"></a><a class="code" href="class_c_m_data_model.html#a4669bdd15501e34d56f359381be4ff4e">00196</a>  <span class="keyword">public</span> function <span class="keyword">get</span>(<a class="code" href="class_c_m_data_model.html#ab2fc40d43824ea3e1ce5d86dee0d763b" title="The data model name.">$name</a>, <a class="code" href="class_c_m_data_model.html#a0e235d3f271fa9c26b947e1e14158d60" title="Storage pools.">$pool</a> = <span class="stringliteral">&#39;public&#39;</span>) {
<a name="l00197"></a>00197   <span class="comment">// if the pool doesn&#39;t exist we&#39;ll chuck an error</span>
<a name="l00198"></a>00198   <span class="keywordflow">if</span>(!$this-&gt;<a class="code" href="class_c_m_data_model.html#abfaed3adbf6f1db8dca30cb6047fc27e" title="Check if a pool exists.">poolExists</a>(<a class="code" href="class_c_m_data_model.html#a0e235d3f271fa9c26b947e1e14158d60" title="Storage pools.">$pool</a>)) {
<a name="l00199"></a>00199    $this-&gt;<a class="code" href="class_c_m_error.html#a6d110c63a1c5103df7979612ed5209d3" title="Throw a Warning level message.">throwWarning</a>(<span class="stringliteral">&quot;Pool &#39;$pool&#39; does not exist.&quot;</span>);
<a name="l00200"></a>00200    <span class="keywordflow">return</span> NULL;
<a name="l00201"></a>00201   }
<a name="l00202"></a>00202   
<a name="l00203"></a>00203   <span class="keywordflow">return</span> $this-&gt;pools[<a class="code" href="class_c_m_data_model.html#a0e235d3f271fa9c26b947e1e14158d60" title="Storage pools.">$pool</a>][<a class="code" href="class_c_m_data_model.html#ab2fc40d43824ea3e1ce5d86dee0d763b" title="The data model name.">$name</a>];
<a name="l00204"></a>00204  }
<a name="l00205"></a>00205  
<a name="l00225"></a><a class="code" href="class_c_m_data_model.html#a1f953164304b3bd1f67192f6f35cc59e">00225</a>  <span class="keyword">public</span> function <span class="keyword">set</span>(<a class="code" href="class_c_m_data_model.html#ab2fc40d43824ea3e1ce5d86dee0d763b" title="The data model name.">$name</a>, $value = <span class="keyword">false</span>, <a class="code" href="class_c_m_data_model.html#a0e235d3f271fa9c26b947e1e14158d60" title="Storage pools.">$pool</a> = <span class="stringliteral">&#39;public&#39;</span>) {
<a name="l00226"></a>00226   <span class="comment">// make sure the pool exists</span>
<a name="l00227"></a>00227   <span class="keywordflow">if</span>(!$this-&gt;<a class="code" href="class_c_m_data_model.html#abfaed3adbf6f1db8dca30cb6047fc27e" title="Check if a pool exists.">poolExists</a>(<a class="code" href="class_c_m_data_model.html#a0e235d3f271fa9c26b947e1e14158d60" title="Storage pools.">$pool</a>)) {
<a name="l00228"></a>00228    $this-&gt;<a class="code" href="class_c_m_error.html#a6d110c63a1c5103df7979612ed5209d3" title="Throw a Warning level message.">throwWarning</a>(<span class="stringliteral">&quot;Pool &#39;$pool&#39; does not exist.&quot;</span>);
<a name="l00229"></a>00229    <span class="keywordflow">return</span> NULL;
<a name="l00230"></a>00230   }
<a name="l00231"></a>00231   
<a name="l00232"></a>00232   <span class="comment">// set the variable</span>
<a name="l00233"></a>00233   $this-&gt;pools[<a class="code" href="class_c_m_data_model.html#a0e235d3f271fa9c26b947e1e14158d60" title="Storage pools.">$pool</a>][<a class="code" href="class_c_m_data_model.html#ab2fc40d43824ea3e1ce5d86dee0d763b" title="The data model name.">$name</a>] = $value;
<a name="l00234"></a>00234   <span class="keywordflow">return</span> $this-&gt;pools[<a class="code" href="class_c_m_data_model.html#a0e235d3f271fa9c26b947e1e14158d60" title="Storage pools.">$pool</a>][<a class="code" href="class_c_m_data_model.html#ab2fc40d43824ea3e1ce5d86dee0d763b" title="The data model name.">$name</a>];
<a name="l00235"></a>00235  }
<a name="l00236"></a>00236  
<a name="l00246"></a><a class="code" href="class_c_m_data_model.html#a29d1c0715b5c0846850a2b9290755bc1">00246</a>  <span class="keyword">public</span> function <a class="code" href="class_c_m_data_model.html#a29d1c0715b5c0846850a2b9290755bc1" title="Request a variable from the $_GET or $_POST.">request</a>(<a class="code" href="class_c_m_data_model.html#ab2fc40d43824ea3e1ce5d86dee0d763b" title="The data model name.">$name</a>) {
<a name="l00247"></a>00247   <span class="keywordflow">if</span>($this-&gt;<a class="code" href="class_c_m_data_model.html#ac27d633cdc18300238fcaa81aecf0eac" title="Check if a variable exists in a pool.">exists</a>(<a class="code" href="class_c_m_data_model.html#ab2fc40d43824ea3e1ce5d86dee0d763b" title="The data model name.">$name</a>, <span class="stringliteral">&#39;get&#39;</span>))
<a name="l00248"></a>00248    <span class="keywordflow">return</span> $this-&gt;<span class="keyword">get</span>(<a class="code" href="class_c_m_data_model.html#ab2fc40d43824ea3e1ce5d86dee0d763b" title="The data model name.">$name</a>, <span class="stringliteral">&#39;get&#39;</span>);
<a name="l00249"></a>00249   <span class="keywordflow">if</span>($this-&gt;<a class="code" href="class_c_m_data_model.html#ac27d633cdc18300238fcaa81aecf0eac" title="Check if a variable exists in a pool.">exists</a>(<a class="code" href="class_c_m_data_model.html#ab2fc40d43824ea3e1ce5d86dee0d763b" title="The data model name.">$name</a>, <span class="stringliteral">&#39;post&#39;</span>))
<a name="l00250"></a>00250    <span class="keywordflow">return</span> $this-&gt;<span class="keyword">get</span>(<a class="code" href="class_c_m_data_model.html#ab2fc40d43824ea3e1ce5d86dee0d763b" title="The data model name.">$name</a>, <span class="stringliteral">&#39;post&#39;</span>);
<a name="l00251"></a>00251   <span class="keywordflow">return</span> NULL;
<a name="l00252"></a>00252  }
<a name="l00253"></a>00253  
<a name="l00262"></a><a class="code" href="class_c_m_data_model.html#aa92996ce6f6f81429d549faf1d20a550">00262</a>  <span class="keyword">public</span> function <a class="code" href="class_c_m_data_model.html#aa92996ce6f6f81429d549faf1d20a550" title="Get the CMValidator.">getValidator</a>() {
<a name="l00263"></a>00263   <span class="keywordflow">return</span> $this-&gt;vh;
<a name="l00264"></a>00264  }
<a name="l00265"></a>00265  
<a name="l00274"></a><a class="code" href="class_c_m_data_model.html#a1c1400750e7bf35be8c28e1f6d449df0">00274</a>  <span class="keyword">public</span> function <a class="code" href="class_c_m_data_model.html#a1c1400750e7bf35be8c28e1f6d449df0" title="Has the validator been set?">hasValidator</a>() {
<a name="l00275"></a>00275   <span class="keywordflow">return</span> $this-&gt;vh !== <span class="keyword">false</span>;
<a name="l00276"></a>00276  }
<a name="l00277"></a>00277  
<a name="l00286"></a><a class="code" href="class_c_m_data_model.html#a4aba85beb43b0d820c38eabb7bbe5eca">00286</a>  <span class="keyword">public</span> function <a class="code" href="class_c_m_data_model.html#a4aba85beb43b0d820c38eabb7bbe5eca" title="Has the database handle been set?">hasDatabase</a>() {
<a name="l00287"></a>00287   <span class="keywordflow">return</span> $this-&gt;dbh !== <span class="keyword">false</span>;
<a name="l00288"></a>00288  }
<a name="l00289"></a>00289  
<a name="l00301"></a><a class="code" href="class_c_m_data_model.html#afbe885d4740131bbe89e00f665a1daa8">00301</a>  <span class="keyword">public</span> function <a class="code" href="class_c_m_data_model.html#afbe885d4740131bbe89e00f665a1daa8" title="Redirect page location.">redirect</a>($url, $values = array()) {
<a name="l00302"></a>00302   <a class="code" href="class_c_m_header.html#a5c3c4d2173a776fe82497c09d60b2e14" title="Redirect the browser to a new location.">CMHeader::Location</a>($url, $values);
<a name="l00303"></a>00303  }
<a name="l00304"></a>00304  
<a name="l00312"></a><a class="code" href="class_c_m_data_model.html#ac27d633cdc18300238fcaa81aecf0eac">00312</a>  <span class="keyword">public</span> function <a class="code" href="class_c_m_data_model.html#ac27d633cdc18300238fcaa81aecf0eac" title="Check if a variable exists in a pool.">exists</a>(<a class="code" href="class_c_m_data_model.html#ab2fc40d43824ea3e1ce5d86dee0d763b" title="The data model name.">$name</a>, <a class="code" href="class_c_m_data_model.html#a0e235d3f271fa9c26b947e1e14158d60" title="Storage pools.">$pool</a> = <span class="stringliteral">&#39;public&#39;</span>) {
<a name="l00313"></a>00313   <span class="comment">// check if the pool exists</span>
<a name="l00314"></a>00314   <span class="keywordflow">if</span>(!isset($this-&gt;pools[<a class="code" href="class_c_m_data_model.html#a0e235d3f271fa9c26b947e1e14158d60" title="Storage pools.">$pool</a>]))
<a name="l00315"></a>00315    <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00316"></a>00316    
<a name="l00317"></a>00317   <span class="keywordflow">return</span> isset($this-&gt;pools[$pool][<a class="code" href="class_c_m_data_model.html#ab2fc40d43824ea3e1ce5d86dee0d763b" title="The data model name.">$name</a>]);
<a name="l00318"></a>00318  }
<a name="l00319"></a>00319  
<a name="l00329"></a><a class="code" href="class_c_m_data_model.html#a21dc9dc2d1c9b7568a44b44113240873">00329</a>  <span class="keyword">public</span> function <a class="code" href="class_c_m_data_model.html#a21dc9dc2d1c9b7568a44b44113240873" title="Set a variable in the global pool.">setGlobal</a>(<a class="code" href="class_c_m_data_model.html#ab2fc40d43824ea3e1ce5d86dee0d763b" title="The data model name.">$name</a>, $value = <span class="keyword">false</span>) {
<a name="l00330"></a>00330   <a class="code" href="class_c_m_data_model.html#af7b6b0a1e84c7b824dacabe1fb1046c9" title="The global pool.">CMDataModel::$GlobalPool</a>[<a class="code" href="class_c_m_data_model.html#ab2fc40d43824ea3e1ce5d86dee0d763b" title="The data model name.">$name</a>] = $value;
<a name="l00331"></a>00331   <span class="keywordflow">return</span> <a class="code" href="class_c_m_data_model.html#af7b6b0a1e84c7b824dacabe1fb1046c9" title="The global pool.">CMDataModel::$GlobalPool</a>[<a class="code" href="class_c_m_data_model.html#ab2fc40d43824ea3e1ce5d86dee0d763b" title="The data model name.">$name</a>];
<a name="l00332"></a>00332  }
<a name="l00333"></a>00333 
<a name="l00342"></a><a class="code" href="class_c_m_data_model.html#a599e0e3a81f394e0515eeadaf65a2bc8">00342</a>  <span class="keyword">public</span> function <a class="code" href="class_c_m_data_model.html#a599e0e3a81f394e0515eeadaf65a2bc8" title="Get a variable from the global pool.">getGlobal</a>(<a class="code" href="class_c_m_data_model.html#ab2fc40d43824ea3e1ce5d86dee0d763b" title="The data model name.">$name</a>) {
<a name="l00343"></a>00343   <span class="keywordflow">if</span>(!isset(<a class="code" href="class_c_m_data_model.html#af7b6b0a1e84c7b824dacabe1fb1046c9" title="The global pool.">CMDataModel::$GlobalPool</a>[<a class="code" href="class_c_m_data_model.html#ab2fc40d43824ea3e1ce5d86dee0d763b" title="The data model name.">$name</a>]))
<a name="l00344"></a>00344    <span class="keywordflow">return</span> NULL;
<a name="l00345"></a>00345    
<a name="l00346"></a>00346   <span class="keywordflow">return</span> <a class="code" href="class_c_m_data_model.html#af7b6b0a1e84c7b824dacabe1fb1046c9" title="The global pool.">CMDataModel::$GlobalPool</a>[$name];
<a name="l00347"></a>00347  }
<a name="l00348"></a>00348  
<a name="l00355"></a><a class="code" href="class_c_m_data_model.html#abfaed3adbf6f1db8dca30cb6047fc27e">00355</a>  <span class="keyword">public</span> function <a class="code" href="class_c_m_data_model.html#abfaed3adbf6f1db8dca30cb6047fc27e" title="Check if a pool exists.">poolExists</a>(<a class="code" href="class_c_m_data_model.html#ab2fc40d43824ea3e1ce5d86dee0d763b" title="The data model name.">$name</a> = <span class="stringliteral">&#39;public&#39;</span>) {
<a name="l00356"></a>00356   <span class="keywordflow">return</span> isset($this-&gt;pools[<a class="code" href="class_c_m_data_model.html#ab2fc40d43824ea3e1ce5d86dee0d763b" title="The data model name.">$name</a>]);
<a name="l00357"></a>00357  }
<a name="l00358"></a>00358  
<a name="l00368"></a><a class="code" href="class_c_m_data_model.html#a5adeb54831286c98f640c18264be9b8c">00368</a>  <span class="keyword">public</span> function <a class="code" href="class_c_m_data_model.html#a5adeb54831286c98f640c18264be9b8c" title="Set the database handle.">setDatabase</a>(<a class="code" href="interface_c_m_database_protocol.html" title="All database connectivity classes implement this interface.">CMDatabaseProtocol</a> $database) {
<a name="l00369"></a>00369   $this-&gt;dbh = $database;
<a name="l00370"></a>00370   <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00371"></a>00371  }
<a name="l00372"></a>00372  
<a name="l00382"></a><a class="code" href="class_c_m_data_model.html#a3ca68c1e5f52636ec4b548deff898dc7">00382</a>  <span class="keyword">public</span> function <a class="code" href="class_c_m_data_model.html#a3ca68c1e5f52636ec4b548deff898dc7" title="Delete a pool.">deletePool</a>(<a class="code" href="class_c_m_data_model.html#ab2fc40d43824ea3e1ce5d86dee0d763b" title="The data model name.">$name</a>) {
<a name="l00383"></a>00383   unset($_SESSION[<span class="stringliteral">&quot;datamodel_$name&quot;</span>]);
<a name="l00384"></a>00384   <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00385"></a>00385  }
<a name="l00386"></a>00386  
<a name="l00397"></a><a class="code" href="class_c_m_data_model.html#a728138a9219e8751278542c3a8c5e3a9">00397</a>  <span class="keyword">public</span> function <a class="code" href="class_c_m_data_model.html#a728138a9219e8751278542c3a8c5e3a9" title="Return the database handle.">getDatabase</a>() {
<a name="l00398"></a>00398   <span class="keywordflow">return</span> $this-&gt;dbh;
<a name="l00399"></a>00399  }
<a name="l00400"></a>00400  
<a name="l00410"></a><a class="code" href="class_c_m_data_model.html#a4319ce5ab58d1596139a4cee9696b2dc">00410</a>  <span class="keyword">public</span> function <a class="code" href="class_c_m_data_model.html#a4319ce5ab58d1596139a4cee9696b2dc" title="Drain (reset, wipe, clear) a pool or pools of all its variables.">drainPool</a>(<a class="code" href="class_c_m_data_model.html#ab2fc40d43824ea3e1ce5d86dee0d763b" title="The data model name.">$name</a> = <span class="stringliteral">&#39;public&#39;</span>) {
<a name="l00411"></a>00411   <span class="comment">// recurse if needed</span>
<a name="l00412"></a>00412   <span class="keywordflow">if</span>(is_array(<a class="code" href="class_c_m_data_model.html#ab2fc40d43824ea3e1ce5d86dee0d763b" title="The data model name.">$name</a>)) {
<a name="l00413"></a>00413    <span class="keywordflow">foreach</span>(<a class="code" href="class_c_m_data_model.html#ab2fc40d43824ea3e1ce5d86dee0d763b" title="The data model name.">$name</a> as $n) {
<a name="l00414"></a>00414     <span class="keywordflow">if</span>(!$this-&gt;<a class="code" href="class_c_m_data_model.html#a4319ce5ab58d1596139a4cee9696b2dc" title="Drain (reset, wipe, clear) a pool or pools of all its variables.">drainPool</a>($n))
<a name="l00415"></a>00415      <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00416"></a>00416    }
<a name="l00417"></a>00417    <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00418"></a>00418   }
<a name="l00419"></a>00419   
<a name="l00420"></a>00420   <span class="comment">// make sure the pool exists</span>
<a name="l00421"></a>00421   <span class="keywordflow">if</span>(!$this-&gt;<a class="code" href="class_c_m_data_model.html#abfaed3adbf6f1db8dca30cb6047fc27e" title="Check if a pool exists.">poolExists</a>(<a class="code" href="class_c_m_data_model.html#ab2fc40d43824ea3e1ce5d86dee0d763b" title="The data model name.">$name</a>)) {
<a name="l00422"></a>00422    $this-&gt;<a class="code" href="class_c_m_error.html#a979e2a7fdb7568763efba5d34f763ea7" title="Throw a Notice level message.">throwNotice</a>(<span class="stringliteral">&quot;Pool &#39;$name&#39; does not exist.&quot;</span>);
<a name="l00423"></a>00423    <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00424"></a>00424   }
<a name="l00425"></a>00425   
<a name="l00426"></a>00426   <span class="comment">// drain pool</span>
<a name="l00427"></a>00427   $this-&gt;pools[<a class="code" href="class_c_m_data_model.html#ab2fc40d43824ea3e1ce5d86dee0d763b" title="The data model name.">$name</a>] = array();
<a name="l00428"></a>00428   
<a name="l00429"></a>00429   <span class="comment">// drain validator</span>
<a name="l00430"></a>00430   <span class="keywordflow">if</span>($this-&gt;vh !== <span class="keyword">false</span>) {
<a name="l00431"></a>00431    <span class="keywordflow">foreach</span>($this-&gt;vh-&gt;invalidFields as $k =&gt; $v) {
<a name="l00432"></a>00432     $pos = strpos($k, <span class="charliteral">&#39;[&#39;</span>);
<a name="l00433"></a>00433     <span class="keywordflow">if</span>($pos !== <span class="keyword">false</span> &amp;&amp; substr($k, 0, $pos) == <a class="code" href="class_c_m_data_model.html#ab2fc40d43824ea3e1ce5d86dee0d763b" title="The data model name.">$name</a>)
<a name="l00434"></a>00434      unset($this-&gt;vh-&gt;invalidFields[$k]);
<a name="l00435"></a>00435    }
<a name="l00436"></a>00436   }
<a name="l00437"></a>00437   
<a name="l00438"></a>00438   <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00439"></a>00439  }
<a name="l00440"></a>00440  
<a name="l00453"></a><a class="code" href="class_c_m_data_model.html#a184909dab34698899937d810a9f5d393">00453</a>  <span class="keyword">public</span> function <a class="code" href="class_c_m_data_model.html#a184909dab34698899937d810a9f5d393" title="Validate.">validate</a>() {
<a name="l00454"></a>00454   <span class="comment">// make sure we have a validating object</span>
<a name="l00455"></a>00455   <span class="keywordflow">if</span>($this-&gt;vh === <span class="keyword">false</span>)
<a name="l00456"></a>00456    <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00457"></a>00457   
<a name="l00458"></a>00458   <span class="keywordflow">return</span> $this-&gt;vh-&gt;validate($this);
<a name="l00459"></a>00459  }
<a name="l00460"></a>00460  
<a name="l00470"></a><a class="code" href="class_c_m_data_model.html#abf7461b9c7ab978f032ca285f6fa00f6">00470</a>  <span class="keyword">public</span> function <a class="code" href="class_c_m_data_model.html#abf7461b9c7ab978f032ca285f6fa00f6" title="Set the validator object.">setValidator</a>(<a class="code" href="class_c_m_validator.html" title="Validation interface.">CMValidator</a> $validator) {
<a name="l00471"></a>00471   $this-&gt;vh = $validator;
<a name="l00472"></a>00472   <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00473"></a>00473  }
<a name="l00474"></a>00474  
<a name="l00483"></a><a class="code" href="class_c_m_data_model.html#aee3546ecf44233d599e9c38d2ad30b44">00483</a>  <span class="keyword">public</span> function <a class="code" href="class_c_m_data_model.html#aee3546ecf44233d599e9c38d2ad30b44" title="Get a pool as an array.">getPool</a>(<a class="code" href="class_c_m_data_model.html#ab2fc40d43824ea3e1ce5d86dee0d763b" title="The data model name.">$name</a> = <span class="stringliteral">&#39;public&#39;</span>) {
<a name="l00484"></a>00484   <span class="comment">// make sure the pool exists</span>
<a name="l00485"></a>00485   <span class="keywordflow">if</span>(!$this-&gt;<a class="code" href="class_c_m_data_model.html#abfaed3adbf6f1db8dca30cb6047fc27e" title="Check if a pool exists.">poolExists</a>(<a class="code" href="class_c_m_data_model.html#ab2fc40d43824ea3e1ce5d86dee0d763b" title="The data model name.">$name</a>)) {
<a name="l00486"></a>00486    $this-&gt;<a class="code" href="class_c_m_error.html#a6d110c63a1c5103df7979612ed5209d3" title="Throw a Warning level message.">throwWarning</a>(<span class="stringliteral">&quot;Pool &#39;$name&#39; does not exist.&quot;</span>);
<a name="l00487"></a>00487    <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00488"></a>00488   }
<a name="l00489"></a>00489   
<a name="l00490"></a>00490   <span class="keywordflow">return</span> $this-&gt;pools[<a class="code" href="class_c_m_data_model.html#ab2fc40d43824ea3e1ce5d86dee0d763b" title="The data model name.">$name</a>];
<a name="l00491"></a>00491  }
<a name="l00492"></a>00492  
<a name="l00514"></a><a class="code" href="class_c_m_data_model.html#a22665a019691286a583d60776c1b876a">00514</a>  <span class="keyword">public</span> function <a class="code" href="class_c_m_data_model.html#a22665a019691286a583d60776c1b876a" title="Perform a database INSERT.">databaseInsert</a>($tableName, $fields = <span class="stringliteral">&#39;auto&#39;</span>, $a = <span class="keyword">false</span>) {
<a name="l00515"></a>00515   <span class="comment">// if the $fields are &#39;auto&#39; we use the pool that is the same name as the table</span>
<a name="l00516"></a>00516   <span class="keywordflow">if</span>($fields == <span class="stringliteral">&#39;auto&#39;</span>) {
<a name="l00517"></a>00517    <span class="keywordflow">if</span>(!$this-&gt;<a class="code" href="class_c_m_data_model.html#abfaed3adbf6f1db8dca30cb6047fc27e" title="Check if a pool exists.">poolExists</a>($tableName))
<a name="l00518"></a>00518     <span class="keywordflow">return</span> $this-&gt;<a class="code" href="class_c_m_error.html#a6d110c63a1c5103df7979612ed5209d3" title="Throw a Warning level message.">throwWarning</a>(<span class="stringliteral">&quot;Pool &#39;$tableName&#39; does not exist.&quot;</span>);
<a name="l00519"></a>00519    $fields = $this-&gt;pools[$tableName];
<a name="l00520"></a>00520   }
<a name="l00521"></a>00521    
<a name="l00522"></a>00522   <span class="comment">// we need a database handle</span>
<a name="l00523"></a>00523   <span class="keywordflow">if</span>(!$this-&gt;dbh)
<a name="l00524"></a>00524    <span class="keywordflow">return</span> $this-&gt;<a class="code" href="class_c_m_error.html#a6d110c63a1c5103df7979612ed5209d3" title="Throw a Warning level message.">throwWarning</a>(<span class="stringliteral">&quot;No database handle.&quot;</span>);
<a name="l00525"></a>00525   
<a name="l00526"></a>00526   <span class="comment">// perform the insert</span>
<a name="l00527"></a>00527   <span class="keywordflow">return</span> $this-&gt;dbh-&gt;insert($tableName, $fields, $a);
<a name="l00528"></a>00528  }
<a name="l00529"></a>00529  
<a name="l00547"></a><a class="code" href="class_c_m_data_model.html#aab90eeaafcae186a2c69527311544e94">00547</a>  <span class="keyword">public</span> function <a class="code" href="class_c_m_data_model.html#aab90eeaafcae186a2c69527311544e94" title="Perform a database UPDATE.">databaseUpdate</a>($tableName, $filter, $fields = <span class="stringliteral">&#39;auto&#39;</span>, $a = <span class="keyword">false</span>) {
<a name="l00548"></a>00548   <span class="comment">// if the $fields are &#39;auto&#39; we use the pool that is the same name as the table</span>
<a name="l00549"></a>00549   <span class="keywordflow">if</span>($fields == <span class="stringliteral">&#39;auto&#39;</span>) {
<a name="l00550"></a>00550    <span class="keywordflow">if</span>(!$this-&gt;<a class="code" href="class_c_m_data_model.html#abfaed3adbf6f1db8dca30cb6047fc27e" title="Check if a pool exists.">poolExists</a>($tableName))
<a name="l00551"></a>00551     <span class="keywordflow">return</span> $this-&gt;<a class="code" href="class_c_m_error.html#a6d110c63a1c5103df7979612ed5209d3" title="Throw a Warning level message.">throwWarning</a>(<span class="stringliteral">&quot;Pool &#39;$tableName&#39; does not exist.&quot;</span>);
<a name="l00552"></a>00552    $fields = $this-&gt;pools[$tableName];
<a name="l00553"></a>00553   }
<a name="l00554"></a>00554    
<a name="l00555"></a>00555   <span class="comment">// we need a database handle</span>
<a name="l00556"></a>00556   <span class="keywordflow">if</span>(!$this-&gt;dbh)
<a name="l00557"></a>00557    <span class="keywordflow">return</span> $this-&gt;<a class="code" href="class_c_m_error.html#a6d110c63a1c5103df7979612ed5209d3" title="Throw a Warning level message.">throwWarning</a>(<span class="stringliteral">&quot;No database handle.&quot;</span>);
<a name="l00558"></a>00558   
<a name="l00559"></a>00559   <span class="comment">// perform the update</span>
<a name="l00560"></a>00560   <span class="keywordflow">return</span> $this-&gt;dbh-&gt;update($tableName, $fields, $filter, $a);
<a name="l00561"></a>00561  }
<a name="l00562"></a>00562  
<a name="l00579"></a><a class="code" href="class_c_m_data_model.html#ad7089636cd9321b024e682ed9f90bed6">00579</a>  <span class="keyword">public</span> function <a class="code" href="class_c_m_data_model.html#ad7089636cd9321b024e682ed9f90bed6" title="Perform a database DELETE.">databaseDelete</a>($tableName, $filter, $a = <span class="keyword">false</span>) {
<a name="l00580"></a>00580   <span class="comment">// we need a database handle</span>
<a name="l00581"></a>00581   <span class="keywordflow">if</span>(!$this-&gt;dbh)
<a name="l00582"></a>00582    <span class="keywordflow">return</span> $this-&gt;<a class="code" href="class_c_m_error.html#a6d110c63a1c5103df7979612ed5209d3" title="Throw a Warning level message.">throwWarning</a>(<span class="stringliteral">&quot;No database handle.&quot;</span>);
<a name="l00583"></a>00583   
<a name="l00584"></a>00584   <span class="comment">// perform the delete</span>
<a name="l00585"></a>00585   <span class="keywordflow">return</span> $this-&gt;dbh-&gt;delete($tableName, $filter, $a);
<a name="l00586"></a>00586  }
<a name="l00587"></a>00587  
<a name="l00596"></a><a class="code" href="class_c_m_data_model.html#ae558e743817dcb7f76ac6827045bdc28">00596</a>  <span class="keyword">public</span> function <a class="code" href="class_c_m_data_model.html#ae558e743817dcb7f76ac6827045bdc28" title="Add a new pool.">addPool</a>(<a class="code" href="class_c_m_data_model.html#ab2fc40d43824ea3e1ce5d86dee0d763b" title="The data model name.">$name</a>, $replace = <span class="keyword">false</span>) {
<a name="l00597"></a>00597   <span class="comment">// if $replace is off and the pool exists we take no action</span>
<a name="l00598"></a>00598   <span class="keywordflow">if</span>(!$replace &amp;&amp; $this-&gt;<a class="code" href="class_c_m_data_model.html#abfaed3adbf6f1db8dca30cb6047fc27e" title="Check if a pool exists.">poolExists</a>(<a class="code" href="class_c_m_data_model.html#ab2fc40d43824ea3e1ce5d86dee0d763b" title="The data model name.">$name</a>))
<a name="l00599"></a>00599    <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00600"></a>00600   
<a name="l00601"></a>00601   $this-&gt;pools[<a class="code" href="class_c_m_data_model.html#ab2fc40d43824ea3e1ce5d86dee0d763b" title="The data model name.">$name</a>] = array();
<a name="l00602"></a>00602   <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00603"></a>00603  }
<a name="l00604"></a>00604  
<a name="l00615"></a><a class="code" href="class_c_m_data_model.html#aba80786f64c89c654783baddf84c8fbc">00615</a>  <span class="keyword">public</span> function <a class="code" href="class_c_m_data_model.html#aba80786f64c89c654783baddf84c8fbc" title="Fill (but not wipe) a pool from an array.">fillPool</a>(array $values, <a class="code" href="class_c_m_data_model.html#ab2fc40d43824ea3e1ce5d86dee0d763b" title="The data model name.">$name</a> = <span class="stringliteral">&#39;public&#39;</span>) {
<a name="l00616"></a>00616   <span class="comment">// make sure the pool exists</span>
<a name="l00617"></a>00617   <span class="keywordflow">if</span>(!$this-&gt;<a class="code" href="class_c_m_data_model.html#abfaed3adbf6f1db8dca30cb6047fc27e" title="Check if a pool exists.">poolExists</a>(<a class="code" href="class_c_m_data_model.html#ab2fc40d43824ea3e1ce5d86dee0d763b" title="The data model name.">$name</a>))
<a name="l00618"></a>00618    <span class="keywordflow">return</span> $this-&gt;<a class="code" href="class_c_m_error.html#a6d110c63a1c5103df7979612ed5209d3" title="Throw a Warning level message.">throwWarning</a>(<span class="stringliteral">&quot;Pool &#39;$name&#39; does not exist.&quot;</span>);
<a name="l00619"></a>00619   
<a name="l00620"></a>00620   <span class="comment">// add items to the pool</span>
<a name="l00621"></a>00621   <span class="keywordflow">foreach</span>($values as $k =&gt; $v)
<a name="l00622"></a>00622    $this-&gt;pools[<a class="code" href="class_c_m_data_model.html#ab2fc40d43824ea3e1ce5d86dee0d763b" title="The data model name.">$name</a>][$k] = $v;
<a name="l00623"></a>00623   
<a name="l00624"></a>00624   <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00625"></a>00625  }
<a name="l00626"></a>00626  
<a name="l00632"></a><a class="code" href="class_c_m_data_model.html#a7b2c35294ce6c20349be500ed59bb96d">00632</a>  <span class="keyword">public</span> <span class="keyword">static</span> function <a class="code" href="class_c_m_data_model.html#a7b2c35294ce6c20349be500ed59bb96d" title="Get the names of all the data models connected with this session.">GetDataModelNames</a>() {
<a name="l00633"></a>00633   $r = array();
<a name="l00634"></a>00634   <span class="keywordflow">foreach</span>(array_keys($_SESSION) as $k) {
<a name="l00635"></a>00635    <span class="keywordflow">if</span>(substr($k, 0, 10) == <span class="stringliteral">&#39;datamodel_&#39;</span>)
<a name="l00636"></a>00636     array_push($r, substr($k, 10));
<a name="l00637"></a>00637   }
<a name="l00638"></a>00638   <span class="keywordflow">return</span> $r;
<a name="l00639"></a>00639  }
<a name="l00640"></a>00640  
<a name="l00649"></a><a class="code" href="class_c_m_data_model.html#a64651b904ad25f480669c2c02a6d9b88">00649</a>  <span class="keyword">public</span> <span class="keyword">static</span> function <a class="code" href="class_c_m_data_model.html#a64651b904ad25f480669c2c02a6d9b88" title="Create a new data model.">CreateDataModel</a>(<a class="code" href="class_c_m_data_model.html#ab2fc40d43824ea3e1ce5d86dee0d763b" title="The data model name.">$name</a> = <span class="stringliteral">&#39;default&#39;</span>, $force = <span class="keyword">false</span>) {
<a name="l00650"></a>00650   <span class="comment">// check if the data model already exists</span>
<a name="l00651"></a>00651   <span class="keywordflow">if</span>(isset($_SESSION[<span class="stringliteral">&quot;datamodel_$name&quot;</span>])) {
<a name="l00652"></a>00652    <span class="keywordflow">if</span>($force)
<a name="l00653"></a>00653     $_SESSION[<span class="stringliteral">&quot;datamodel_$name&quot;</span>] = <span class="keyword">new</span> <a class="code" href="class_c_m_data_model.html#a24f2101b0f1705098ad7417306188585" title="Create or restore a data model.">CMDataModel</a>(<a class="code" href="class_c_m_data_model.html#ab2fc40d43824ea3e1ce5d86dee0d763b" title="The data model name.">$name</a>);
<a name="l00654"></a>00654   } <span class="keywordflow">else</span> $_SESSION[<span class="stringliteral">&quot;datamodel_$name&quot;</span>] = <span class="keyword">new</span> <a class="code" href="class_c_m_data_model.html#a24f2101b0f1705098ad7417306188585" title="Create or restore a data model.">CMDataModel</a>(<a class="code" href="class_c_m_data_model.html#ab2fc40d43824ea3e1ce5d86dee0d763b" title="The data model name.">$name</a>);
<a name="l00655"></a>00655   
<a name="l00656"></a>00656   <span class="keywordflow">return</span> $_SESSION[<span class="stringliteral">&quot;datamodel_$name&quot;</span>];
<a name="l00657"></a>00657  }
<a name="l00658"></a>00658  
<a name="l00665"></a><a class="code" href="class_c_m_data_model.html#a5d4e6d0d4d9300f9ab2c4c5d7cf4998d">00665</a>  <span class="keyword">public</span> <span class="keyword">static</span> function <a class="code" href="class_c_m_data_model.html#a5d4e6d0d4d9300f9ab2c4c5d7cf4998d" title="Delete a data model.">DeleteDataModel</a>(<a class="code" href="class_c_m_data_model.html#ab2fc40d43824ea3e1ce5d86dee0d763b" title="The data model name.">$name</a> = <span class="stringliteral">&#39;default&#39;</span>) {
<a name="l00666"></a>00666   unset($_SESSION[<span class="stringliteral">&quot;datamodel_$name&quot;</span>]);
<a name="l00667"></a>00667   <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00668"></a>00668  }
<a name="l00669"></a>00669  
<a name="l00675"></a><a class="code" href="class_c_m_data_model.html#a66670e930bddd69a482c10c634a9f056">00675</a>  <span class="keyword">public</span> function <a class="code" href="class_c_m_data_model.html#a66670e930bddd69a482c10c634a9f056" title="Get history URLs.">getHistory</a>() {
<a name="l00676"></a>00676   <span class="keywordflow">return</span> $this-&gt;history;
<a name="l00677"></a>00677  }
<a name="l00678"></a>00678  
<a name="l00685"></a><a class="code" href="class_c_m_data_model.html#a1dc5caf4c20fbcf9ca3976a3e7de74aa">00685</a>  <span class="keyword">public</span> function <a class="code" href="class_c_m_data_model.html#a1dc5caf4c20fbcf9ca3976a3e7de74aa" title="Submit to a previous location.">submitBackwards</a>($length = 1) {
<a name="l00686"></a>00686   $this-&gt;<a class="code" href="class_c_m_data_model.html#afbe885d4740131bbe89e00f665a1daa8" title="Redirect page location.">redirect</a>($this-&gt;history[count($this-&gt;history) - $length - 1][<span class="stringliteral">&#39;url&#39;</span>]);
<a name="l00687"></a>00687  }
<a name="l00688"></a>00688  
<a name="l00698"></a><a class="code" href="class_c_m_data_model.html#a071d15ce010f6493182e6b2dee0f7d83">00698</a>  <span class="keyword">public</span> function <a class="code" href="class_c_m_data_model.html#a071d15ce010f6493182e6b2dee0f7d83" title="Extract the bare name and real value from a variable.">extractNameValue</a>(<a class="code" href="class_c_m_data_model.html#ab2fc40d43824ea3e1ce5d86dee0d763b" title="The data model name.">$name</a>) {
<a name="l00699"></a>00699   $pos = strpos(<a class="code" href="class_c_m_data_model.html#ab2fc40d43824ea3e1ce5d86dee0d763b" title="The data model name.">$name</a>, <span class="charliteral">&#39;[&#39;</span>);
<a name="l00700"></a>00700   <span class="keywordflow">if</span>($pos !== <span class="keyword">false</span>) {
<a name="l00701"></a>00701    <a class="code" href="class_c_m_data_model.html#a0e235d3f271fa9c26b947e1e14158d60" title="Storage pools.">$pool</a> = substr(<a class="code" href="class_c_m_data_model.html#ab2fc40d43824ea3e1ce5d86dee0d763b" title="The data model name.">$name</a>, 0, $pos);
<a name="l00702"></a>00702    $newname = substr(<a class="code" href="class_c_m_data_model.html#ab2fc40d43824ea3e1ce5d86dee0d763b" title="The data model name.">$name</a>, $pos + 1, strlen(<a class="code" href="class_c_m_data_model.html#ab2fc40d43824ea3e1ce5d86dee0d763b" title="The data model name.">$name</a>) - $pos - 2);
<a name="l00703"></a>00703    
<a name="l00704"></a>00704    <span class="keywordflow">if</span>(isset($this-&gt;pools[<a class="code" href="class_c_m_data_model.html#a0e235d3f271fa9c26b947e1e14158d60" title="Storage pools.">$pool</a>][$newname]))
<a name="l00705"></a>00705     <span class="keywordflow">return</span> array(<a class="code" href="class_c_m_data_model.html#ab2fc40d43824ea3e1ce5d86dee0d763b" title="The data model name.">$name</a>, $this-&gt;pools[<a class="code" href="class_c_m_data_model.html#a0e235d3f271fa9c26b947e1e14158d60" title="Storage pools.">$pool</a>][$newname]);
<a name="l00706"></a>00706    <span class="keywordflow">return</span> array(<a class="code" href="class_c_m_data_model.html#ab2fc40d43824ea3e1ce5d86dee0d763b" title="The data model name.">$name</a>, NULL);
<a name="l00707"></a>00707   }
<a name="l00708"></a>00708   
<a name="l00709"></a>00709   <span class="keywordflow">if</span>(isset($this-&gt;pools[<span class="stringliteral">&#39;public&#39;</span>][<a class="code" href="class_c_m_data_model.html#ab2fc40d43824ea3e1ce5d86dee0d763b" title="The data model name.">$name</a>]))
<a name="l00710"></a>00710    <span class="keywordflow">return</span> array($name, $this-&gt;pools[<span class="stringliteral">&#39;public&#39;</span>][$name]);
<a name="l00711"></a>00711   <span class="keywordflow">return</span> array($name, NULL);
<a name="l00712"></a>00712  }
<a name="l00713"></a>00713  
<a name="l00727"></a><a class="code" href="class_c_m_data_model.html#ad774b779b8727a58df74e1457cf0ab57">00727</a>  <span class="keyword">public</span> function <a class="code" href="class_c_m_data_model.html#ad774b779b8727a58df74e1457cf0ab57" title="Render a text box.">textBox</a>(<a class="code" href="class_c_m_data_model.html#ab2fc40d43824ea3e1ce5d86dee0d763b" title="The data model name.">$name</a>, $a = <span class="keyword">false</span>) {
<a name="l00728"></a>00728   list($a[<span class="stringliteral">&#39;name&#39;</span>], $a[<span class="stringliteral">&#39;value&#39;</span>]) = $this-&gt;<a class="code" href="class_c_m_data_model.html#a071d15ce010f6493182e6b2dee0f7d83" title="Extract the bare name and real value from a variable.">extractNameValue</a>(<a class="code" href="class_c_m_data_model.html#ab2fc40d43824ea3e1ce5d86dee0d763b" title="The data model name.">$name</a>);
<a name="l00729"></a>00729   <span class="keywordflow">return</span> <a class="code" href="class_c_m_form.html#adaefe5e02971807c89f7dde072e91769" title="Create a single line text box.">CMForm::TextBox</a>($a);
<a name="l00730"></a>00730  }
<a name="l00731"></a>00731  
<a name="l00745"></a><a class="code" href="class_c_m_data_model.html#ae889a0f4fce58df80d8ae6462d52540d">00745</a>  <span class="keyword">public</span> function <a class="code" href="class_c_m_data_model.html#ae889a0f4fce58df80d8ae6462d52540d" title="Render a password box.">passwordBox</a>(<a class="code" href="class_c_m_data_model.html#ab2fc40d43824ea3e1ce5d86dee0d763b" title="The data model name.">$name</a>, $a = <span class="keyword">false</span>) {
<a name="l00746"></a>00746   list($a[<span class="stringliteral">&#39;name&#39;</span>], $a[<span class="stringliteral">&#39;value&#39;</span>]) = $this-&gt;<a class="code" href="class_c_m_data_model.html#a071d15ce010f6493182e6b2dee0f7d83" title="Extract the bare name and real value from a variable.">extractNameValue</a>(<a class="code" href="class_c_m_data_model.html#ab2fc40d43824ea3e1ce5d86dee0d763b" title="The data model name.">$name</a>);
<a name="l00747"></a>00747   <span class="keywordflow">return</span> <a class="code" href="class_c_m_form.html#a3cfe321b6ef9794e10a6bc86f7055989" title="Create a password box.">CMForm::PasswordBox</a>($a);
<a name="l00748"></a>00748  }
<a name="l00749"></a>00749  
<a name="l00763"></a><a class="code" href="class_c_m_data_model.html#ae39fd43ddf2064390c10cee3a58c3256">00763</a>  <span class="keyword">public</span> function <a class="code" href="class_c_m_data_model.html#ae39fd43ddf2064390c10cee3a58c3256" title="Render a form submit button.">submitButton</a>(<a class="code" href="class_c_m_data_model.html#ab2fc40d43824ea3e1ce5d86dee0d763b" title="The data model name.">$name</a>, $a = <span class="keyword">false</span>) {
<a name="l00764"></a>00764   list($a[<span class="stringliteral">&#39;name&#39;</span>], $a[<span class="stringliteral">&#39;value&#39;</span>]) = $this-&gt;<a class="code" href="class_c_m_data_model.html#a071d15ce010f6493182e6b2dee0f7d83" title="Extract the bare name and real value from a variable.">extractNameValue</a>(<a class="code" href="class_c_m_data_model.html#ab2fc40d43824ea3e1ce5d86dee0d763b" title="The data model name.">$name</a>);
<a name="l00765"></a>00765   <span class="keywordflow">return</span> <a class="code" href="class_c_m_form.html#a5541dbf0e2b8b8725ec9a46cbc8feb60" title="Create a submit button.">CMForm::SubmitButton</a>($a);
<a name="l00766"></a>00766  }
<a name="l00767"></a>00767  
<a name="l00781"></a><a class="code" href="class_c_m_data_model.html#ab1137628788bb10f797b768a4891d81a">00781</a>  <span class="keyword">public</span> function <a class="code" href="class_c_m_data_model.html#ab1137628788bb10f797b768a4891d81a" title="Render a form reset button.">resetButton</a>(<a class="code" href="class_c_m_data_model.html#ab2fc40d43824ea3e1ce5d86dee0d763b" title="The data model name.">$name</a>, $a = <span class="keyword">false</span>) {
<a name="l00782"></a>00782   list($a[<span class="stringliteral">&#39;name&#39;</span>], $a[<span class="stringliteral">&#39;value&#39;</span>]) = $this-&gt;<a class="code" href="class_c_m_data_model.html#a071d15ce010f6493182e6b2dee0f7d83" title="Extract the bare name and real value from a variable.">extractNameValue</a>(<a class="code" href="class_c_m_data_model.html#ab2fc40d43824ea3e1ce5d86dee0d763b" title="The data model name.">$name</a>);
<a name="l00783"></a>00783   <span class="keywordflow">return</span> <a class="code" href="class_c_m_form.html#ac7d9025d6f1d5980b4e2261be6ee2ba4" title="Create a form reset button.">CMForm::ResetButton</a>($a);
<a name="l00784"></a>00784  }
<a name="l00785"></a>00785  
<a name="l00799"></a><a class="code" href="class_c_m_data_model.html#a835fb7b685eb5b7b3704b15ea56c75e5">00799</a>  <span class="keyword">public</span> function <a class="code" href="class_c_m_data_model.html#a835fb7b685eb5b7b3704b15ea56c75e5" title="Render a non-submit form button.">button</a>(<a class="code" href="class_c_m_data_model.html#ab2fc40d43824ea3e1ce5d86dee0d763b" title="The data model name.">$name</a>, $a = <span class="keyword">false</span>) {
<a name="l00800"></a>00800   list($a[<span class="stringliteral">&#39;name&#39;</span>], $a[<span class="stringliteral">&#39;value&#39;</span>]) = $this-&gt;<a class="code" href="class_c_m_data_model.html#a071d15ce010f6493182e6b2dee0f7d83" title="Extract the bare name and real value from a variable.">extractNameValue</a>(<a class="code" href="class_c_m_data_model.html#ab2fc40d43824ea3e1ce5d86dee0d763b" title="The data model name.">$name</a>);
<a name="l00801"></a>00801   <span class="keywordflow">return</span> <a class="code" href="class_c_m_form.html#a2fd0a11ea628e68b103b1cef8d0ea99a" title="Create a non-submitting button.">CMForm::Button</a>($a);
<a name="l00802"></a>00802  }
<a name="l00803"></a>00803  
<a name="l00817"></a><a class="code" href="class_c_m_data_model.html#add0d0bfd2803dad671fa57031b81274e">00817</a>  <span class="keyword">public</span> function <a class="code" href="class_c_m_data_model.html#add0d0bfd2803dad671fa57031b81274e" title="Render a hidden field.">hidden</a>(<a class="code" href="class_c_m_data_model.html#ab2fc40d43824ea3e1ce5d86dee0d763b" title="The data model name.">$name</a>, $a = <span class="keyword">false</span>) {
<a name="l00818"></a>00818   list($a[<span class="stringliteral">&#39;name&#39;</span>], $a[<span class="stringliteral">&#39;value&#39;</span>]) = $this-&gt;<a class="code" href="class_c_m_data_model.html#a071d15ce010f6493182e6b2dee0f7d83" title="Extract the bare name and real value from a variable.">extractNameValue</a>(<a class="code" href="class_c_m_data_model.html#ab2fc40d43824ea3e1ce5d86dee0d763b" title="The data model name.">$name</a>);
<a name="l00819"></a>00819   <span class="keywordflow">return</span> <a class="code" href="class_c_m_form.html#aacf8b065b9ea18fc98a977be6eb85e13" title="Create a hidden field.">CMForm::Hidden</a>($a);
<a name="l00820"></a>00820  }
<a name="l00821"></a>00821  
<a name="l00838"></a><a class="code" href="class_c_m_data_model.html#a2c99ded5fbee68dde8526b1ef660a7ac">00838</a>  <span class="keyword">public</span> function <a class="code" href="class_c_m_data_model.html#a2c99ded5fbee68dde8526b1ef660a7ac" title="Render a drop down menu.">menu</a>(<a class="code" href="class_c_m_data_model.html#ab2fc40d43824ea3e1ce5d86dee0d763b" title="The data model name.">$name</a>, $a = <span class="keyword">false</span>) {
<a name="l00839"></a>00839   list($a[<span class="stringliteral">&#39;name&#39;</span>], $a[<span class="stringliteral">&#39;value&#39;</span>]) = $this-&gt;<a class="code" href="class_c_m_data_model.html#a071d15ce010f6493182e6b2dee0f7d83" title="Extract the bare name and real value from a variable.">extractNameValue</a>(<a class="code" href="class_c_m_data_model.html#ab2fc40d43824ea3e1ce5d86dee0d763b" title="The data model name.">$name</a>);
<a name="l00840"></a>00840   <span class="keywordflow">return</span> <a class="code" href="class_c_m_form.html#a15f48d56db687516bbbf67e201034e70" title="Create a popup menu.">CMForm::Menu</a>($a);
<a name="l00841"></a>00841  }
<a name="l00842"></a>00842  
<a name="l00856"></a><a class="code" href="class_c_m_data_model.html#a9add681f781315e2db87e0acc4571178">00856</a>  <span class="keyword">public</span> function <a class="code" href="class_c_m_data_model.html#a9add681f781315e2db87e0acc4571178" title="Render a checkbox.">checkbox</a>(<a class="code" href="class_c_m_data_model.html#ab2fc40d43824ea3e1ce5d86dee0d763b" title="The data model name.">$name</a>, $a = <span class="keyword">false</span>) {
<a name="l00857"></a>00857   list($a[<span class="stringliteral">&#39;name&#39;</span>], $a[<span class="stringliteral">&#39;value&#39;</span>]) = $this-&gt;<a class="code" href="class_c_m_data_model.html#a071d15ce010f6493182e6b2dee0f7d83" title="Extract the bare name and real value from a variable.">extractNameValue</a>(<a class="code" href="class_c_m_data_model.html#ab2fc40d43824ea3e1ce5d86dee0d763b" title="The data model name.">$name</a>);
<a name="l00858"></a>00858   $a[<span class="stringliteral">&#39;checked&#39;</span>] = $this-&gt;<a class="code" href="class_c_m_data_model.html#a94cbe4a871c1c28abe39a9551beb849e" title="Determine the boolean value based on falseValues and trueValues.">determineChecked</a>($a[<span class="stringliteral">&#39;value&#39;</span>]);
<a name="l00859"></a>00859   <span class="keywordflow">return</span> <a class="code" href="class_c_m_form.html#a117240abe236a0c688f484289fa677d4" title="Create a checkbox.">CMForm::Checkbox</a>($a);
<a name="l00860"></a>00860  }
<a name="l00861"></a>00861  
<a name="l00878"></a><a class="code" href="class_c_m_data_model.html#a6feebbb4778aceece98ae48e469718bc">00878</a>  <span class="keyword">public</span> function <a class="code" href="class_c_m_data_model.html#a6feebbb4778aceece98ae48e469718bc" title="Render a list.">listBox</a>(<a class="code" href="class_c_m_data_model.html#ab2fc40d43824ea3e1ce5d86dee0d763b" title="The data model name.">$name</a>, $a = <span class="keyword">false</span>) {
<a name="l00879"></a>00879   list($a[<span class="stringliteral">&#39;name&#39;</span>], $a[<span class="stringliteral">&#39;value&#39;</span>]) = $this-&gt;<a class="code" href="class_c_m_data_model.html#a071d15ce010f6493182e6b2dee0f7d83" title="Extract the bare name and real value from a variable.">extractNameValue</a>(<a class="code" href="class_c_m_data_model.html#ab2fc40d43824ea3e1ce5d86dee0d763b" title="The data model name.">$name</a>);
<a name="l00880"></a>00880   <span class="keywordflow">return</span> <a class="code" href="class_c_m_form.html#a4bc73067e9cc052d2888596fe868868b" title="Create a list box.">CMForm::ListBox</a>($a);
<a name="l00881"></a>00881  }
<a name="l00882"></a>00882  
<a name="l00899"></a><a class="code" href="class_c_m_data_model.html#a617443524aedfcb5d4e370ef01946a63">00899</a>  <span class="keyword">public</span> function <a class="code" href="class_c_m_data_model.html#a617443524aedfcb5d4e370ef01946a63" title="Render a group of radio buttons.">radioGroup</a>(<a class="code" href="class_c_m_data_model.html#ab2fc40d43824ea3e1ce5d86dee0d763b" title="The data model name.">$name</a>, $a = <span class="keyword">false</span>) {
<a name="l00900"></a>00900   list($a[<span class="stringliteral">&#39;name&#39;</span>], $a[<span class="stringliteral">&#39;value&#39;</span>]) = $this-&gt;<a class="code" href="class_c_m_data_model.html#a071d15ce010f6493182e6b2dee0f7d83" title="Extract the bare name and real value from a variable.">extractNameValue</a>(<a class="code" href="class_c_m_data_model.html#ab2fc40d43824ea3e1ce5d86dee0d763b" title="The data model name.">$name</a>);
<a name="l00901"></a>00901   <span class="keywordflow">return</span> <a class="code" href="class_c_m_form.html#a59a84e7f3e9db3ffada7c36e8111a0ae" title="Create a radio button set.">CMForm::RadioGroup</a>($a);
<a name="l00902"></a>00902  }
<a name="l00903"></a>00903  
<a name="l00920"></a><a class="code" href="class_c_m_data_model.html#acda3c20bea3adedd2d3644c7579c1277">00920</a>  <span class="keyword">public</span> function <a class="code" href="class_c_m_data_model.html#acda3c20bea3adedd2d3644c7579c1277" title="Render a group of checkboxes.">checkboxGroup</a>(<a class="code" href="class_c_m_data_model.html#ab2fc40d43824ea3e1ce5d86dee0d763b" title="The data model name.">$name</a>, $a = <span class="keyword">false</span>) {
<a name="l00921"></a>00921   list($a[<span class="stringliteral">&#39;name&#39;</span>], $a[<span class="stringliteral">&#39;value&#39;</span>]) = $this-&gt;<a class="code" href="class_c_m_data_model.html#a071d15ce010f6493182e6b2dee0f7d83" title="Extract the bare name and real value from a variable.">extractNameValue</a>(<a class="code" href="class_c_m_data_model.html#ab2fc40d43824ea3e1ce5d86dee0d763b" title="The data model name.">$name</a>);
<a name="l00922"></a>00922   <span class="keywordflow">return</span> <a class="code" href="class_c_m_form.html#ab76da49fb3531d1e087abdfbfaf5465b" title="Create a checkbox set.">CMForm::CheckboxGroup</a>($a);
<a name="l00923"></a>00923  }
<a name="l00924"></a>00924  
<a name="l00938"></a><a class="code" href="class_c_m_data_model.html#a9b4deb597a90bc29b6e47438de642daf">00938</a>  <span class="keyword">public</span> function <a class="code" href="class_c_m_data_model.html#a9b4deb597a90bc29b6e47438de642daf" title="Render a text area.">textArea</a>(<a class="code" href="class_c_m_data_model.html#ab2fc40d43824ea3e1ce5d86dee0d763b" title="The data model name.">$name</a>, $a = <span class="keyword">false</span>) {
<a name="l00939"></a>00939   list($a[<span class="stringliteral">&#39;name&#39;</span>], $a[<span class="stringliteral">&#39;value&#39;</span>]) = $this-&gt;<a class="code" href="class_c_m_data_model.html#a071d15ce010f6493182e6b2dee0f7d83" title="Extract the bare name and real value from a variable.">extractNameValue</a>(<a class="code" href="class_c_m_data_model.html#ab2fc40d43824ea3e1ce5d86dee0d763b" title="The data model name.">$name</a>);
<a name="l00940"></a>00940   <span class="keywordflow">return</span> <a class="code" href="class_c_m_form.html#a86d2d20ed424da849ed44b1636ebe51e" title="Create a text area.">CMForm::TextArea</a>($a);
<a name="l00941"></a>00941  }
<a name="l00942"></a>00942  
<a name="l00949"></a><a class="code" href="class_c_m_data_model.html#a4eb23ebf75009f6966eaf62423de3ee5">00949</a>  <span class="keyword">public</span> function <a class="code" href="class_c_m_data_model.html#a4eb23ebf75009f6966eaf62423de3ee5" title="Get an array of the invalid fields.">getInvalidFields</a>() {
<a name="l00950"></a>00950   <span class="keywordflow">return</span> $this-&gt;vh-&gt;getInvalidFields();
<a name="l00951"></a>00951  }
<a name="l00952"></a>00952  
<a name="l00959"></a><a class="code" href="class_c_m_data_model.html#a899afabad5d03c34598f85efd27bbe30">00959</a>  <span class="keyword">public</span> function <a class="code" href="class_c_m_data_model.html#a899afabad5d03c34598f85efd27bbe30" title="A human-readable explanation of why the validation failed.">fieldError</a>(<a class="code" href="class_c_m_data_model.html#ab2fc40d43824ea3e1ce5d86dee0d763b" title="The data model name.">$name</a>) {
<a name="l00960"></a>00960   <span class="keywordflow">if</span>(is_array($this-&gt;vh-&gt;invalidFields[<a class="code" href="class_c_m_data_model.html#ab2fc40d43824ea3e1ce5d86dee0d763b" title="The data model name.">$name</a>]))
<a name="l00961"></a>00961    <span class="keywordflow">return</span> implode(<span class="stringliteral">&#39;, &#39;</span>, $this-&gt;vh-&gt;invalidFields[<a class="code" href="class_c_m_data_model.html#ab2fc40d43824ea3e1ce5d86dee0d763b" title="The data model name.">$name</a>]);
<a name="l00962"></a>00962   <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l00963"></a>00963  }
<a name="l00964"></a>00964  
<a name="l00975"></a><a class="code" href="class_c_m_data_model.html#a094a115bc3f56c1fc041314247eb5aac">00975</a>  <span class="keyword">public</span> function <a class="code" href="class_c_m_data_model.html#a094a115bc3f56c1fc041314247eb5aac" title="Replace a pool with an array.">setPool</a>(array $values, <a class="code" href="class_c_m_data_model.html#ab2fc40d43824ea3e1ce5d86dee0d763b" title="The data model name.">$name</a> = <span class="stringliteral">&#39;default&#39;</span>) {
<a name="l00976"></a>00976   $this-&gt;pool[<a class="code" href="class_c_m_data_model.html#ab2fc40d43824ea3e1ce5d86dee0d763b" title="The data model name.">$name</a>] = $values;
<a name="l00977"></a>00977   <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00978"></a>00978  }
<a name="l00979"></a>00979  
<a name="l00988"></a><a class="code" href="class_c_m_data_model.html#a0e2c075b9ec47f8c999b904c2a26b15a">00988</a>  <span class="keyword">public</span> function <a class="code" href="class_c_m_data_model.html#a0e2c075b9ec47f8c999b904c2a26b15a" title="Set multiple pools.">setPools</a>(array $pools) {
<a name="l00989"></a>00989   <span class="keywordflow">foreach</span>($pools as $k =&gt; $v)
<a name="l00990"></a>00990    $this-&gt;<a class="code" href="class_c_m_data_model.html#a094a115bc3f56c1fc041314247eb5aac" title="Replace a pool with an array.">setPool</a>($k, $v);
<a name="l00991"></a>00991   <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00992"></a>00992  }
<a name="l00993"></a>00993  
<a name="l01019"></a><a class="code" href="class_c_m_data_model.html#a7de9a67b4f5a283dd4c03b4fe08792e3">01019</a>  <span class="keyword">public</span> function <a class="code" href="class_c_m_data_model.html#a7de9a67b4f5a283dd4c03b4fe08792e3" title="Check if a table contains one or more records where all the values in a pool match...">recordExists</a>(<a class="code" href="class_c_m_data_model.html#a0e235d3f271fa9c26b947e1e14158d60" title="Storage pools.">$pool</a>, $tableName = <span class="keyword">false</span>, $extra = array()) {
<a name="l01020"></a>01020   <span class="comment">// we need a table name</span>
<a name="l01021"></a>01021   <span class="keywordflow">if</span>($tableName === <span class="keyword">false</span>)
<a name="l01022"></a>01022    $tableName = <a class="code" href="class_c_m_data_model.html#a0e235d3f271fa9c26b947e1e14158d60" title="Storage pools.">$pool</a>;
<a name="l01023"></a>01023    
<a name="l01024"></a>01024   <span class="comment">// the pool must exist</span>
<a name="l01025"></a>01025   <span class="keywordflow">if</span>(!$this-&gt;<a class="code" href="class_c_m_data_model.html#abfaed3adbf6f1db8dca30cb6047fc27e" title="Check if a pool exists.">poolExists</a>(<a class="code" href="class_c_m_data_model.html#a0e235d3f271fa9c26b947e1e14158d60" title="Storage pools.">$pool</a>))
<a name="l01026"></a>01026    <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01027"></a>01027    
<a name="l01028"></a>01028   <span class="comment">// we must have a database</span>
<a name="l01029"></a>01029   <span class="keywordflow">if</span>($this-&gt;dbh === <span class="keyword">false</span>)
<a name="l01030"></a>01030    <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01031"></a>01031   
<a name="l01032"></a>01032   <span class="comment">// create SQL</span>
<a name="l01033"></a>01033   $sql = <span class="stringliteral">&quot;SELECT COUNT(1) FROM $tableName WHERE &quot;</span>;
<a name="l01034"></a>01034   $first = <span class="keyword">true</span>;
<a name="l01035"></a>01035   <span class="keywordflow">foreach</span>($this-&gt;pool[<a class="code" href="class_c_m_data_model.html#a0e235d3f271fa9c26b947e1e14158d60" title="Storage pools.">$pool</a>] as $k =&gt; $v) {
<a name="l01036"></a>01036    <span class="keywordflow">if</span>(!$first)
<a name="l01037"></a>01037     $sql .= <span class="stringliteral">&quot; AND &quot;</span>;
<a name="l01038"></a>01038    <span class="keywordflow">else</span> $first = <span class="keyword">false</span>;
<a name="l01039"></a>01039    
<a name="l01040"></a>01040    $sql .= <span class="stringliteral">&quot;$k=&#39;$v&#39;&quot;</span>;
<a name="l01041"></a>01041   }
<a name="l01042"></a>01042   <span class="keywordflow">foreach</span>($extra as $k =&gt; $v) {
<a name="l01043"></a>01043    <span class="keywordflow">if</span>(!$first)
<a name="l01044"></a>01044     $sql .= <span class="stringliteral">&quot; AND &quot;</span>;
<a name="l01045"></a>01045    <span class="keywordflow">else</span> $first = <span class="keyword">false</span>;
<a name="l01046"></a>01046    
<a name="l01047"></a>01047    $sql .= <span class="stringliteral">&quot;$k=&#39;$v&#39;&quot;</span>;
<a name="l01048"></a>01048   }
<a name="l01049"></a>01049   
<a name="l01050"></a>01050   <span class="comment">// perform lookup</span>
<a name="l01051"></a>01051   <span class="keywordflow">return</span> $this-&gt;dbh-&gt;query($sql)-&gt;fetch(<span class="stringliteral">&#39;cell&#39;</span>) &gt; 0;
<a name="l01052"></a>01052  }
<a name="l01053"></a>01053  
<a name="l01060"></a><a class="code" href="class_c_m_data_model.html#a94cbe4a871c1c28abe39a9551beb849e">01060</a>  <span class="keyword">private</span> function <a class="code" href="class_c_m_data_model.html#a94cbe4a871c1c28abe39a9551beb849e" title="Determine the boolean value based on falseValues and trueValues.">determineChecked</a>($value) {
<a name="l01061"></a>01061   <span class="comment">// first check the falseValues</span>
<a name="l01062"></a>01062   <span class="keywordflow">foreach</span>($this-&gt;falseValues as $v) {
<a name="l01063"></a>01063    <span class="keywordflow">if</span>($value == $v)
<a name="l01064"></a>01064     <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01065"></a>01065   }
<a name="l01066"></a>01066  
<a name="l01067"></a>01067   <span class="comment">// first check the trueValues</span>
<a name="l01068"></a>01068   <span class="keywordflow">foreach</span>($this-&gt;trueValues as $v) {
<a name="l01069"></a>01069    <span class="keywordflow">if</span>($value == $v)
<a name="l01070"></a>01070     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l01071"></a>01071   }
<a name="l01072"></a>01072   
<a name="l01073"></a>01073   <span class="comment">// if its neither then use PHP rules to cast</span>
<a name="l01074"></a>01074   <span class="keywordflow">return</span> (<span class="keywordtype">boolean</span>) $value;
<a name="l01075"></a>01075  }
<a name="l01076"></a>01076  
<a name="l01080"></a><a class="code" href="class_c_m_data_model.html#a7516ca30af0db3cdbf9a7739b48ce91d">01080</a>  <span class="keyword">public</span> function <a class="code" href="class_c_m_data_model.html#a7516ca30af0db3cdbf9a7739b48ce91d" title="Return the string value of this object.">__toString</a>() {
<a name="l01081"></a>01081   <span class="keywordflow">return</span> <span class="stringliteral">&quot;&lt;&quot;</span> . get_class($this) . <span class="stringliteral">&quot;&gt;&quot;</span>;
<a name="l01082"></a>01082  }
<a name="l01083"></a>01083  
<a name="l01084"></a>01084 }
<a name="l01085"></a>01085 
<a name="l01086"></a>01086 <span class="comment">// make sure the session is started</span>
<a name="l01087"></a>01087 <span class="comment">// WARNING: this line must be after the class definition</span>
<a name="l01088"></a>01088 session_start();
<a name="l01089"></a>01089 
<a name="l01090"></a>01090 ?&gt;
</pre></div></div>
<hr class="footer"/><address style="text-align: right;"><small>Generated by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.3 </small></address>
</body>
</html>
